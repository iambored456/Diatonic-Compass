var kn=Object.defineProperty;var Sn=(a,e,t)=>e in a?kn(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var Vr=(a,e,t)=>Sn(a,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();const En="modulepreload",On=function(a,e){return new URL(a,e).href},Wr={},je=function(e,t,r){let i=Promise.resolve();if(t&&t.length>0){let s=function(h){return Promise.all(h.map(d=>Promise.resolve(d).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};const o=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),c=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));i=s(t.map(h=>{if(h=On(h,r),h in Wr)return;Wr[h]=!0;const d=h.endsWith(".css"),f=d?'[rel="stylesheet"]':"";if(!!r)for(let u=o.length-1;u>=0;u--){const _=o[u];if(_.href===h&&(!d||_.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${h}"]${f}`))return;const p=document.createElement("link");if(p.rel=d?"stylesheet":En,d||(p.as="script"),p.crossOrigin="",p.href=h,c&&p.setAttribute("nonce",c),document.head.appendChild(p),d)return new Promise((u,_)=>{p.addEventListener("load",u),p.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${h}`)))})}))}function n(s){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s}return i.then(s=>{for(const o of s||[])o.status==="rejected"&&n(o.reason);return e().catch(n)})},Lt=["C","C♯/D♭","D","D♯/E♭","E","F","F♯/G♭","G","G♯/A♭","A","A♯/B♭","B"],Bt=["1","♯1/♭2","2","♯2/♭3","3","4","♯4/♭5","5","♯5/♭6","6","♯6/♭7","7"],An=[...Array(12).keys()],xe=12,Nt=[0,2,4,5,7,9,11],pt={C:!0,"C♯/D♭":!1,D:!0,"D♯/E♭":!1,E:!0,F:!0,"F♯/G♭":!1,G:!0,"G♯/A♭":!1,A:!0,"A♯/B♭":!1,B:!0},ar={0:"#f090ae",2:"#ea9e5e",4:"#a8bd61",5:"#76c788",7:"#33c6dc",9:"#94adff",11:"#dd95d6",1:"#a46055",3:"#8a722f",6:"#258677",8:"#3d7ca5",10:"#7d68a3"},Pn={1:[0,2,4,5,7,9,11],2:[0,2,3,5,7,9,10],3:[0,1,3,5,7,8,10],4:[0,2,4,6,7,9,11],5:[0,2,4,5,7,9,10],6:[0,2,3,5,7,8,10],7:[0,1,3,5,6,8,10]},di={1:"1","♯1/♭2":"2",2:"2","♯2/♭3":"3",3:"3",4:"4","♯4/♭5":"5",5:"5","♯5/♭6":"6",6:"6","♯6/♭7":"7",7:"7"},Mn={1:"Major",2:"Dorian",3:"Phrygian",4:"Lydian",5:"Mixolydian",6:"Minor",7:"Locrian"},In=[2,2,1,2,2,2,1],We=Math.PI*2,G=We/12,Q={ANIMATION:{DURATION_MS:300},WHEEL:{FONTS:{OUTER_FACTOR:.057,MIDDLE_FACTOR:.052,INNER_FACTOR:.042}},AUDIO:{BASE_FREQUENCY:261.63,NOTE_DURATION_MS:250,PAUSE_BETWEEN_NOTES_MS:50},ERROR_HANDLING:{CONTEXTS:{AUDIO:"AudioContext",ANIMATION:"Animation",UI:"UI",APP:"App"}}},Dn=Q.WHEEL.FONTS.OUTER_FACTOR,Rn=Q.WHEEL.FONTS.MIDDLE_FACTOR,Ln=Q.WHEEL.FONTS.INNER_FACTOR,Bn=Q.ANIMATION.DURATION_MS,Yr=Q.AUDIO.NOTE_DURATION_MS,Nn=Q.AUDIO.PAUSE_BETWEEN_NOTES_MS,Fn=Q.AUDIO.BASE_FREQUENCY,m={rings:{pitchClass:0,degree:0,chromatic:0,highlightPosition:0},drag:{active:null,startX:0,startY:0,startPitchClass:0,startDegree:0,startChrom:0,startHighlight:0},animation:null,belts:{itemSize:{},tracks:{},init:!1,orientation:"horizontal",order:["pitch","degree","intervals","chromatic"],layoutOrder:{horizontal:["compass","pitch","degree","intervals","chromatic","result"],vertical:["compass","result"]}},dimensions:{size:0,cx:0,cy:0,dpr:1},playback:{isPlaying:!1,currentNoteIndex:null,sequence:[],timeoutId:null,audioContext:null,rootNoteIndexForPlayback:null},display:{sharp:!0,flat:!0},ui:{sidebarOpen:!1,darkMode:!1,cursorColor:"red",cursorFill:!1,display:{get sharp(){return m.display.sharp},get flat(){return m.display.flat},set sharp(a){m.display.sharp=a},set flat(a){m.display.flat=a}}},performance:{needsRedraw:!0,lastRenderState:null,frameSkipCounter:0,isLowPowerMode:!1}},Gr=Object.freeze(Object.defineProperty({__proto__:null,appState:m},Symbol.toStringTag,{value:"Module"}));function zn(a){function e(t){a(t),requestAnimationFrame(e)}requestAnimationFrame(e)}class E{static handle(e,t,r=null){const i={message:e.message,stack:e.stack,context:t,timestamp:Date.now(),userAgent:navigator.userAgent};if(console.error(`[${t}] Error:`,e),this.logError(i),r)try{r()}catch(n){console.error(`[${t}] Fallback failed:`,n)}this.attemptRecovery(t,e)}static logError(e){try{const t=JSON.parse(sessionStorage.getItem("diatonic-errors")||"[]");t.push(e);const r=t.slice(-20);sessionStorage.setItem("diatonic-errors",JSON.stringify(r))}catch(t){this.isDebugMode&&console.warn("Could not log error to sessionStorage:",t)}}static attemptRecovery(e,t){switch(e){case"AudioContext":this.recoverAudioContext();break;case"Canvas":this.recoverCanvas();break;case"Animation":this.recoverAnimation();break;case"LocalStorage":this.recoverLocalStorage();break;case"Resize":console.warn("Resize error detected - may self-resolve");break;default:this.isDebugMode&&console.warn(`No specific recovery strategy for context: ${e}`)}}static recoverAudioContext(){je(async()=>{const{appState:e}=await Promise.resolve().then(()=>Gr);return{appState:e}},void 0,import.meta.url).then(({appState:e})=>{if(e.playback.audioContext){try{e.playback.audioContext.close()}catch{}e.playback.audioContext=null}e.playback.isPlaying&&(e.playback.isPlaying=!1,e.playback.currentNoteIndex=null,e.playback.sequence=[],e.playback.timeoutId&&(clearTimeout(e.playback.timeoutId),e.playback.timeoutId=null))})}static recoverCanvas(){requestAnimationFrame(()=>{console.log("Attempting canvas recovery via redraw")})}static recoverAnimation(){je(async()=>{const{appState:e}=await Promise.resolve().then(()=>Gr);return{appState:e}},void 0,import.meta.url).then(({appState:e})=>{e.animation=null,e.drag.active=null})}static recoverLocalStorage(){console.warn("LocalStorage unavailable - preferences will not persist")}static getErrorLog(){try{return JSON.parse(sessionStorage.getItem("diatonic-errors")||"[]")}catch{return[]}}static clearErrorLog(){try{sessionStorage.removeItem("diatonic-errors")}catch{}}static enableDebugMode(){this.isDebugMode=!0,console.log("ErrorHandler debug mode enabled")}static isFeatureSupported(e){switch(e){case"AudioContext":return!!(window.AudioContext||window.webkitAudioContext);case"localStorage":try{const t="__localStorage_test__";return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch{return!1}case"requestIdleCallback":return typeof window.requestIdleCallback=="function";case"OffscreenCanvas":return typeof OffscreenCanvas<"u";default:return!0}}static wrap(e,t,r=null){return(...i)=>{try{return e(...i)}catch(n){return this.handle(n,t,r),r?r(...i):void 0}}}}Vr(E,"isDebugMode",!1);function Hn(a,e){try{if(!a)return console.warn("No canvas element provided"),!1;if(!e)return console.warn("No dimensions object provided"),!1;if(!a.parentElement)return!1;const t=a.closest(".main-container"),r=t&&t.classList.contains("vertical-layout"),i=a.parentElement.offsetWidth,n=a.parentElement.offsetHeight,s=window.innerWidth,o=window.innerHeight,l=t?t.offsetWidth:0,c=t?t.offsetHeight:0;let h=a;const d=[];for(;h&&h!==document.body;)d.push({tagName:h.tagName,className:h.className,id:h.id,width:h.offsetWidth,height:h.offsetHeight,style:{width:h.style.width,height:h.style.height,display:getComputedStyle(h).display,position:getComputedStyle(h).position}}),h=h.parentElement;let f;if(r){const u=Math.max(i,s*.8),_=Math.max(n,o*.8);f=Math.min(u,_)}else{const u=Math.min(i,n);f=Math.min(u,window.innerHeight*.8)}if(Math.abs(f-(e.size||0))>50&&(console.log("=== CANVAS CONTAINER DEBUG ==="),console.log("Vertical mode:",r),console.log("Canvas size:",{width:a.width,height:a.height}),console.log("Container dimensions:",{containerWidth:i,containerHeight:n}),console.log("Viewport dimensions:",{viewportWidth:s,viewportHeight:o}),console.log("Calculated size:",f),console.log("DOM Hierarchy (from canvas to body):"),d.forEach((u,_)=>{console.log(`  ${_}: ${u.tagName}${u.id?"#"+u.id:""}${u.className?"."+u.className.replace(/\s+/g,"."):""}`,{dimensions:`${u.width}x${u.height}`,styles:u.style})})),f===e.size||f===0||e.size&&Math.abs(f-e.size)<2)return!1;console.log("Canvas resize proceeding:",{oldSize:e.size,newSize:f,difference:Math.abs(f-(e.size||0))}),e.size=f,e.cx=f/2,e.cy=f/2,(!e.dpr||e.dpr===0)&&(e.dpr=$n());const g=f*e.dpr,p=f*e.dpr;return console.log("Setting canvas dimensions:",{cssSize:`${f}px`,bufferSize:`${g}x${p}`,dpr:e.dpr,beforeCSS:{width:a.style.width,height:a.style.height},beforeBuffer:{width:a.width,height:a.height}}),a.width=g,a.height=p,a.style.width=`${f}px`,a.style.height=`${f}px`,console.log("Canvas dimensions after setting:",{cssSize:{width:a.style.width,height:a.style.height},bufferSize:{width:a.width,height:a.height},offsetSize:{width:a.offsetWidth,height:a.offsetHeight}}),!0}catch(t){return E.handle(t,"Canvas",()=>{try{if(a&&a.parentElement&&e){const r=Math.min(a.parentElement.offsetWidth,a.parentElement.offsetHeight);r>0&&r!==e.size&&(e.size=r,e.cx=r/2,e.cy=r/2,e.dpr=e.dpr||1,a.width=r*e.dpr,a.height=r*e.dpr)}}catch{console.error("Canvas resize fallback failed")}}),!1}}function $n(){try{return Math.min(window.devicePixelRatio||1,3)}catch(a){return E.handle(a,"Canvas"),1}}const qn=1/G,F=a=>(a%We+We)%We;function fi(a,e){const t=F(e)-F(a);return t>Math.PI?t-We:t<-Math.PI?t+We:t}const Un=a=>a<.5?2*a*a:-1+(4-2*a)*a,Ft=a=>(Math.round(-F(a)*qn)%12+12)%12;class tt{static debounce(e,t){let r;const i=(...n)=>{clearTimeout(r),r=setTimeout(()=>e.apply(this,n),t)};return i.cancel=()=>{clearTimeout(r),r=null},i}static throttle(e,t){let r,i,n;return(...s)=>{r?(clearTimeout(i),i=setTimeout(()=>{Date.now()-n>=t&&(e.apply(this,s),n=Date.now())},t-(Date.now()-n))):(e.apply(this,s),n=Date.now(),r=!0)}}static memoize(e,t=JSON.stringify,r=100){const i=new Map,n=(...s)=>{const o=t(s);if(i.has(o))return i.get(o);const l=e(...s);if(i.size>=r){const c=i.keys().next().value;i.delete(c)}return i.set(o,l),l};return n.clearCache=()=>i.clear(),n.getCacheSize=()=>i.size,n.getCacheStats=()=>({size:i.size,maxSize:r,keys:Array.from(i.keys())}),n}static startMeasure(e){const t=performance.now();return()=>{const i=performance.now()-t;return console.log(`[Performance] ${e}: ${i.toFixed(2)}ms`),i}}static monitor(e,t){return(...r)=>{const i=this.startMeasure(t);try{const n=e(...r);return i(),n}catch(n){throw i(),n}}}static requestOptimizedFrame(e,t={}){return typeof window.requestIdleCallback=="function"?window.requestIdleCallback(e,{timeout:16,...t}):requestAnimationFrame(e)}static cancelOptimizedFrame(e){typeof window.cancelIdleCallback=="function"?window.cancelIdleCallback(e):cancelAnimationFrame(e)}static batchDOMUpdates(e){return new Promise(t=>{requestAnimationFrame(()=>{e(),t()})})}static createFPSMonitor(e,t=60){let r=0,i=performance.now(),n;const s=o=>{if(r++,r%t===0){const l=Math.round(t*1e3/(o-i));e(l),i=o}n=requestAnimationFrame(s)};return n=requestAnimationFrame(s),()=>{n&&(cancelAnimationFrame(n),n=null)}}static prefersReducedMotion(){return window.matchMedia("(prefers-reduced-motion: reduce)").matches}static getViewportSize(){return{width:Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),height:Math.max(document.documentElement.clientHeight||0,window.innerHeight||0)}}static isElementVisible(e,t=0){const r=e.getBoundingClientRect(),i=window.innerHeight||document.documentElement.clientHeight,n=window.innerWidth||document.documentElement.clientWidth;return r.bottom>=t*i&&r.top<=(1-t)*i&&r.right>=t*n&&r.left<=(1-t)*n}static getMemoryInfo(){return performance.memory?{used:Math.round(performance.memory.usedJSHeapSize/1048576),total:Math.round(performance.memory.totalJSHeapSize/1048576),limit:Math.round(performance.memory.jsHeapSizeLimit/1048576)}:null}}function Vn([a]){const{sharp:e,flat:t}=a.display;return`${e}-${t}`}function Wn([a]){const{sharp:e,flat:t}=a.display,{pitchClass:r,degree:i,chromatic:n}=a.rings,s=Math.round(r*1e3)/1e3,o=Math.round(i*1e3)/1e3,l=Math.round(n*1e3)/1e3;return`${e}-${t}-${s}-${o}-${l}`}function Xr(a,e,t){try{if(!a||!a.includes("/"))return a||"";const[r,i]=a.split("/");return!r||!i?(console.warn(`Invalid label format: ${a}`),a):e&&t?`${r}<br>${i}`:e?r:t?i:`${r}<br>${i}`}catch(r){return E.handle(r,"Logic",()=>{console.warn(`Label processing failed for: ${a}`)}),a||""}}function Yn(a){try{const{sharp:e,flat:t}=a.display;if(typeof e!="boolean"||typeof t!="boolean")throw new Error("Invalid display state - sharp/flat must be booleans");const r=Lt.map(n=>Xr(n,e,t)),i=Bt.map(n=>Xr(n,e,t));if(r.length!==12||i.length!==12)throw new Error("Invalid label array lengths");return{chromaticLabels:r,diatonicLabels:i}}catch(e){return E.handle(e,"Logic",()=>{console.warn("Falling back to default labels")}),{chromaticLabels:Lt.slice(),diatonicLabels:Bt.slice()}}}const gi=tt.memoize(Yn,Vn,50);function Gn(a){try{const{sharp:e,flat:t}=a.display,{pitchClass:r,degree:i,chromatic:n}=a.rings;if(typeof r!="number"||typeof i!="number"||typeof n!="number")throw new Error("Invalid ring state - angles must be numbers");const s=y=>{if(!y.includes("/"))return y;const[b,w]=y.split("/");return e&&t?y:e?b:t?w:b},o=Lt.map(s),l=F(r-n),c=F(i-n),h=Ft(l),d=Ft(c);if(h<0||h>=12||d<0||d>=12)throw new Error(`Invalid note indices: root=${h}, mode=${d}`);const f=o[h],g=Bt[d],p=di[g]||null,u=p?Mn[p]:"...";if(!f||!u)throw new Error("Could not determine pitch or mode name");const _=`${f} ${u}`;return{pitch:f,modeName:u,result:_,rootNoteIndex:h,modeDegreeIndex:d,modeKey:p}}catch(e){return E.handle(e,"Logic",()=>{console.warn("Musical result calculation failed")}),{pitch:"C",modeName:"Major",result:"C Major",rootNoteIndex:0,modeDegreeIndex:0,modeKey:"1"}}}const pi=tt.memoize(Gn,Wn,100);function Xn(a,e){try{if(!a||!e)throw new Error("Invalid state or result element");const t=pi(a);e.textContent!==t.result&&(e.textContent=t.result)}catch(t){E.handle(t,"Logic",()=>{e&&(e.textContent="C Major")})}}function Po(a){try{const e=pi(a),t=gi(a);return{...e,labels:t,angles:{pitchClass:a.rings.pitchClass,degree:a.rings.degree,chromatic:a.rings.chromatic,effectivePitch:F(a.rings.pitchClass-a.rings.chromatic),effectiveDegree:F(a.rings.degree-a.rings.chromatic)},display:{sharp:a.display.sharp,flat:a.display.flat}}}catch(e){return E.handle(e,"Logic"),null}}function Gt(a,e=null){const t=performance.now(),r=m.animation,i={fromPitchClass:m.rings.pitchClass,fromDegree:m.rings.degree,fromChrom:m.rings.chromatic,fromHighlight:m.rings.highlightPosition},n={toPitchClass:a.pitchClass??(r==null?void 0:r.to.toPitchClass)??i.fromPitchClass,toDegree:a.degree??(r==null?void 0:r.to.toDegree)??i.fromDegree,toChrom:a.chromatic??(r==null?void 0:r.to.toChrom)??i.fromChrom,toHighlight:a.highlightPosition??(r==null?void 0:r.to.toHighlight)??i.fromHighlight};m.animation={t0:t,from:i,to:n,onComplete:e}}function Kn(a){const e=m.animation;if(!e)return!1;const t=(a-e.t0)/Bn,r=t>=1?1:Un(t),i=(n,s)=>F(n+fi(n,s)*r);return m.rings.pitchClass=i(e.from.fromPitchClass,e.to.toPitchClass),m.rings.degree=i(e.from.fromDegree,e.to.toDegree),m.rings.chromatic=i(e.from.fromChrom,e.to.toChrom),m.rings.highlightPosition=i(e.from.fromHighlight,e.to.toHighlight),r===1&&(e.onComplete&&e.onComplete(),m.animation=null),!0}function _i(a,e){const t=m.rings[a],r=Math.round(-t/G),i=F(-r*G);Gt({[a]:i},e)}function mi(a){const{degree:e,chromatic:t}=m.rings,r=F(e-t),i=F(-r)/G;let n=Nt[0],s=1/0;Nt.forEach(c=>{const h=Math.abs(i-c),d=Math.min(h,12-h);d<s&&(s=d,n=c)});const o=F(-n*G),l=F(o+t);Gt({degree:l,highlightPosition:l},a)}function yi(a){const e=Math.round(-m.rings.chromatic/G),t=F(-e*G),r=fi(m.rings.chromatic,t),i=F(m.rings.pitchClass+r),n=F(m.rings.degree-m.rings.chromatic),s=F(n+t);Gt({pitchClass:i,degree:s,chromatic:t,highlightPosition:s},a)}function bi(){try{if(m.playback.audioContext)return m.playback.audioContext.state==="suspended"?m.playback.audioContext.resume().catch(e=>{E.handle(e,"AudioContext",()=>{m.playback.audioContext=null,bi()})}):Promise.resolve();if(!E.isFeatureSupported("AudioContext"))return console.warn("Web Audio API not supported - audio playback disabled"),Promise.resolve();const a=window.AudioContext||window.webkitAudioContext;return m.playback.audioContext=new a,m.playback.audioContext.addEventListener("statechange",()=>{if(!m.playback.audioContext)return;const e=m.playback.audioContext.state;console.log(`Audio context state changed to: ${e}`),(e==="interrupted"||e==="suspended")&&setTimeout(()=>{var t;((t=m.playback.audioContext)==null?void 0:t.state)==="suspended"&&m.playback.audioContext.resume().catch(r=>{E.handle(r,"AudioContext")})},100)}),m.playback.audioContext.state==="suspended"?m.playback.audioContext.resume().catch(e=>{E.handle(e,"AudioContext",()=>{console.warn("Could not resume audio context - user interaction may be required")})}):Promise.resolve()}catch(a){return E.handle(a,"AudioContext",()=>{console.warn("Audio initialization failed - continuing without audio"),m.playback.audioContext=null}),Promise.resolve()}}function jn(a,e){try{const t=m.playback.audioContext;if(!t){console.warn("No audio context available");return}if(t.state==="closed"){console.warn("Audio context is closed");return}if(typeof a!="number"||a<0)throw new Error(`Invalid chromatic index: ${a}`);typeof e!="number"||e<=0;const r=t.createOscillator(),i=t.createGain(),n=a%12,s=Math.floor(a/12),o=Fn*Math.pow(2,n/12+s);if(o<20||o>2e4)throw new Error(`Frequency out of audible range: ${o}Hz`);r.frequency.setValueAtTime(o,t.currentTime),r.type="sine",r.connect(i),i.connect(t.destination);const l=t.currentTime,c=.01,h=Math.min(.1,e*.3);i.gain.setValueAtTime(0,l),i.gain.linearRampToValueAtTime(.3,l+c),i.gain.setValueAtTime(.3,l+e-h),i.gain.linearRampToValueAtTime(0,l+e),r.start(l),r.stop(l+e),r.addEventListener("ended",()=>{try{r.disconnect(),i.disconnect()}catch{}}),r.addEventListener("error",d=>{E.handle(new Error("Oscillator error"),"AudioContext")})}catch(t){E.handle(t,"AudioContext",()=>{console.warn(`Failed to play note ${a} - continuing silently`)})}}function Qn(){const{pitchClass:a,degree:e,chromatic:t}=m.rings,r=Ft(F(a-t)),i=Ft(F(e-t)),n=Bt[i],s=di[n];if(!s)return[];const l=Pn[s].map(c=>r+c);return l.push(l[0]+12),l}function Ci(){if(!m.playback.isPlaying){lr();return}const a=m.playback.sequence;if(a.length===0){lr();return}const e=a.shift();m.playback.currentNoteIndex=e,jn(e,Yr/1e3);const t=setTimeout(Ci,Yr+Nn);m.playback.timeoutId=t}function Jn(){if(m.playback.isPlaying)return;bi();const a=Qn();a.length!==0&&(m.playback.rootNoteIndexForPlayback=a[0],m.playback.isPlaying=!0,m.playback.sequence=a,Ci())}function lr(){m.playback.isPlaying&&(clearTimeout(m.playback.timeoutId),m.playback.isPlaying=!1,m.playback.currentNoteIndex=null,m.playback.sequence=[],m.playback.timeoutId=null,m.playback.rootNoteIndexForPlayback=null)}const cr="diatonicCompassPreferences",vi="diatonicCompassPreferencesBackup";function Xt(a){try{if(!a||typeof a!="object")throw new Error("Invalid preferences object");if(!E.isFeatureSupported("localStorage"))return console.warn("localStorage not available - preferences will not persist"),!1;const t={...vt()||{},...a},r=kr(t),i=JSON.stringify(r);try{localStorage.setItem(vi,localStorage.getItem(cr)||"{}")}catch{console.warn("Could not create preferences backup")}return localStorage.setItem(cr,i),!0}catch(e){return E.handle(e,"LocalStorage",()=>{console.warn("Preferences could not be saved - will use session defaults")}),!1}}function vt(){try{if(!E.isFeatureSupported("localStorage"))return zt();const a=localStorage.getItem(cr);if(!a)return null;const e=JSON.parse(a),t=kr(e);return JSON.stringify(t)!==a&&(console.log("Preferences were corrected during load - saving updated version"),Xt(t)),t}catch(a){return E.handle(a,"LocalStorage",()=>{const e=Zn();if(e)return console.log("Loaded preferences from backup"),e}),zt()}}function Zn(){try{const a=localStorage.getItem(vi);if(a){const e=JSON.parse(a);return kr(e)}}catch{console.warn("Could not load backup preferences")}return null}function kr(a){if(!a||typeof a!="object")return zt();const e=zt(),t={};for(const[r,i]of Object.entries(e))if(r in a){const n=a[r],s=typeof i;if(typeof n===s)switch(r){case"darkMode":t[r]=!!n;break;case"orientation":t[r]=["horizontal","vertical"].includes(n)?n:i;break;case"volume":t[r]=Math.max(0,Math.min(1,Number(n)))||i;break;case"tutorialCompleted":t[r]=!!n;break;case"beltOrder":if(Array.isArray(n)){const o=["pitch","degree","intervals","chromatic"];o.every(c=>n.includes(c))&&n.length===o.length?t[r]=[...n]:t[r]=i}else t[r]=i;break;case"cursorColor":t[r]=["red","blue","green","yellow"].includes(n)?n:i;break;case"cursorFill":t[r]=!!n;break;default:t[r]=n}else console.warn(`Invalid type for preference ${r}: expected ${s}, got ${typeof n}`),t[r]=i}else t[r]=i;return t}function zt(){return{darkMode:!1,orientation:"horizontal",volume:.5,tutorialCompleted:!1,showAdvancedControls:!1,beltOrder:["pitch","degree","intervals","chromatic"],cursorColor:"red",cursorFill:!1}}const wi=Object.freeze(Object.defineProperty({__proto__:null,loadPreferences:vt,savePreferences:Xt},Symbol.toStringTag,{value:"Module"})),j={toggleAccidental(a){try{if(!["sharp","flat"].includes(a))throw new Error(`Invalid accidental type: ${a}`);const t=!m.display[a],r=a==="sharp"?"flat":"sharp",i=m.display[r];!t&&!i&&(m.display[r]=!0),m.display[a]=t}catch(e){E.handle(e,Q.ERROR_HANDLING.CONTEXTS.UI)}},toggleDarkMode(){try{const a=!m.ui.darkMode;m.ui.darkMode=a,document.body.classList.toggle("dark-mode",a),Xt({darkMode:a})}catch(a){E.handle(a,Q.ERROR_HANDLING.CONTEXTS.UI,()=>{document.body.classList.toggle("dark-mode")})}},togglePlayback(){try{m.playback.isPlaying?lr():!m.drag.active&&!m.animation&&Jn()}catch(a){E.handle(a,Q.ERROR_HANDLING.CONTEXTS.AUDIO)}},toggleSidebar(a){try{const e=typeof a=="boolean"?a:!m.ui.sidebarOpen;m.ui.sidebarOpen=e,m.performance&&(m.performance.needsRedraw=!0)}catch(e){E.handle(e,Q.ERROR_HANDLING.CONTEXTS.UI)}},setOrientation(a){try{if(!["horizontal","vertical"].includes(a))throw new Error(`Invalid orientation: ${a}`);if(m.belts.orientation===a)return;m.belts.orientation=a,m.rings.pitchClass=0,m.rings.degree=0,m.rings.chromatic=0,m.rings.highlightPosition=0,m.belts.init=!1;const e=document.querySelector(".main-container");e&&e.classList.toggle("vertical-layout",a==="vertical")}catch(e){E.handle(e,Q.ERROR_HANDLING.CONTEXTS.UI)}},snapTo(a,e){try{Gt(a,e)}catch(t){E.handle(t,Q.ERROR_HANDLING.CONTEXTS.ANIMATION)}},setRingAngle(a,e){try{if(!["pitchClass","degree","chromatic","highlightPosition"].includes(a))throw new Error(`Invalid ring name: ${a}`);if(typeof e!="number"||!isFinite(e))throw new Error(`Invalid angle value: ${e}`);m.rings[a]=e}catch(t){E.handle(t,Q.ERROR_HANDLING.CONTEXTS.UI)}},setCursorColor(a,e){try{if(!["red","blue","green","yellow"].includes(a))throw new Error(`Invalid cursor color: ${a}`);m.ui.cursorColor=a,m.ui.cursorFill=e,je(async()=>{const{savePreferences:r}=await Promise.resolve().then(()=>wi);return{savePreferences:r}},void 0,import.meta.url).then(({savePreferences:r})=>{r({cursorColor:a,cursorFill:e})}),m.performance&&(m.performance.needsRedraw=!0)}catch(t){E.handle(t,Q.ERROR_HANDLING.CONTEXTS.UI)}},resetRings(){try{m.rings.pitchClass=0,m.rings.degree=0,m.rings.chromatic=0,m.rings.highlightPosition=0}catch(a){E.handle(a,Q.ERROR_HANDLING.CONTEXTS.UI)}},getStateSummary(){try{return{rings:{...m.rings},ui:{sidebarOpen:m.ui.sidebarOpen,darkMode:m.ui.darkMode,display:{sharp:m.display.sharp,flat:m.display.flat}},belts:{orientation:m.belts.orientation,init:m.belts.init},playback:{isPlaying:m.playback.isPlaying},interaction:{isDragging:!!m.drag.active,isAnimating:!!m.animation}}}catch(a){return E.handle(a,Q.ERROR_HANDLING.CONTEXTS.APP),null}}};function ke(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function Ti(a,e){a.prototype=Object.create(e.prototype),a.prototype.constructor=a,a.__proto__=e}/*!
 * GSAP 3.13.0
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var he={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},lt={duration:.5,overwrite:!1,delay:0},Sr,J,H,ge=1e8,N=1/ge,hr=Math.PI*2,es=hr/4,ts=0,xi=Math.sqrt,rs=Math.cos,is=Math.sin,K=function(e){return typeof e=="string"},U=function(e){return typeof e=="function"},Ee=function(e){return typeof e=="number"},Er=function(e){return typeof e>"u"},we=function(e){return typeof e=="object"},re=function(e){return e!==!1},Or=function(){return typeof window<"u"},Mt=function(e){return U(e)||K(e)},ki=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},ee=Array.isArray,ur=/(?:-?\.?\d|\.)+/gi,Si=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,rt=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,Jt=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,Ei=/[+-]=-?[.\d]+/,Oi=/[^,'"\[\]\s]+/gi,ns=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,$,be,dr,Ar,ue={},Ht={},Ai,Pi=function(e){return(Ht=ct(e,ue))&&oe},Pr=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},wt=function(e,t){return!t&&console.warn(e)},Mi=function(e,t){return e&&(ue[e]=t)&&Ht&&(Ht[e]=t)||ue},Tt=function(){return 0},ss={suppressEvents:!0,isStart:!0,kill:!1},It={suppressEvents:!0,kill:!1},os={suppressEvents:!0},Mr={},Le=[],fr={},Ii,ae={},Zt={},Kr=30,Dt=[],Ir="",Dr=function(e){var t=e[0],r,i;if(we(t)||U(t)||(e=[e]),!(r=(t._gsap||{}).harness)){for(i=Dt.length;i--&&!Dt[i].targetTest(t););r=Dt[i]}for(i=e.length;i--;)e[i]&&(e[i]._gsap||(e[i]._gsap=new rn(e[i],r)))||e.splice(i,1);return e},Ye=function(e){return e._gsap||Dr(pe(e))[0]._gsap},Di=function(e,t,r){return(r=e[t])&&U(r)?e[t]():Er(r)&&e.getAttribute&&e.getAttribute(t)||r},ie=function(e,t){return(e=e.split(",")).forEach(t)||e},V=function(e){return Math.round(e*1e5)/1e5||0},Y=function(e){return Math.round(e*1e7)/1e7||0},nt=function(e,t){var r=t.charAt(0),i=parseFloat(t.substr(2));return e=parseFloat(e),r==="+"?e+i:r==="-"?e-i:r==="*"?e*i:e/i},as=function(e,t){for(var r=t.length,i=0;e.indexOf(t[i])<0&&++i<r;);return i<r},$t=function(){var e=Le.length,t=Le.slice(0),r,i;for(fr={},Le.length=0,r=0;r<e;r++)i=t[r],i&&i._lazy&&(i.render(i._lazy[0],i._lazy[1],!0)._lazy=0)},Rr=function(e){return!!(e._initted||e._startAt||e.add)},Ri=function(e,t,r,i){Le.length&&!J&&$t(),e.render(t,r,!!(J&&t<0&&Rr(e))),Le.length&&!J&&$t()},Li=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(Oi).length<2?t:K(e)?e.trim():e},Bi=function(e){return e},de=function(e,t){for(var r in t)r in e||(e[r]=t[r]);return e},ls=function(e){return function(t,r){for(var i in r)i in t||i==="duration"&&e||i==="ease"||(t[i]=r[i])}},ct=function(e,t){for(var r in t)e[r]=t[r];return e},jr=function a(e,t){for(var r in t)r!=="__proto__"&&r!=="constructor"&&r!=="prototype"&&(e[r]=we(t[r])?a(e[r]||(e[r]={}),t[r]):t[r]);return e},qt=function(e,t){var r={},i;for(i in e)i in t||(r[i]=e[i]);return r},yt=function(e){var t=e.parent||$,r=e.keyframes?ls(ee(e.keyframes)):de;if(re(e.inherit))for(;t;)r(e,t.vars.defaults),t=t.parent||t._dp;return e},cs=function(e,t){for(var r=e.length,i=r===t.length;i&&r--&&e[r]===t[r];);return r<0},Ni=function(e,t,r,i,n){var s=e[i],o;if(n)for(o=t[n];s&&s[n]>o;)s=s._prev;return s?(t._next=s._next,s._next=t):(t._next=e[r],e[r]=t),t._next?t._next._prev=t:e[i]=t,t._prev=s,t.parent=t._dp=e,t},Kt=function(e,t,r,i){r===void 0&&(r="_first"),i===void 0&&(i="_last");var n=t._prev,s=t._next;n?n._next=s:e[r]===t&&(e[r]=s),s?s._prev=n:e[i]===t&&(e[i]=n),t._next=t._prev=t.parent=null},Ne=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},Ge=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var r=e;r;)r._dirty=1,r=r.parent;return e},hs=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},gr=function(e,t,r,i){return e._startAt&&(J?e._startAt.revert(It):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,i))},us=function a(e){return!e||e._ts&&a(e.parent)},Qr=function(e){return e._repeat?ht(e._tTime,e=e.duration()+e._rDelay)*e:0},ht=function(e,t){var r=Math.floor(e=Y(e/t));return e&&r===e?r-1:r},Ut=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},jt=function(e){return e._end=Y(e._start+(e._tDur/Math.abs(e._ts||e._rts||N)||0))},Qt=function(e,t){var r=e._dp;return r&&r.smoothChildTiming&&e._ts&&(e._start=Y(r._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),jt(e),r._dirty||Ge(r,e)),e},Fi=function(e,t){var r;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(r=Ut(e.rawTime(),t),(!t._dur||At(0,t.totalDuration(),r)-t._tTime>N)&&t.render(r,!0)),Ge(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(r=e;r._dp;)r.rawTime()>=0&&r.totalTime(r._tTime),r=r._dp;e._zTime=-N}},Ce=function(e,t,r,i){return t.parent&&Ne(t),t._start=Y((Ee(r)?r:r||e!==$?fe(e,r,t):e._time)+t._delay),t._end=Y(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),Ni(e,t,"_first","_last",e._sort?"_start":0),pr(t)||(e._recent=t),i||Fi(e,t),e._ts<0&&Qt(e,e._tTime),e},zi=function(e,t){return(ue.ScrollTrigger||Pr("scrollTrigger",t))&&ue.ScrollTrigger.create(t,e)},Hi=function(e,t,r,i,n){if(Br(e,t,n),!e._initted)return 1;if(!r&&e._pt&&!J&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&Ii!==le.frame)return Le.push(e),e._lazy=[n,i],1},ds=function a(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||a(t))},pr=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},fs=function(e,t,r,i){var n=e.ratio,s=t<0||!t&&(!e._start&&ds(e)&&!(!e._initted&&pr(e))||(e._ts<0||e._dp._ts<0)&&!pr(e))?0:1,o=e._rDelay,l=0,c,h,d;if(o&&e._repeat&&(l=At(0,e._tDur,t),h=ht(l,o),e._yoyo&&h&1&&(s=1-s),h!==ht(e._tTime,o)&&(n=1-s,e.vars.repeatRefresh&&e._initted&&e.invalidate())),s!==n||J||i||e._zTime===N||!t&&e._zTime){if(!e._initted&&Hi(e,t,i,r,l))return;for(d=e._zTime,e._zTime=t||(r?N:0),r||(r=t&&!d),e.ratio=s,e._from&&(s=1-s),e._time=0,e._tTime=l,c=e._pt;c;)c.r(s,c.d),c=c._next;t<0&&gr(e,t,r,!0),e._onUpdate&&!r&&ce(e,"onUpdate"),l&&e._repeat&&!r&&e.parent&&ce(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===s&&(s&&Ne(e,1),!r&&!J&&(ce(e,s?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},gs=function(e,t,r){var i;if(r>t)for(i=e._first;i&&i._start<=r;){if(i.data==="isPause"&&i._start>t)return i;i=i._next}else for(i=e._last;i&&i._start>=r;){if(i.data==="isPause"&&i._start<t)return i;i=i._prev}},ut=function(e,t,r,i){var n=e._repeat,s=Y(t)||0,o=e._tTime/e._tDur;return o&&!i&&(e._time*=s/e._dur),e._dur=s,e._tDur=n?n<0?1e10:Y(s*(n+1)+e._rDelay*n):s,o>0&&!i&&Qt(e,e._tTime=e._tDur*o),e.parent&&jt(e),r||Ge(e.parent,e),e},Jr=function(e){return e instanceof te?Ge(e):ut(e,e._dur)},ps={_start:0,endTime:Tt,totalDuration:Tt},fe=function a(e,t,r){var i=e.labels,n=e._recent||ps,s=e.duration()>=ge?n.endTime(!1):e._dur,o,l,c;return K(t)&&(isNaN(t)||t in i)?(l=t.charAt(0),c=t.substr(-1)==="%",o=t.indexOf("="),l==="<"||l===">"?(o>=0&&(t=t.replace(/=/,"")),(l==="<"?n._start:n.endTime(n._repeat>=0))+(parseFloat(t.substr(1))||0)*(c?(o<0?n:r).totalDuration()/100:1)):o<0?(t in i||(i[t]=s),i[t]):(l=parseFloat(t.charAt(o-1)+t.substr(o+1)),c&&r&&(l=l/100*(ee(r)?r[0]:r).totalDuration()),o>1?a(e,t.substr(0,o-1),r)+l:s+l)):t==null?s:+t},bt=function(e,t,r){var i=Ee(t[1]),n=(i?2:1)+(e<2?0:1),s=t[n],o,l;if(i&&(s.duration=t[1]),s.parent=r,e){for(o=s,l=r;l&&!("immediateRender"in o);)o=l.vars.defaults||{},l=re(l.vars.inherit)&&l.parent;s.immediateRender=re(o.immediateRender),e<2?s.runBackwards=1:s.startAt=t[n-1]}return new W(t[0],s,t[n+1])},ze=function(e,t){return e||e===0?t(e):t},At=function(e,t,r){return r<e?e:r>t?t:r},Z=function(e,t){return!K(e)||!(t=ns.exec(e))?"":t[1]},_s=function(e,t,r){return ze(r,function(i){return At(e,t,i)})},_r=[].slice,$i=function(e,t){return e&&we(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&we(e[0]))&&!e.nodeType&&e!==be},ms=function(e,t,r){return r===void 0&&(r=[]),e.forEach(function(i){var n;return K(i)&&!t||$i(i,1)?(n=r).push.apply(n,pe(i)):r.push(i)})||r},pe=function(e,t,r){return H&&!t&&H.selector?H.selector(e):K(e)&&!r&&(dr||!dt())?_r.call((t||Ar).querySelectorAll(e),0):ee(e)?ms(e,r):$i(e)?_r.call(e,0):e?[e]:[]},mr=function(e){return e=pe(e)[0]||wt("Invalid scope")||{},function(t){var r=e.current||e.nativeElement||e;return pe(t,r.querySelectorAll?r:r===e?wt("Invalid scope")||Ar.createElement("div"):e)}},qi=function(e){return e.sort(function(){return .5-Math.random()})},Ui=function(e){if(U(e))return e;var t=we(e)?e:{each:e},r=Xe(t.ease),i=t.from||0,n=parseFloat(t.base)||0,s={},o=i>0&&i<1,l=isNaN(i)||o,c=t.axis,h=i,d=i;return K(i)?h=d={center:.5,edges:.5,end:1}[i]||0:!o&&l&&(h=i[0],d=i[1]),function(f,g,p){var u=(p||t).length,_=s[u],y,b,w,T,C,S,x,k,v;if(!_){if(v=t.grid==="auto"?0:(t.grid||[1,ge])[1],!v){for(x=-ge;x<(x=p[v++].getBoundingClientRect().left)&&v<u;);v<u&&v--}for(_=s[u]=[],y=l?Math.min(v,u)*h-.5:i%v,b=v===ge?0:l?u*d/v-.5:i/v|0,x=0,k=ge,S=0;S<u;S++)w=S%v-y,T=b-(S/v|0),_[S]=C=c?Math.abs(c==="y"?T:w):xi(w*w+T*T),C>x&&(x=C),C<k&&(k=C);i==="random"&&qi(_),_.max=x-k,_.min=k,_.v=u=(parseFloat(t.amount)||parseFloat(t.each)*(v>u?u-1:c?c==="y"?u/v:v:Math.max(v,u/v))||0)*(i==="edges"?-1:1),_.b=u<0?n-u:n,_.u=Z(t.amount||t.each)||0,r=r&&u<0?Zi(r):r}return u=(_[f]-_.min)/_.max||0,Y(_.b+(r?r(u):u)*_.v)+_.u}},yr=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(r){var i=Y(Math.round(parseFloat(r)/e)*e*t);return(i-i%1)/t+(Ee(r)?0:Z(r))}},Vi=function(e,t){var r=ee(e),i,n;return!r&&we(e)&&(i=r=e.radius||ge,e.values?(e=pe(e.values),(n=!Ee(e[0]))&&(i*=i)):e=yr(e.increment)),ze(t,r?U(e)?function(s){return n=e(s),Math.abs(n-s)<=i?n:s}:function(s){for(var o=parseFloat(n?s.x:s),l=parseFloat(n?s.y:0),c=ge,h=0,d=e.length,f,g;d--;)n?(f=e[d].x-o,g=e[d].y-l,f=f*f+g*g):f=Math.abs(e[d]-o),f<c&&(c=f,h=d);return h=!i||c<=i?e[h]:s,n||h===s||Ee(s)?h:h+Z(s)}:yr(e))},Wi=function(e,t,r,i){return ze(ee(e)?!t:r===!0?!!(r=0):!i,function(){return ee(e)?e[~~(Math.random()*e.length)]:(r=r||1e-5)&&(i=r<1?Math.pow(10,(r+"").length-2):1)&&Math.floor(Math.round((e-r/2+Math.random()*(t-e+r*.99))/r)*r*i)/i})},ys=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(i){return t.reduce(function(n,s){return s(n)},i)}},bs=function(e,t){return function(r){return e(parseFloat(r))+(t||Z(r))}},Cs=function(e,t,r){return Gi(e,t,0,1,r)},Yi=function(e,t,r){return ze(r,function(i){return e[~~t(i)]})},vs=function a(e,t,r){var i=t-e;return ee(e)?Yi(e,a(0,e.length),t):ze(r,function(n){return(i+(n-e)%i)%i+e})},ws=function a(e,t,r){var i=t-e,n=i*2;return ee(e)?Yi(e,a(0,e.length-1),t):ze(r,function(s){return s=(n+(s-e)%n)%n||0,e+(s>i?n-s:s)})},xt=function(e){for(var t=0,r="",i,n,s,o;~(i=e.indexOf("random(",t));)s=e.indexOf(")",i),o=e.charAt(i+7)==="[",n=e.substr(i+7,s-i-7).match(o?Oi:ur),r+=e.substr(t,i-t)+Wi(o?n:+n[0],o?0:+n[1],+n[2]||1e-5),t=s+1;return r+e.substr(t,e.length-t)},Gi=function(e,t,r,i,n){var s=t-e,o=i-r;return ze(n,function(l){return r+((l-e)/s*o||0)})},Ts=function a(e,t,r,i){var n=isNaN(e+t)?0:function(g){return(1-g)*e+g*t};if(!n){var s=K(e),o={},l,c,h,d,f;if(r===!0&&(i=1)&&(r=null),s)e={p:e},t={p:t};else if(ee(e)&&!ee(t)){for(h=[],d=e.length,f=d-2,c=1;c<d;c++)h.push(a(e[c-1],e[c]));d--,n=function(p){p*=d;var u=Math.min(f,~~p);return h[u](p-u)},r=t}else i||(e=ct(ee(e)?[]:{},e));if(!h){for(l in t)Lr.call(o,e,l,"get",t[l]);n=function(p){return zr(p,o)||(s?e.p:e)}}}return ze(r,n)},Zr=function(e,t,r){var i=e.labels,n=ge,s,o,l;for(s in i)o=i[s]-t,o<0==!!r&&o&&n>(o=Math.abs(o))&&(l=s,n=o);return l},ce=function(e,t,r){var i=e.vars,n=i[t],s=H,o=e._ctx,l,c,h;if(n)return l=i[t+"Params"],c=i.callbackScope||e,r&&Le.length&&$t(),o&&(H=o),h=l?n.apply(c,l):n.call(c),H=s,h},_t=function(e){return Ne(e),e.scrollTrigger&&e.scrollTrigger.kill(!!J),e.progress()<1&&ce(e,"onInterrupt"),e},it,Xi=[],Ki=function(e){if(e)if(e=!e.name&&e.default||e,Or()||e.headless){var t=e.name,r=U(e),i=t&&!r&&e.init?function(){this._props=[]}:e,n={init:Tt,render:zr,add:Lr,kill:zs,modifier:Fs,rawVars:0},s={targetTest:0,get:0,getSetter:Fr,aliases:{},register:0};if(dt(),e!==i){if(ae[t])return;de(i,de(qt(e,n),s)),ct(i.prototype,ct(n,qt(e,s))),ae[i.prop=t]=i,e.targetTest&&(Dt.push(i),Mr[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}Mi(t,i),e.register&&e.register(oe,i,ne)}else Xi.push(e)},B=255,mt={aqua:[0,B,B],lime:[0,B,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,B],navy:[0,0,128],white:[B,B,B],olive:[128,128,0],yellow:[B,B,0],orange:[B,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[B,0,0],pink:[B,192,203],cyan:[0,B,B],transparent:[B,B,B,0]},er=function(e,t,r){return e+=e<0?1:e>1?-1:0,(e*6<1?t+(r-t)*e*6:e<.5?r:e*3<2?t+(r-t)*(2/3-e)*6:t)*B+.5|0},ji=function(e,t,r){var i=e?Ee(e)?[e>>16,e>>8&B,e&B]:0:mt.black,n,s,o,l,c,h,d,f,g,p;if(!i){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),mt[e])i=mt[e];else if(e.charAt(0)==="#"){if(e.length<6&&(n=e.charAt(1),s=e.charAt(2),o=e.charAt(3),e="#"+n+n+s+s+o+o+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return i=parseInt(e.substr(1,6),16),[i>>16,i>>8&B,i&B,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),i=[e>>16,e>>8&B,e&B]}else if(e.substr(0,3)==="hsl"){if(i=p=e.match(ur),!t)l=+i[0]%360/360,c=+i[1]/100,h=+i[2]/100,s=h<=.5?h*(c+1):h+c-h*c,n=h*2-s,i.length>3&&(i[3]*=1),i[0]=er(l+1/3,n,s),i[1]=er(l,n,s),i[2]=er(l-1/3,n,s);else if(~e.indexOf("="))return i=e.match(Si),r&&i.length<4&&(i[3]=1),i}else i=e.match(ur)||mt.transparent;i=i.map(Number)}return t&&!p&&(n=i[0]/B,s=i[1]/B,o=i[2]/B,d=Math.max(n,s,o),f=Math.min(n,s,o),h=(d+f)/2,d===f?l=c=0:(g=d-f,c=h>.5?g/(2-d-f):g/(d+f),l=d===n?(s-o)/g+(s<o?6:0):d===s?(o-n)/g+2:(n-s)/g+4,l*=60),i[0]=~~(l+.5),i[1]=~~(c*100+.5),i[2]=~~(h*100+.5)),r&&i.length<4&&(i[3]=1),i},Qi=function(e){var t=[],r=[],i=-1;return e.split(Be).forEach(function(n){var s=n.match(rt)||[];t.push.apply(t,s),r.push(i+=s.length+1)}),t.c=r,t},ei=function(e,t,r){var i="",n=(e+i).match(Be),s=t?"hsla(":"rgba(",o=0,l,c,h,d;if(!n)return e;if(n=n.map(function(f){return(f=ji(f,t,1))&&s+(t?f[0]+","+f[1]+"%,"+f[2]+"%,"+f[3]:f.join(","))+")"}),r&&(h=Qi(e),l=r.c,l.join(i)!==h.c.join(i)))for(c=e.replace(Be,"1").split(rt),d=c.length-1;o<d;o++)i+=c[o]+(~l.indexOf(o)?n.shift()||s+"0,0,0,0)":(h.length?h:n.length?n:r).shift());if(!c)for(c=e.split(Be),d=c.length-1;o<d;o++)i+=c[o]+n[o];return i+c[d]},Be=function(){var a="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in mt)a+="|"+e+"\\b";return new RegExp(a+")","gi")}(),xs=/hsl[a]?\(/,Ji=function(e){var t=e.join(" "),r;if(Be.lastIndex=0,Be.test(t))return r=xs.test(t),e[1]=ei(e[1],r),e[0]=ei(e[0],r,Qi(e[1])),!0},kt,le=function(){var a=Date.now,e=500,t=33,r=a(),i=r,n=1e3/240,s=n,o=[],l,c,h,d,f,g,p=function u(_){var y=a()-i,b=_===!0,w,T,C,S;if((y>e||y<0)&&(r+=y-t),i+=y,C=i-r,w=C-s,(w>0||b)&&(S=++d.frame,f=C-d.time*1e3,d.time=C=C/1e3,s+=w+(w>=n?4:n-w),T=1),b||(l=c(u)),T)for(g=0;g<o.length;g++)o[g](C,f,S,_)};return d={time:0,frame:0,tick:function(){p(!0)},deltaRatio:function(_){return f/(1e3/(_||60))},wake:function(){Ai&&(!dr&&Or()&&(be=dr=window,Ar=be.document||{},ue.gsap=oe,(be.gsapVersions||(be.gsapVersions=[])).push(oe.version),Pi(Ht||be.GreenSockGlobals||!be.gsap&&be||{}),Xi.forEach(Ki)),h=typeof requestAnimationFrame<"u"&&requestAnimationFrame,l&&d.sleep(),c=h||function(_){return setTimeout(_,s-d.time*1e3+1|0)},kt=1,p(2))},sleep:function(){(h?cancelAnimationFrame:clearTimeout)(l),kt=0,c=Tt},lagSmoothing:function(_,y){e=_||1/0,t=Math.min(y||33,e)},fps:function(_){n=1e3/(_||240),s=d.time*1e3+n},add:function(_,y,b){var w=y?function(T,C,S,x){_(T,C,S,x),d.remove(w)}:_;return d.remove(_),o[b?"unshift":"push"](w),dt(),w},remove:function(_,y){~(y=o.indexOf(_))&&o.splice(y,1)&&g>=y&&g--},_listeners:o},d}(),dt=function(){return!kt&&le.wake()},A={},ks=/^[\d.\-M][\d.\-,\s]/,Ss=/["']/g,Es=function(e){for(var t={},r=e.substr(1,e.length-3).split(":"),i=r[0],n=1,s=r.length,o,l,c;n<s;n++)l=r[n],o=n!==s-1?l.lastIndexOf(","):l.length,c=l.substr(0,o),t[i]=isNaN(c)?c.replace(Ss,"").trim():+c,i=l.substr(o+1).trim();return t},Os=function(e){var t=e.indexOf("(")+1,r=e.indexOf(")"),i=e.indexOf("(",t);return e.substring(t,~i&&i<r?e.indexOf(")",r+1):r)},As=function(e){var t=(e+"").split("("),r=A[t[0]];return r&&t.length>1&&r.config?r.config.apply(null,~e.indexOf("{")?[Es(t[1])]:Os(e).split(",").map(Li)):A._CE&&ks.test(e)?A._CE("",e):r},Zi=function(e){return function(t){return 1-e(1-t)}},en=function a(e,t){for(var r=e._first,i;r;)r instanceof te?a(r,t):r.vars.yoyoEase&&(!r._yoyo||!r._repeat)&&r._yoyo!==t&&(r.timeline?a(r.timeline,t):(i=r._ease,r._ease=r._yEase,r._yEase=i,r._yoyo=t)),r=r._next},Xe=function(e,t){return e&&(U(e)?e:A[e]||As(e))||t},Ze=function(e,t,r,i){r===void 0&&(r=function(l){return 1-t(1-l)}),i===void 0&&(i=function(l){return l<.5?t(l*2)/2:1-t((1-l)*2)/2});var n={easeIn:t,easeOut:r,easeInOut:i},s;return ie(e,function(o){A[o]=ue[o]=n,A[s=o.toLowerCase()]=r;for(var l in n)A[s+(l==="easeIn"?".in":l==="easeOut"?".out":".inOut")]=A[o+"."+l]=n[l]}),n},tn=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},tr=function a(e,t,r){var i=t>=1?t:1,n=(r||(e?.3:.45))/(t<1?t:1),s=n/hr*(Math.asin(1/i)||0),o=function(h){return h===1?1:i*Math.pow(2,-10*h)*is((h-s)*n)+1},l=e==="out"?o:e==="in"?function(c){return 1-o(1-c)}:tn(o);return n=hr/n,l.config=function(c,h){return a(e,c,h)},l},rr=function a(e,t){t===void 0&&(t=1.70158);var r=function(s){return s?--s*s*((t+1)*s+t)+1:0},i=e==="out"?r:e==="in"?function(n){return 1-r(1-n)}:tn(r);return i.config=function(n){return a(e,n)},i};ie("Linear,Quad,Cubic,Quart,Quint,Strong",function(a,e){var t=e<5?e+1:e;Ze(a+",Power"+(t-1),e?function(r){return Math.pow(r,t)}:function(r){return r},function(r){return 1-Math.pow(1-r,t)},function(r){return r<.5?Math.pow(r*2,t)/2:1-Math.pow((1-r)*2,t)/2})});A.Linear.easeNone=A.none=A.Linear.easeIn;Ze("Elastic",tr("in"),tr("out"),tr());(function(a,e){var t=1/e,r=2*t,i=2.5*t,n=function(o){return o<t?a*o*o:o<r?a*Math.pow(o-1.5/e,2)+.75:o<i?a*(o-=2.25/e)*o+.9375:a*Math.pow(o-2.625/e,2)+.984375};Ze("Bounce",function(s){return 1-n(1-s)},n)})(7.5625,2.75);Ze("Expo",function(a){return Math.pow(2,10*(a-1))*a+a*a*a*a*a*a*(1-a)});Ze("Circ",function(a){return-(xi(1-a*a)-1)});Ze("Sine",function(a){return a===1?1:-rs(a*es)+1});Ze("Back",rr("in"),rr("out"),rr());A.SteppedEase=A.steps=ue.SteppedEase={config:function(e,t){e===void 0&&(e=1);var r=1/e,i=e+(t?0:1),n=t?1:0,s=1-N;return function(o){return((i*At(0,s,o)|0)+n)*r}}};lt.ease=A["quad.out"];ie("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(a){return Ir+=a+","+a+"Params,"});var rn=function(e,t){this.id=ts++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:Di,this.set=t?t.getSetter:Fr},St=function(){function a(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,ut(this,+t.duration,1,1),this.data=t.data,H&&(this._ctx=H,H.data.push(this)),kt||le.wake()}var e=a.prototype;return e.delay=function(r){return r||r===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+r-this._delay),this._delay=r,this):this._delay},e.duration=function(r){return arguments.length?this.totalDuration(this._repeat>0?r+(r+this._rDelay)*this._repeat:r):this.totalDuration()&&this._dur},e.totalDuration=function(r){return arguments.length?(this._dirty=0,ut(this,this._repeat<0?r:(r-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(r,i){if(dt(),!arguments.length)return this._tTime;var n=this._dp;if(n&&n.smoothChildTiming&&this._ts){for(Qt(this,r),!n._dp||n.parent||Fi(n,this);n&&n.parent;)n.parent._time!==n._start+(n._ts>=0?n._tTime/n._ts:(n.totalDuration()-n._tTime)/-n._ts)&&n.totalTime(n._tTime,!0),n=n.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&r<this._tDur||this._ts<0&&r>0||!this._tDur&&!r)&&Ce(this._dp,this,this._start-this._delay)}return(this._tTime!==r||!this._dur&&!i||this._initted&&Math.abs(this._zTime)===N||!r&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=r),Ri(this,r,i)),this},e.time=function(r,i){return arguments.length?this.totalTime(Math.min(this.totalDuration(),r+Qr(this))%(this._dur+this._rDelay)||(r?this._dur:0),i):this._time},e.totalProgress=function(r,i){return arguments.length?this.totalTime(this.totalDuration()*r,i):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>=0&&this._initted?1:0},e.progress=function(r,i){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-r:r)+Qr(this),i):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(r,i){var n=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(r-1)*n,i):this._repeat?ht(this._tTime,n)+1:1},e.timeScale=function(r,i){if(!arguments.length)return this._rts===-N?0:this._rts;if(this._rts===r)return this;var n=this.parent&&this._ts?Ut(this.parent._time,this):this._tTime;return this._rts=+r||0,this._ts=this._ps||r===-N?0:this._rts,this.totalTime(At(-Math.abs(this._delay),this.totalDuration(),n),i!==!1),jt(this),hs(this)},e.paused=function(r){return arguments.length?(this._ps!==r&&(this._ps=r,r?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(dt(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==N&&(this._tTime-=N)))),this):this._ps},e.startTime=function(r){if(arguments.length){this._start=r;var i=this.parent||this._dp;return i&&(i._sort||!this.parent)&&Ce(i,this,r-this._delay),this}return this._start},e.endTime=function(r){return this._start+(re(r)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(r){var i=this.parent||this._dp;return i?r&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Ut(i.rawTime(r),this):this._tTime:this._tTime},e.revert=function(r){r===void 0&&(r=os);var i=J;return J=r,Rr(this)&&(this.timeline&&this.timeline.revert(r),this.totalTime(-.01,r.suppressEvents)),this.data!=="nested"&&r.kill!==!1&&this.kill(),J=i,this},e.globalTime=function(r){for(var i=this,n=arguments.length?r:i.rawTime();i;)n=i._start+n/(Math.abs(i._ts)||1),i=i._dp;return!this.parent&&this._sat?this._sat.globalTime(r):n},e.repeat=function(r){return arguments.length?(this._repeat=r===1/0?-2:r,Jr(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(r){if(arguments.length){var i=this._time;return this._rDelay=r,Jr(this),i?this.time(i):this}return this._rDelay},e.yoyo=function(r){return arguments.length?(this._yoyo=r,this):this._yoyo},e.seek=function(r,i){return this.totalTime(fe(this,r),re(i))},e.restart=function(r,i){return this.play().totalTime(r?-this._delay:0,re(i)),this._dur||(this._zTime=-N),this},e.play=function(r,i){return r!=null&&this.seek(r,i),this.reversed(!1).paused(!1)},e.reverse=function(r,i){return r!=null&&this.seek(r||this.totalDuration(),i),this.reversed(!0).paused(!1)},e.pause=function(r,i){return r!=null&&this.seek(r,i),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(r){return arguments.length?(!!r!==this.reversed()&&this.timeScale(-this._rts||(r?-N:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-N,this},e.isActive=function(){var r=this.parent||this._dp,i=this._start,n;return!!(!r||this._ts&&this._initted&&r.isActive()&&(n=r.rawTime(!0))>=i&&n<this.endTime(!0)-N)},e.eventCallback=function(r,i,n){var s=this.vars;return arguments.length>1?(i?(s[r]=i,n&&(s[r+"Params"]=n),r==="onUpdate"&&(this._onUpdate=i)):delete s[r],this):s[r]},e.then=function(r){var i=this;return new Promise(function(n){var s=U(r)?r:Bi,o=function(){var c=i.then;i.then=null,U(s)&&(s=s(i))&&(s.then||s===i)&&(i.then=c),n(s),i.then=c};i._initted&&i.totalProgress()===1&&i._ts>=0||!i._tTime&&i._ts<0?o():i._prom=o})},e.kill=function(){_t(this)},a}();de(St.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-N,_prom:0,_ps:!1,_rts:1});var te=function(a){Ti(e,a);function e(r,i){var n;return r===void 0&&(r={}),n=a.call(this,r)||this,n.labels={},n.smoothChildTiming=!!r.smoothChildTiming,n.autoRemoveChildren=!!r.autoRemoveChildren,n._sort=re(r.sortChildren),$&&Ce(r.parent||$,ke(n),i),r.reversed&&n.reverse(),r.paused&&n.paused(!0),r.scrollTrigger&&zi(ke(n),r.scrollTrigger),n}var t=e.prototype;return t.to=function(i,n,s){return bt(0,arguments,this),this},t.from=function(i,n,s){return bt(1,arguments,this),this},t.fromTo=function(i,n,s,o){return bt(2,arguments,this),this},t.set=function(i,n,s){return n.duration=0,n.parent=this,yt(n).repeatDelay||(n.repeat=0),n.immediateRender=!!n.immediateRender,new W(i,n,fe(this,s),1),this},t.call=function(i,n,s){return Ce(this,W.delayedCall(0,i,n),s)},t.staggerTo=function(i,n,s,o,l,c,h){return s.duration=n,s.stagger=s.stagger||o,s.onComplete=c,s.onCompleteParams=h,s.parent=this,new W(i,s,fe(this,l)),this},t.staggerFrom=function(i,n,s,o,l,c,h){return s.runBackwards=1,yt(s).immediateRender=re(s.immediateRender),this.staggerTo(i,n,s,o,l,c,h)},t.staggerFromTo=function(i,n,s,o,l,c,h,d){return o.startAt=s,yt(o).immediateRender=re(o.immediateRender),this.staggerTo(i,n,o,l,c,h,d)},t.render=function(i,n,s){var o=this._time,l=this._dirty?this.totalDuration():this._tDur,c=this._dur,h=i<=0?0:Y(i),d=this._zTime<0!=i<0&&(this._initted||!c),f,g,p,u,_,y,b,w,T,C,S,x;if(this!==$&&h>l&&i>=0&&(h=l),h!==this._tTime||s||d){if(o!==this._time&&c&&(h+=this._time-o,i+=this._time-o),f=h,T=this._start,w=this._ts,y=!w,d&&(c||(o=this._zTime),(i||!n)&&(this._zTime=i)),this._repeat){if(S=this._yoyo,_=c+this._rDelay,this._repeat<-1&&i<0)return this.totalTime(_*100+i,n,s);if(f=Y(h%_),h===l?(u=this._repeat,f=c):(C=Y(h/_),u=~~C,u&&u===C&&(f=c,u--),f>c&&(f=c)),C=ht(this._tTime,_),!o&&this._tTime&&C!==u&&this._tTime-C*_-this._dur<=0&&(C=u),S&&u&1&&(f=c-f,x=1),u!==C&&!this._lock){var k=S&&C&1,v=k===(S&&u&1);if(u<C&&(k=!k),o=k?0:h%c?c:h,this._lock=1,this.render(o||(x?0:Y(u*_)),n,!c)._lock=0,this._tTime=h,!n&&this.parent&&ce(this,"onRepeat"),this.vars.repeatRefresh&&!x&&(this.invalidate()._lock=1),o&&o!==this._time||y!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(c=this._dur,l=this._tDur,v&&(this._lock=2,o=k?c:-1e-4,this.render(o,!0),this.vars.repeatRefresh&&!x&&this.invalidate()),this._lock=0,!this._ts&&!y)return this;en(this,x)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(b=gs(this,Y(o),Y(f)),b&&(h-=f-(f=b._start))),this._tTime=h,this._time=f,this._act=!w,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=i,o=0),!o&&h&&!n&&!C&&(ce(this,"onStart"),this._tTime!==h))return this;if(f>=o&&i>=0)for(g=this._first;g;){if(p=g._next,(g._act||f>=g._start)&&g._ts&&b!==g){if(g.parent!==this)return this.render(i,n,s);if(g.render(g._ts>0?(f-g._start)*g._ts:(g._dirty?g.totalDuration():g._tDur)+(f-g._start)*g._ts,n,s),f!==this._time||!this._ts&&!y){b=0,p&&(h+=this._zTime=-N);break}}g=p}else{g=this._last;for(var O=i<0?i:f;g;){if(p=g._prev,(g._act||O<=g._end)&&g._ts&&b!==g){if(g.parent!==this)return this.render(i,n,s);if(g.render(g._ts>0?(O-g._start)*g._ts:(g._dirty?g.totalDuration():g._tDur)+(O-g._start)*g._ts,n,s||J&&Rr(g)),f!==this._time||!this._ts&&!y){b=0,p&&(h+=this._zTime=O?-N:N);break}}g=p}}if(b&&!n&&(this.pause(),b.render(f>=o?0:-N)._zTime=f>=o?1:-1,this._ts))return this._start=T,jt(this),this.render(i,n,s);this._onUpdate&&!n&&ce(this,"onUpdate",!0),(h===l&&this._tTime>=this.totalDuration()||!h&&o)&&(T===this._start||Math.abs(w)!==Math.abs(this._ts))&&(this._lock||((i||!c)&&(h===l&&this._ts>0||!h&&this._ts<0)&&Ne(this,1),!n&&!(i<0&&!o)&&(h||o||!l)&&(ce(this,h===l&&i>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(h<l&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(i,n){var s=this;if(Ee(n)||(n=fe(this,n,i)),!(i instanceof St)){if(ee(i))return i.forEach(function(o){return s.add(o,n)}),this;if(K(i))return this.addLabel(i,n);if(U(i))i=W.delayedCall(0,i);else return this}return this!==i?Ce(this,i,n):this},t.getChildren=function(i,n,s,o){i===void 0&&(i=!0),n===void 0&&(n=!0),s===void 0&&(s=!0),o===void 0&&(o=-ge);for(var l=[],c=this._first;c;)c._start>=o&&(c instanceof W?n&&l.push(c):(s&&l.push(c),i&&l.push.apply(l,c.getChildren(!0,n,s)))),c=c._next;return l},t.getById=function(i){for(var n=this.getChildren(1,1,1),s=n.length;s--;)if(n[s].vars.id===i)return n[s]},t.remove=function(i){return K(i)?this.removeLabel(i):U(i)?this.killTweensOf(i):(i.parent===this&&Kt(this,i),i===this._recent&&(this._recent=this._last),Ge(this))},t.totalTime=function(i,n){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=Y(le.time-(this._ts>0?i/this._ts:(this.totalDuration()-i)/-this._ts))),a.prototype.totalTime.call(this,i,n),this._forcing=0,this):this._tTime},t.addLabel=function(i,n){return this.labels[i]=fe(this,n),this},t.removeLabel=function(i){return delete this.labels[i],this},t.addPause=function(i,n,s){var o=W.delayedCall(0,n||Tt,s);return o.data="isPause",this._hasPause=1,Ce(this,o,fe(this,i))},t.removePause=function(i){var n=this._first;for(i=fe(this,i);n;)n._start===i&&n.data==="isPause"&&Ne(n),n=n._next},t.killTweensOf=function(i,n,s){for(var o=this.getTweensOf(i,s),l=o.length;l--;)Ie!==o[l]&&o[l].kill(i,n);return this},t.getTweensOf=function(i,n){for(var s=[],o=pe(i),l=this._first,c=Ee(n),h;l;)l instanceof W?as(l._targets,o)&&(c?(!Ie||l._initted&&l._ts)&&l.globalTime(0)<=n&&l.globalTime(l.totalDuration())>n:!n||l.isActive())&&s.push(l):(h=l.getTweensOf(o,n)).length&&s.push.apply(s,h),l=l._next;return s},t.tweenTo=function(i,n){n=n||{};var s=this,o=fe(s,i),l=n,c=l.startAt,h=l.onStart,d=l.onStartParams,f=l.immediateRender,g,p=W.to(s,de({ease:n.ease||"none",lazy:!1,immediateRender:!1,time:o,overwrite:"auto",duration:n.duration||Math.abs((o-(c&&"time"in c?c.time:s._time))/s.timeScale())||N,onStart:function(){if(s.pause(),!g){var _=n.duration||Math.abs((o-(c&&"time"in c?c.time:s._time))/s.timeScale());p._dur!==_&&ut(p,_,0,1).render(p._time,!0,!0),g=1}h&&h.apply(p,d||[])}},n));return f?p.render(0):p},t.tweenFromTo=function(i,n,s){return this.tweenTo(n,de({startAt:{time:fe(this,i)}},s))},t.recent=function(){return this._recent},t.nextLabel=function(i){return i===void 0&&(i=this._time),Zr(this,fe(this,i))},t.previousLabel=function(i){return i===void 0&&(i=this._time),Zr(this,fe(this,i),1)},t.currentLabel=function(i){return arguments.length?this.seek(i,!0):this.previousLabel(this._time+N)},t.shiftChildren=function(i,n,s){s===void 0&&(s=0);for(var o=this._first,l=this.labels,c;o;)o._start>=s&&(o._start+=i,o._end+=i),o=o._next;if(n)for(c in l)l[c]>=s&&(l[c]+=i);return Ge(this)},t.invalidate=function(i){var n=this._first;for(this._lock=0;n;)n.invalidate(i),n=n._next;return a.prototype.invalidate.call(this,i)},t.clear=function(i){i===void 0&&(i=!0);for(var n=this._first,s;n;)s=n._next,this.remove(n),n=s;return this._dp&&(this._time=this._tTime=this._pTime=0),i&&(this.labels={}),Ge(this)},t.totalDuration=function(i){var n=0,s=this,o=s._last,l=ge,c,h,d;if(arguments.length)return s.timeScale((s._repeat<0?s.duration():s.totalDuration())/(s.reversed()?-i:i));if(s._dirty){for(d=s.parent;o;)c=o._prev,o._dirty&&o.totalDuration(),h=o._start,h>l&&s._sort&&o._ts&&!s._lock?(s._lock=1,Ce(s,o,h-o._delay,1)._lock=0):l=h,h<0&&o._ts&&(n-=h,(!d&&!s._dp||d&&d.smoothChildTiming)&&(s._start+=h/s._ts,s._time-=h,s._tTime-=h),s.shiftChildren(-h,!1,-1/0),l=0),o._end>n&&o._ts&&(n=o._end),o=c;ut(s,s===$&&s._time>n?s._time:n,1,1),s._dirty=0}return s._tDur},e.updateRoot=function(i){if($._ts&&(Ri($,Ut(i,$)),Ii=le.frame),le.frame>=Kr){Kr+=he.autoSleep||120;var n=$._first;if((!n||!n._ts)&&he.autoSleep&&le._listeners.length<2){for(;n&&!n._ts;)n=n._next;n||le.sleep()}}},e}(St);de(te.prototype,{_lock:0,_hasPause:0,_forcing:0});var Ps=function(e,t,r,i,n,s,o){var l=new ne(this._pt,e,t,0,1,cn,null,n),c=0,h=0,d,f,g,p,u,_,y,b;for(l.b=r,l.e=i,r+="",i+="",(y=~i.indexOf("random("))&&(i=xt(i)),s&&(b=[r,i],s(b,e,t),r=b[0],i=b[1]),f=r.match(Jt)||[];d=Jt.exec(i);)p=d[0],u=i.substring(c,d.index),g?g=(g+1)%5:u.substr(-5)==="rgba("&&(g=1),p!==f[h++]&&(_=parseFloat(f[h-1])||0,l._pt={_next:l._pt,p:u||h===1?u:",",s:_,c:p.charAt(1)==="="?nt(_,p)-_:parseFloat(p)-_,m:g&&g<4?Math.round:0},c=Jt.lastIndex);return l.c=c<i.length?i.substring(c,i.length):"",l.fp=o,(Ei.test(i)||y)&&(l.e=0),this._pt=l,l},Lr=function(e,t,r,i,n,s,o,l,c,h){U(i)&&(i=i(n||0,e,s));var d=e[t],f=r!=="get"?r:U(d)?c?e[t.indexOf("set")||!U(e["get"+t.substr(3)])?t:"get"+t.substr(3)](c):e[t]():d,g=U(d)?c?Ls:an:Nr,p;if(K(i)&&(~i.indexOf("random(")&&(i=xt(i)),i.charAt(1)==="="&&(p=nt(f,i)+(Z(f)||0),(p||p===0)&&(i=p))),!h||f!==i||br)return!isNaN(f*i)&&i!==""?(p=new ne(this._pt,e,t,+f||0,i-(f||0),typeof d=="boolean"?Ns:ln,0,g),c&&(p.fp=c),o&&p.modifier(o,this,e),this._pt=p):(!d&&!(t in e)&&Pr(t,i),Ps.call(this,e,t,f,i,g,l||he.stringFilter,c))},Ms=function(e,t,r,i,n){if(U(e)&&(e=Ct(e,n,t,r,i)),!we(e)||e.style&&e.nodeType||ee(e)||ki(e))return K(e)?Ct(e,n,t,r,i):e;var s={},o;for(o in e)s[o]=Ct(e[o],n,t,r,i);return s},nn=function(e,t,r,i,n,s){var o,l,c,h;if(ae[e]&&(o=new ae[e]).init(n,o.rawVars?t[e]:Ms(t[e],i,n,s,r),r,i,s)!==!1&&(r._pt=l=new ne(r._pt,n,e,0,1,o.render,o,0,o.priority),r!==it))for(c=r._ptLookup[r._targets.indexOf(n)],h=o._props.length;h--;)c[o._props[h]]=l;return o},Ie,br,Br=function a(e,t,r){var i=e.vars,n=i.ease,s=i.startAt,o=i.immediateRender,l=i.lazy,c=i.onUpdate,h=i.runBackwards,d=i.yoyoEase,f=i.keyframes,g=i.autoRevert,p=e._dur,u=e._startAt,_=e._targets,y=e.parent,b=y&&y.data==="nested"?y.vars.targets:_,w=e._overwrite==="auto"&&!Sr,T=e.timeline,C,S,x,k,v,O,P,M,I,R,L,D,z;if(T&&(!f||!n)&&(n="none"),e._ease=Xe(n,lt.ease),e._yEase=d?Zi(Xe(d===!0?n:d,lt.ease)):0,d&&e._yoyo&&!e._repeat&&(d=e._yEase,e._yEase=e._ease,e._ease=d),e._from=!T&&!!i.runBackwards,!T||f&&!i.stagger){if(M=_[0]?Ye(_[0]).harness:0,D=M&&i[M.prop],C=qt(i,Mr),u&&(u._zTime<0&&u.progress(1),t<0&&h&&o&&!g?u.render(-1,!0):u.revert(h&&p?It:ss),u._lazy=0),s){if(Ne(e._startAt=W.set(_,de({data:"isStart",overwrite:!1,parent:y,immediateRender:!0,lazy:!u&&re(l),startAt:null,delay:0,onUpdate:c&&function(){return ce(e,"onUpdate")},stagger:0},s))),e._startAt._dp=0,e._startAt._sat=e,t<0&&(J||!o&&!g)&&e._startAt.revert(It),o&&p&&t<=0&&r<=0){t&&(e._zTime=t);return}}else if(h&&p&&!u){if(t&&(o=!1),x=de({overwrite:!1,data:"isFromStart",lazy:o&&!u&&re(l),immediateRender:o,stagger:0,parent:y},C),D&&(x[M.prop]=D),Ne(e._startAt=W.set(_,x)),e._startAt._dp=0,e._startAt._sat=e,t<0&&(J?e._startAt.revert(It):e._startAt.render(-1,!0)),e._zTime=t,!o)a(e._startAt,N,N);else if(!t)return}for(e._pt=e._ptCache=0,l=p&&re(l)||l&&!p,S=0;S<_.length;S++){if(v=_[S],P=v._gsap||Dr(_)[S]._gsap,e._ptLookup[S]=R={},fr[P.id]&&Le.length&&$t(),L=b===_?S:b.indexOf(v),M&&(I=new M).init(v,D||C,e,L,b)!==!1&&(e._pt=k=new ne(e._pt,v,I.name,0,1,I.render,I,0,I.priority),I._props.forEach(function(X){R[X]=k}),I.priority&&(O=1)),!M||D)for(x in C)ae[x]&&(I=nn(x,C,e,L,v,b))?I.priority&&(O=1):R[x]=k=Lr.call(e,v,x,"get",C[x],L,b,0,i.stringFilter);e._op&&e._op[S]&&e.kill(v,e._op[S]),w&&e._pt&&(Ie=e,$.killTweensOf(v,R,e.globalTime(t)),z=!e.parent,Ie=0),e._pt&&l&&(fr[P.id]=1)}O&&hn(e),e._onInit&&e._onInit(e)}e._onUpdate=c,e._initted=(!e._op||e._pt)&&!z,f&&t<=0&&T.render(ge,!0,!0)},Is=function(e,t,r,i,n,s,o,l){var c=(e._pt&&e._ptCache||(e._ptCache={}))[t],h,d,f,g;if(!c)for(c=e._ptCache[t]=[],f=e._ptLookup,g=e._targets.length;g--;){if(h=f[g][t],h&&h.d&&h.d._pt)for(h=h.d._pt;h&&h.p!==t&&h.fp!==t;)h=h._next;if(!h)return br=1,e.vars[t]="+=0",Br(e,o),br=0,l?wt(t+" not eligible for reset"):1;c.push(h)}for(g=c.length;g--;)d=c[g],h=d._pt||d,h.s=(i||i===0)&&!n?i:h.s+(i||0)+s*h.c,h.c=r-h.s,d.e&&(d.e=V(r)+Z(d.e)),d.b&&(d.b=h.s+Z(d.b))},Ds=function(e,t){var r=e[0]?Ye(e[0]).harness:0,i=r&&r.aliases,n,s,o,l;if(!i)return t;n=ct({},t);for(s in i)if(s in n)for(l=i[s].split(","),o=l.length;o--;)n[l[o]]=n[s];return n},Rs=function(e,t,r,i){var n=t.ease||i||"power1.inOut",s,o;if(ee(t))o=r[e]||(r[e]=[]),t.forEach(function(l,c){return o.push({t:c/(t.length-1)*100,v:l,e:n})});else for(s in t)o=r[s]||(r[s]=[]),s==="ease"||o.push({t:parseFloat(e),v:t[s],e:n})},Ct=function(e,t,r,i,n){return U(e)?e.call(t,r,i,n):K(e)&&~e.indexOf("random(")?xt(e):e},sn=Ir+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",on={};ie(sn+",id,stagger,delay,duration,paused,scrollTrigger",function(a){return on[a]=1});var W=function(a){Ti(e,a);function e(r,i,n,s){var o;typeof i=="number"&&(n.duration=i,i=n,n=null),o=a.call(this,s?i:yt(i))||this;var l=o.vars,c=l.duration,h=l.delay,d=l.immediateRender,f=l.stagger,g=l.overwrite,p=l.keyframes,u=l.defaults,_=l.scrollTrigger,y=l.yoyoEase,b=i.parent||$,w=(ee(r)||ki(r)?Ee(r[0]):"length"in i)?[r]:pe(r),T,C,S,x,k,v,O,P;if(o._targets=w.length?Dr(w):wt("GSAP target "+r+" not found. https://gsap.com",!he.nullTargetWarn)||[],o._ptLookup=[],o._overwrite=g,p||f||Mt(c)||Mt(h)){if(i=o.vars,T=o.timeline=new te({data:"nested",defaults:u||{},targets:b&&b.data==="nested"?b.vars.targets:w}),T.kill(),T.parent=T._dp=ke(o),T._start=0,f||Mt(c)||Mt(h)){if(x=w.length,O=f&&Ui(f),we(f))for(k in f)~sn.indexOf(k)&&(P||(P={}),P[k]=f[k]);for(C=0;C<x;C++)S=qt(i,on),S.stagger=0,y&&(S.yoyoEase=y),P&&ct(S,P),v=w[C],S.duration=+Ct(c,ke(o),C,v,w),S.delay=(+Ct(h,ke(o),C,v,w)||0)-o._delay,!f&&x===1&&S.delay&&(o._delay=h=S.delay,o._start+=h,S.delay=0),T.to(v,S,O?O(C,v,w):0),T._ease=A.none;T.duration()?c=h=0:o.timeline=0}else if(p){yt(de(T.vars.defaults,{ease:"none"})),T._ease=Xe(p.ease||i.ease||"none");var M=0,I,R,L;if(ee(p))p.forEach(function(D){return T.to(w,D,">")}),T.duration();else{S={};for(k in p)k==="ease"||k==="easeEach"||Rs(k,p[k],S,p.easeEach);for(k in S)for(I=S[k].sort(function(D,z){return D.t-z.t}),M=0,C=0;C<I.length;C++)R=I[C],L={ease:R.e,duration:(R.t-(C?I[C-1].t:0))/100*c},L[k]=R.v,T.to(w,L,M),M+=L.duration;T.duration()<c&&T.to({},{duration:c-T.duration()})}}c||o.duration(c=T.duration())}else o.timeline=0;return g===!0&&!Sr&&(Ie=ke(o),$.killTweensOf(w),Ie=0),Ce(b,ke(o),n),i.reversed&&o.reverse(),i.paused&&o.paused(!0),(d||!c&&!p&&o._start===Y(b._time)&&re(d)&&us(ke(o))&&b.data!=="nested")&&(o._tTime=-N,o.render(Math.max(0,-h)||0)),_&&zi(ke(o),_),o}var t=e.prototype;return t.render=function(i,n,s){var o=this._time,l=this._tDur,c=this._dur,h=i<0,d=i>l-N&&!h?l:i<N?0:i,f,g,p,u,_,y,b,w,T;if(!c)fs(this,i,n,s);else if(d!==this._tTime||!i||s||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==h||this._lazy){if(f=d,w=this.timeline,this._repeat){if(u=c+this._rDelay,this._repeat<-1&&h)return this.totalTime(u*100+i,n,s);if(f=Y(d%u),d===l?(p=this._repeat,f=c):(_=Y(d/u),p=~~_,p&&p===_?(f=c,p--):f>c&&(f=c)),y=this._yoyo&&p&1,y&&(T=this._yEase,f=c-f),_=ht(this._tTime,u),f===o&&!s&&this._initted&&p===_)return this._tTime=d,this;p!==_&&(w&&this._yEase&&en(w,y),this.vars.repeatRefresh&&!y&&!this._lock&&f!==u&&this._initted&&(this._lock=s=1,this.render(Y(u*p),!0).invalidate()._lock=0))}if(!this._initted){if(Hi(this,h?i:f,s,n,d))return this._tTime=0,this;if(o!==this._time&&!(s&&this.vars.repeatRefresh&&p!==_))return this;if(c!==this._dur)return this.render(i,n,s)}if(this._tTime=d,this._time=f,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=b=(T||this._ease)(f/c),this._from&&(this.ratio=b=1-b),!o&&d&&!n&&!_&&(ce(this,"onStart"),this._tTime!==d))return this;for(g=this._pt;g;)g.r(b,g.d),g=g._next;w&&w.render(i<0?i:w._dur*w._ease(f/this._dur),n,s)||this._startAt&&(this._zTime=i),this._onUpdate&&!n&&(h&&gr(this,i,n,s),ce(this,"onUpdate")),this._repeat&&p!==_&&this.vars.onRepeat&&!n&&this.parent&&ce(this,"onRepeat"),(d===this._tDur||!d)&&this._tTime===d&&(h&&!this._onUpdate&&gr(this,i,!0,!0),(i||!c)&&(d===this._tDur&&this._ts>0||!d&&this._ts<0)&&Ne(this,1),!n&&!(h&&!o)&&(d||o||y)&&(ce(this,d===l?"onComplete":"onReverseComplete",!0),this._prom&&!(d<l&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(i){return(!i||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(i),a.prototype.invalidate.call(this,i)},t.resetTo=function(i,n,s,o,l){kt||le.wake(),this._ts||this.play();var c=Math.min(this._dur,(this._dp._time-this._start)*this._ts),h;return this._initted||Br(this,c),h=this._ease(c/this._dur),Is(this,i,n,s,o,h,c,l)?this.resetTo(i,n,s,o,1):(Qt(this,0),this.parent||Ni(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(i,n){if(n===void 0&&(n="all"),!i&&(!n||n==="all"))return this._lazy=this._pt=0,this.parent?_t(this):this.scrollTrigger&&this.scrollTrigger.kill(!!J),this;if(this.timeline){var s=this.timeline.totalDuration();return this.timeline.killTweensOf(i,n,Ie&&Ie.vars.overwrite!==!0)._first||_t(this),this.parent&&s!==this.timeline.totalDuration()&&ut(this,this._dur*this.timeline._tDur/s,0,1),this}var o=this._targets,l=i?pe(i):o,c=this._ptLookup,h=this._pt,d,f,g,p,u,_,y;if((!n||n==="all")&&cs(o,l))return n==="all"&&(this._pt=0),_t(this);for(d=this._op=this._op||[],n!=="all"&&(K(n)&&(u={},ie(n,function(b){return u[b]=1}),n=u),n=Ds(o,n)),y=o.length;y--;)if(~l.indexOf(o[y])){f=c[y],n==="all"?(d[y]=n,p=f,g={}):(g=d[y]=d[y]||{},p=n);for(u in p)_=f&&f[u],_&&((!("kill"in _.d)||_.d.kill(u)===!0)&&Kt(this,_,"_pt"),delete f[u]),g!=="all"&&(g[u]=1)}return this._initted&&!this._pt&&h&&_t(this),this},e.to=function(i,n){return new e(i,n,arguments[2])},e.from=function(i,n){return bt(1,arguments)},e.delayedCall=function(i,n,s,o){return new e(n,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:i,onComplete:n,onReverseComplete:n,onCompleteParams:s,onReverseCompleteParams:s,callbackScope:o})},e.fromTo=function(i,n,s){return bt(2,arguments)},e.set=function(i,n){return n.duration=0,n.repeatDelay||(n.repeat=0),new e(i,n)},e.killTweensOf=function(i,n,s){return $.killTweensOf(i,n,s)},e}(St);de(W.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});ie("staggerTo,staggerFrom,staggerFromTo",function(a){W[a]=function(){var e=new te,t=_r.call(arguments,0);return t.splice(a==="staggerFromTo"?5:4,0,0),e[a].apply(e,t)}});var Nr=function(e,t,r){return e[t]=r},an=function(e,t,r){return e[t](r)},Ls=function(e,t,r,i){return e[t](i.fp,r)},Bs=function(e,t,r){return e.setAttribute(t,r)},Fr=function(e,t){return U(e[t])?an:Er(e[t])&&e.setAttribute?Bs:Nr},ln=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},Ns=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},cn=function(e,t){var r=t._pt,i="";if(!e&&t.b)i=t.b;else if(e===1&&t.e)i=t.e;else{for(;r;)i=r.p+(r.m?r.m(r.s+r.c*e):Math.round((r.s+r.c*e)*1e4)/1e4)+i,r=r._next;i+=t.c}t.set(t.t,t.p,i,t)},zr=function(e,t){for(var r=t._pt;r;)r.r(e,r.d),r=r._next},Fs=function(e,t,r,i){for(var n=this._pt,s;n;)s=n._next,n.p===i&&n.modifier(e,t,r),n=s},zs=function(e){for(var t=this._pt,r,i;t;)i=t._next,t.p===e&&!t.op||t.op===e?Kt(this,t,"_pt"):t.dep||(r=1),t=i;return!r},Hs=function(e,t,r,i){i.mSet(e,t,i.m.call(i.tween,r,i.mt),i)},hn=function(e){for(var t=e._pt,r,i,n,s;t;){for(r=t._next,i=n;i&&i.pr>t.pr;)i=i._next;(t._prev=i?i._prev:s)?t._prev._next=t:n=t,(t._next=i)?i._prev=t:s=t,t=r}e._pt=n},ne=function(){function a(t,r,i,n,s,o,l,c,h){this.t=r,this.s=n,this.c=s,this.p=i,this.r=o||ln,this.d=l||this,this.set=c||Nr,this.pr=h||0,this._next=t,t&&(t._prev=this)}var e=a.prototype;return e.modifier=function(r,i,n){this.mSet=this.mSet||this.set,this.set=Hs,this.m=r,this.mt=n,this.tween=i},a}();ie(Ir+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(a){return Mr[a]=1});ue.TweenMax=ue.TweenLite=W;ue.TimelineLite=ue.TimelineMax=te;$=new te({sortChildren:!1,defaults:lt,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});he.stringFilter=Ji;var Ke=[],Rt={},$s=[],ti=0,qs=0,ir=function(e){return(Rt[e]||$s).map(function(t){return t()})},Cr=function(){var e=Date.now(),t=[];e-ti>2&&(ir("matchMediaInit"),Ke.forEach(function(r){var i=r.queries,n=r.conditions,s,o,l,c;for(o in i)s=be.matchMedia(i[o]).matches,s&&(l=1),s!==n[o]&&(n[o]=s,c=1);c&&(r.revert(),l&&t.push(r))}),ir("matchMediaRevert"),t.forEach(function(r){return r.onMatch(r,function(i){return r.add(null,i)})}),ti=e,ir("matchMedia"))},un=function(){function a(t,r){this.selector=r&&mr(r),this.data=[],this._r=[],this.isReverted=!1,this.id=qs++,t&&this.add(t)}var e=a.prototype;return e.add=function(r,i,n){U(r)&&(n=i,i=r,r=U);var s=this,o=function(){var c=H,h=s.selector,d;return c&&c!==s&&c.data.push(s),n&&(s.selector=mr(n)),H=s,d=i.apply(s,arguments),U(d)&&s._r.push(d),H=c,s.selector=h,s.isReverted=!1,d};return s.last=o,r===U?o(s,function(l){return s.add(null,l)}):r?s[r]=o:o},e.ignore=function(r){var i=H;H=null,r(this),H=i},e.getTweens=function(){var r=[];return this.data.forEach(function(i){return i instanceof a?r.push.apply(r,i.getTweens()):i instanceof W&&!(i.parent&&i.parent.data==="nested")&&r.push(i)}),r},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(r,i){var n=this;if(r?function(){for(var o=n.getTweens(),l=n.data.length,c;l--;)c=n.data[l],c.data==="isFlip"&&(c.revert(),c.getChildren(!0,!0,!1).forEach(function(h){return o.splice(o.indexOf(h),1)}));for(o.map(function(h){return{g:h._dur||h._delay||h._sat&&!h._sat.vars.immediateRender?h.globalTime(0):-1/0,t:h}}).sort(function(h,d){return d.g-h.g||-1/0}).forEach(function(h){return h.t.revert(r)}),l=n.data.length;l--;)c=n.data[l],c instanceof te?c.data!=="nested"&&(c.scrollTrigger&&c.scrollTrigger.revert(),c.kill()):!(c instanceof W)&&c.revert&&c.revert(r);n._r.forEach(function(h){return h(r,n)}),n.isReverted=!0}():this.data.forEach(function(o){return o.kill&&o.kill()}),this.clear(),i)for(var s=Ke.length;s--;)Ke[s].id===this.id&&Ke.splice(s,1)},e.revert=function(r){this.kill(r||{})},a}(),Us=function(){function a(t){this.contexts=[],this.scope=t,H&&H.data.push(this)}var e=a.prototype;return e.add=function(r,i,n){we(r)||(r={matches:r});var s=new un(0,n||this.scope),o=s.conditions={},l,c,h;H&&!s.selector&&(s.selector=H.selector),this.contexts.push(s),i=s.add("onMatch",i),s.queries=r;for(c in r)c==="all"?h=1:(l=be.matchMedia(r[c]),l&&(Ke.indexOf(s)<0&&Ke.push(s),(o[c]=l.matches)&&(h=1),l.addListener?l.addListener(Cr):l.addEventListener("change",Cr)));return h&&i(s,function(d){return s.add(null,d)}),this},e.revert=function(r){this.kill(r||{})},e.kill=function(r){this.contexts.forEach(function(i){return i.kill(r,!0)})},a}(),Vt={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t.forEach(function(i){return Ki(i)})},timeline:function(e){return new te(e)},getTweensOf:function(e,t){return $.getTweensOf(e,t)},getProperty:function(e,t,r,i){K(e)&&(e=pe(e)[0]);var n=Ye(e||{}).get,s=r?Bi:Li;return r==="native"&&(r=""),e&&(t?s((ae[t]&&ae[t].get||n)(e,t,r,i)):function(o,l,c){return s((ae[o]&&ae[o].get||n)(e,o,l,c))})},quickSetter:function(e,t,r){if(e=pe(e),e.length>1){var i=e.map(function(h){return oe.quickSetter(h,t,r)}),n=i.length;return function(h){for(var d=n;d--;)i[d](h)}}e=e[0]||{};var s=ae[t],o=Ye(e),l=o.harness&&(o.harness.aliases||{})[t]||t,c=s?function(h){var d=new s;it._pt=0,d.init(e,r?h+r:h,it,0,[e]),d.render(1,d),it._pt&&zr(1,it)}:o.set(e,l);return s?c:function(h){return c(e,l,r?h+r:h,o,1)}},quickTo:function(e,t,r){var i,n=oe.to(e,de((i={},i[t]="+=0.1",i.paused=!0,i.stagger=0,i),r||{})),s=function(l,c,h){return n.resetTo(t,l,c,h)};return s.tween=n,s},isTweening:function(e){return $.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=Xe(e.ease,lt.ease)),jr(lt,e||{})},config:function(e){return jr(he,e||{})},registerEffect:function(e){var t=e.name,r=e.effect,i=e.plugins,n=e.defaults,s=e.extendTimeline;(i||"").split(",").forEach(function(o){return o&&!ae[o]&&!ue[o]&&wt(t+" effect requires "+o+" plugin.")}),Zt[t]=function(o,l,c){return r(pe(o),de(l||{},n),c)},s&&(te.prototype[t]=function(o,l,c){return this.add(Zt[t](o,we(l)?l:(c=l)&&{},this),c)})},registerEase:function(e,t){A[e]=Xe(t)},parseEase:function(e,t){return arguments.length?Xe(e,t):A},getById:function(e){return $.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var r=new te(e),i,n;for(r.smoothChildTiming=re(e.smoothChildTiming),$.remove(r),r._dp=0,r._time=r._tTime=$._time,i=$._first;i;)n=i._next,(t||!(!i._dur&&i instanceof W&&i.vars.onComplete===i._targets[0]))&&Ce(r,i,i._start-i._delay),i=n;return Ce($,r,0),r},context:function(e,t){return e?new un(e,t):H},matchMedia:function(e){return new Us(e)},matchMediaRefresh:function(){return Ke.forEach(function(e){var t=e.conditions,r,i;for(i in t)t[i]&&(t[i]=!1,r=1);r&&e.revert()})||Cr()},addEventListener:function(e,t){var r=Rt[e]||(Rt[e]=[]);~r.indexOf(t)||r.push(t)},removeEventListener:function(e,t){var r=Rt[e],i=r&&r.indexOf(t);i>=0&&r.splice(i,1)},utils:{wrap:vs,wrapYoyo:ws,distribute:Ui,random:Wi,snap:Vi,normalize:Cs,getUnit:Z,clamp:_s,splitColor:ji,toArray:pe,selector:mr,mapRange:Gi,pipe:ys,unitize:bs,interpolate:Ts,shuffle:qi},install:Pi,effects:Zt,ticker:le,updateRoot:te.updateRoot,plugins:ae,globalTimeline:$,core:{PropTween:ne,globals:Mi,Tween:W,Timeline:te,Animation:St,getCache:Ye,_removeLinkedListItem:Kt,reverting:function(){return J},context:function(e){return e&&H&&(H.data.push(e),e._ctx=H),H},suppressOverwrites:function(e){return Sr=e}}};ie("to,from,fromTo,delayedCall,set,killTweensOf",function(a){return Vt[a]=W[a]});le.add(te.updateRoot);it=Vt.to({},{duration:0});var Vs=function(e,t){for(var r=e._pt;r&&r.p!==t&&r.op!==t&&r.fp!==t;)r=r._next;return r},Ws=function(e,t){var r=e._targets,i,n,s;for(i in t)for(n=r.length;n--;)s=e._ptLookup[n][i],s&&(s=s.d)&&(s._pt&&(s=Vs(s,i)),s&&s.modifier&&s.modifier(t[i],e,r[n],i))},nr=function(e,t){return{name:e,headless:1,rawVars:1,init:function(i,n,s){s._onInit=function(o){var l,c;if(K(n)&&(l={},ie(n,function(h){return l[h]=1}),n=l),t){l={};for(c in n)l[c]=t(n[c]);n=l}Ws(o,n)}}}},oe=Vt.registerPlugin({name:"attr",init:function(e,t,r,i,n){var s,o,l;this.tween=r;for(s in t)l=e.getAttribute(s)||"",o=this.add(e,"setAttribute",(l||0)+"",t[s],i,n,0,0,s),o.op=s,o.b=l,this._props.push(s)},render:function(e,t){for(var r=t._pt;r;)J?r.set(r.t,r.p,r.b,r):r.r(e,r.d),r=r._next}},{name:"endArray",headless:1,init:function(e,t){for(var r=t.length;r--;)this.add(e,r,e[r]||0,t[r],0,0,0,0,0,1)}},nr("roundProps",yr),nr("modifiers"),nr("snap",Vi))||Vt;W.version=te.version=oe.version="3.13.0";Ai=1;Or()&&dt();A.Power0;A.Power1;A.Power2;A.Power3;A.Power4;A.Linear;A.Quad;A.Cubic;A.Quart;A.Quint;A.Strong;A.Elastic;A.Back;A.SteppedEase;A.Bounce;A.Sine;A.Expo;A.Circ;/*!
 * CSSPlugin 3.13.0
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var ri,De,st,Hr,Ve,ii,$r,Ys=function(){return typeof window<"u"},Oe={},Ue=180/Math.PI,ot=Math.PI/180,et=Math.atan2,ni=1e8,qr=/([A-Z])/g,Gs=/(left|right|width|margin|padding|x)/i,Xs=/[\s,\(]\S/,ve={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},vr=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},Ks=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},js=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},Qs=function(e,t){var r=t.s+t.c*e;t.set(t.t,t.p,~~(r+(r<0?-.5:.5))+t.u,t)},dn=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},fn=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},Js=function(e,t,r){return e.style[t]=r},Zs=function(e,t,r){return e.style.setProperty(t,r)},eo=function(e,t,r){return e._gsap[t]=r},to=function(e,t,r){return e._gsap.scaleX=e._gsap.scaleY=r},ro=function(e,t,r,i,n){var s=e._gsap;s.scaleX=s.scaleY=r,s.renderTransform(n,s)},io=function(e,t,r,i,n){var s=e._gsap;s[t]=r,s.renderTransform(n,s)},q="transform",se=q+"Origin",no=function a(e,t){var r=this,i=this.target,n=i.style,s=i._gsap;if(e in Oe&&n){if(this.tfm=this.tfm||{},e!=="transform")e=ve[e]||e,~e.indexOf(",")?e.split(",").forEach(function(o){return r.tfm[o]=Se(i,o)}):this.tfm[e]=s.x?s[e]:Se(i,e),e===se&&(this.tfm.zOrigin=s.zOrigin);else return ve.transform.split(",").forEach(function(o){return a.call(r,o,t)});if(this.props.indexOf(q)>=0)return;s.svg&&(this.svgo=i.getAttribute("data-svg-origin"),this.props.push(se,t,"")),e=q}(n||t)&&this.props.push(e,t,n[e])},gn=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},so=function(){var e=this.props,t=this.target,r=t.style,i=t._gsap,n,s;for(n=0;n<e.length;n+=3)e[n+1]?e[n+1]===2?t[e[n]](e[n+2]):t[e[n]]=e[n+2]:e[n+2]?r[e[n]]=e[n+2]:r.removeProperty(e[n].substr(0,2)==="--"?e[n]:e[n].replace(qr,"-$1").toLowerCase());if(this.tfm){for(s in this.tfm)i[s]=this.tfm[s];i.svg&&(i.renderTransform(),t.setAttribute("data-svg-origin",this.svgo||"")),n=$r(),(!n||!n.isStart)&&!r[q]&&(gn(r),i.zOrigin&&r[se]&&(r[se]+=" "+i.zOrigin+"px",i.zOrigin=0,i.renderTransform()),i.uncache=1)}},pn=function(e,t){var r={target:e,props:[],revert:so,save:no};return e._gsap||oe.core.getCache(e),t&&e.style&&e.nodeType&&t.split(",").forEach(function(i){return r.save(i)}),r},_n,wr=function(e,t){var r=De.createElementNS?De.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):De.createElement(e);return r&&r.style?r:De.createElement(e)},_e=function a(e,t,r){var i=getComputedStyle(e);return i[t]||i.getPropertyValue(t.replace(qr,"-$1").toLowerCase())||i.getPropertyValue(t)||!r&&a(e,ft(t)||t,1)||""},si="O,Moz,ms,Ms,Webkit".split(","),ft=function(e,t,r){var i=t||Ve,n=i.style,s=5;if(e in n&&!r)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);s--&&!(si[s]+e in n););return s<0?null:(s===3?"ms":s>=0?si[s]:"")+e},Tr=function(){Ys()&&window.document&&(ri=window,De=ri.document,st=De.documentElement,Ve=wr("div")||{style:{}},wr("div"),q=ft(q),se=q+"Origin",Ve.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",_n=!!ft("perspective"),$r=oe.core.reverting,Hr=1)},oi=function(e){var t=e.ownerSVGElement,r=wr("svg",t&&t.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),i=e.cloneNode(!0),n;i.style.display="block",r.appendChild(i),st.appendChild(r);try{n=i.getBBox()}catch{}return r.removeChild(i),st.removeChild(r),n},ai=function(e,t){for(var r=t.length;r--;)if(e.hasAttribute(t[r]))return e.getAttribute(t[r])},mn=function(e){var t,r;try{t=e.getBBox()}catch{t=oi(e),r=1}return t&&(t.width||t.height)||r||(t=oi(e)),t&&!t.width&&!t.x&&!t.y?{x:+ai(e,["x","cx","x1"])||0,y:+ai(e,["y","cy","y1"])||0,width:0,height:0}:t},yn=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&mn(e))},Qe=function(e,t){if(t){var r=e.style,i;t in Oe&&t!==se&&(t=q),r.removeProperty?(i=t.substr(0,2),(i==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),r.removeProperty(i==="--"?t:t.replace(qr,"-$1").toLowerCase())):r.removeAttribute(t)}},Re=function(e,t,r,i,n,s){var o=new ne(e._pt,t,r,0,1,s?fn:dn);return e._pt=o,o.b=i,o.e=n,e._props.push(r),o},li={deg:1,rad:1,turn:1},oo={grid:1,flex:1},Fe=function a(e,t,r,i){var n=parseFloat(r)||0,s=(r+"").trim().substr((n+"").length)||"px",o=Ve.style,l=Gs.test(t),c=e.tagName.toLowerCase()==="svg",h=(c?"client":"offset")+(l?"Width":"Height"),d=100,f=i==="px",g=i==="%",p,u,_,y;if(i===s||!n||li[i]||li[s])return n;if(s!=="px"&&!f&&(n=a(e,t,r,"px")),y=e.getCTM&&yn(e),(g||s==="%")&&(Oe[t]||~t.indexOf("adius")))return p=y?e.getBBox()[l?"width":"height"]:e[h],V(g?n/p*d:n/100*p);if(o[l?"width":"height"]=d+(f?s:i),u=i!=="rem"&&~t.indexOf("adius")||i==="em"&&e.appendChild&&!c?e:e.parentNode,y&&(u=(e.ownerSVGElement||{}).parentNode),(!u||u===De||!u.appendChild)&&(u=De.body),_=u._gsap,_&&g&&_.width&&l&&_.time===le.time&&!_.uncache)return V(n/_.width*d);if(g&&(t==="height"||t==="width")){var b=e.style[t];e.style[t]=d+i,p=e[h],b?e.style[t]=b:Qe(e,t)}else(g||s==="%")&&!oo[_e(u,"display")]&&(o.position=_e(e,"position")),u===e&&(o.position="static"),u.appendChild(Ve),p=Ve[h],u.removeChild(Ve),o.position="absolute";return l&&g&&(_=Ye(u),_.time=le.time,_.width=u[h]),V(f?p*n/d:p&&n?d/p*n:0)},Se=function(e,t,r,i){var n;return Hr||Tr(),t in ve&&t!=="transform"&&(t=ve[t],~t.indexOf(",")&&(t=t.split(",")[0])),Oe[t]&&t!=="transform"?(n=Ot(e,i),n=t!=="transformOrigin"?n[t]:n.svg?n.origin:Yt(_e(e,se))+" "+n.zOrigin+"px"):(n=e.style[t],(!n||n==="auto"||i||~(n+"").indexOf("calc("))&&(n=Wt[t]&&Wt[t](e,t,r)||_e(e,t)||Di(e,t)||(t==="opacity"?1:0))),r&&!~(n+"").trim().indexOf(" ")?Fe(e,t,n,r)+r:n},ao=function(e,t,r,i){if(!r||r==="none"){var n=ft(t,e,1),s=n&&_e(e,n,1);s&&s!==r?(t=n,r=s):t==="borderColor"&&(r=_e(e,"borderTopColor"))}var o=new ne(this._pt,e.style,t,0,1,cn),l=0,c=0,h,d,f,g,p,u,_,y,b,w,T,C;if(o.b=r,o.e=i,r+="",i+="",i.substring(0,6)==="var(--"&&(i=_e(e,i.substring(4,i.indexOf(")")))),i==="auto"&&(u=e.style[t],e.style[t]=i,i=_e(e,t)||i,u?e.style[t]=u:Qe(e,t)),h=[r,i],Ji(h),r=h[0],i=h[1],f=r.match(rt)||[],C=i.match(rt)||[],C.length){for(;d=rt.exec(i);)_=d[0],b=i.substring(l,d.index),p?p=(p+1)%5:(b.substr(-5)==="rgba("||b.substr(-5)==="hsla(")&&(p=1),_!==(u=f[c++]||"")&&(g=parseFloat(u)||0,T=u.substr((g+"").length),_.charAt(1)==="="&&(_=nt(g,_)+T),y=parseFloat(_),w=_.substr((y+"").length),l=rt.lastIndex-w.length,w||(w=w||he.units[t]||T,l===i.length&&(i+=w,o.e+=w)),T!==w&&(g=Fe(e,t,u,w)||0),o._pt={_next:o._pt,p:b||c===1?b:",",s:g,c:y-g,m:p&&p<4||t==="zIndex"?Math.round:0});o.c=l<i.length?i.substring(l,i.length):""}else o.r=t==="display"&&i==="none"?fn:dn;return Ei.test(i)&&(o.e=0),this._pt=o,o},ci={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},lo=function(e){var t=e.split(" "),r=t[0],i=t[1]||"50%";return(r==="top"||r==="bottom"||i==="left"||i==="right")&&(e=r,r=i,i=e),t[0]=ci[r]||r,t[1]=ci[i]||i,t.join(" ")},co=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var r=t.t,i=r.style,n=t.u,s=r._gsap,o,l,c;if(n==="all"||n===!0)i.cssText="",l=1;else for(n=n.split(","),c=n.length;--c>-1;)o=n[c],Oe[o]&&(l=1,o=o==="transformOrigin"?se:q),Qe(r,o);l&&(Qe(r,q),s&&(s.svg&&r.removeAttribute("transform"),i.scale=i.rotate=i.translate="none",Ot(r,1),s.uncache=1,gn(i)))}},Wt={clearProps:function(e,t,r,i,n){if(n.data!=="isFromStart"){var s=e._pt=new ne(e._pt,t,r,0,0,co);return s.u=i,s.pr=-10,s.tween=n,e._props.push(r),1}}},Et=[1,0,0,1,0,0],bn={},Cn=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},hi=function(e){var t=_e(e,q);return Cn(t)?Et:t.substr(7).match(Si).map(V)},Ur=function(e,t){var r=e._gsap||Ye(e),i=e.style,n=hi(e),s,o,l,c;return r.svg&&e.getAttribute("transform")?(l=e.transform.baseVal.consolidate().matrix,n=[l.a,l.b,l.c,l.d,l.e,l.f],n.join(",")==="1,0,0,1,0,0"?Et:n):(n===Et&&!e.offsetParent&&e!==st&&!r.svg&&(l=i.display,i.display="block",s=e.parentNode,(!s||!e.offsetParent&&!e.getBoundingClientRect().width)&&(c=1,o=e.nextElementSibling,st.appendChild(e)),n=hi(e),l?i.display=l:Qe(e,"display"),c&&(o?s.insertBefore(e,o):s?s.appendChild(e):st.removeChild(e))),t&&n.length>6?[n[0],n[1],n[4],n[5],n[12],n[13]]:n)},xr=function(e,t,r,i,n,s){var o=e._gsap,l=n||Ur(e,!0),c=o.xOrigin||0,h=o.yOrigin||0,d=o.xOffset||0,f=o.yOffset||0,g=l[0],p=l[1],u=l[2],_=l[3],y=l[4],b=l[5],w=t.split(" "),T=parseFloat(w[0])||0,C=parseFloat(w[1])||0,S,x,k,v;r?l!==Et&&(x=g*_-p*u)&&(k=T*(_/x)+C*(-u/x)+(u*b-_*y)/x,v=T*(-p/x)+C*(g/x)-(g*b-p*y)/x,T=k,C=v):(S=mn(e),T=S.x+(~w[0].indexOf("%")?T/100*S.width:T),C=S.y+(~(w[1]||w[0]).indexOf("%")?C/100*S.height:C)),i||i!==!1&&o.smooth?(y=T-c,b=C-h,o.xOffset=d+(y*g+b*u)-y,o.yOffset=f+(y*p+b*_)-b):o.xOffset=o.yOffset=0,o.xOrigin=T,o.yOrigin=C,o.smooth=!!i,o.origin=t,o.originIsAbsolute=!!r,e.style[se]="0px 0px",s&&(Re(s,o,"xOrigin",c,T),Re(s,o,"yOrigin",h,C),Re(s,o,"xOffset",d,o.xOffset),Re(s,o,"yOffset",f,o.yOffset)),e.setAttribute("data-svg-origin",T+" "+C)},Ot=function(e,t){var r=e._gsap||new rn(e);if("x"in r&&!t&&!r.uncache)return r;var i=e.style,n=r.scaleX<0,s="px",o="deg",l=getComputedStyle(e),c=_e(e,se)||"0",h,d,f,g,p,u,_,y,b,w,T,C,S,x,k,v,O,P,M,I,R,L,D,z,X,He,Ae,Pe,ye,Pt,me,Te;return h=d=f=u=_=y=b=w=T=0,g=p=1,r.svg=!!(e.getCTM&&yn(e)),l.translate&&((l.translate!=="none"||l.scale!=="none"||l.rotate!=="none")&&(i[q]=(l.translate!=="none"?"translate3d("+(l.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(l.rotate!=="none"?"rotate("+l.rotate+") ":"")+(l.scale!=="none"?"scale("+l.scale.split(" ").join(",")+") ":"")+(l[q]!=="none"?l[q]:"")),i.scale=i.rotate=i.translate="none"),x=Ur(e,r.svg),r.svg&&(r.uncache?(X=e.getBBox(),c=r.xOrigin-X.x+"px "+(r.yOrigin-X.y)+"px",z=""):z=!t&&e.getAttribute("data-svg-origin"),xr(e,z||c,!!z||r.originIsAbsolute,r.smooth!==!1,x)),C=r.xOrigin||0,S=r.yOrigin||0,x!==Et&&(P=x[0],M=x[1],I=x[2],R=x[3],h=L=x[4],d=D=x[5],x.length===6?(g=Math.sqrt(P*P+M*M),p=Math.sqrt(R*R+I*I),u=P||M?et(M,P)*Ue:0,b=I||R?et(I,R)*Ue+u:0,b&&(p*=Math.abs(Math.cos(b*ot))),r.svg&&(h-=C-(C*P+S*I),d-=S-(C*M+S*R))):(Te=x[6],Pt=x[7],Ae=x[8],Pe=x[9],ye=x[10],me=x[11],h=x[12],d=x[13],f=x[14],k=et(Te,ye),_=k*Ue,k&&(v=Math.cos(-k),O=Math.sin(-k),z=L*v+Ae*O,X=D*v+Pe*O,He=Te*v+ye*O,Ae=L*-O+Ae*v,Pe=D*-O+Pe*v,ye=Te*-O+ye*v,me=Pt*-O+me*v,L=z,D=X,Te=He),k=et(-I,ye),y=k*Ue,k&&(v=Math.cos(-k),O=Math.sin(-k),z=P*v-Ae*O,X=M*v-Pe*O,He=I*v-ye*O,me=R*O+me*v,P=z,M=X,I=He),k=et(M,P),u=k*Ue,k&&(v=Math.cos(k),O=Math.sin(k),z=P*v+M*O,X=L*v+D*O,M=M*v-P*O,D=D*v-L*O,P=z,L=X),_&&Math.abs(_)+Math.abs(u)>359.9&&(_=u=0,y=180-y),g=V(Math.sqrt(P*P+M*M+I*I)),p=V(Math.sqrt(D*D+Te*Te)),k=et(L,D),b=Math.abs(k)>2e-4?k*Ue:0,T=me?1/(me<0?-me:me):0),r.svg&&(z=e.getAttribute("transform"),r.forceCSS=e.setAttribute("transform","")||!Cn(_e(e,q)),z&&e.setAttribute("transform",z))),Math.abs(b)>90&&Math.abs(b)<270&&(n?(g*=-1,b+=u<=0?180:-180,u+=u<=0?180:-180):(p*=-1,b+=b<=0?180:-180)),t=t||r.uncache,r.x=h-((r.xPercent=h&&(!t&&r.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-h)?-50:0)))?e.offsetWidth*r.xPercent/100:0)+s,r.y=d-((r.yPercent=d&&(!t&&r.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-d)?-50:0)))?e.offsetHeight*r.yPercent/100:0)+s,r.z=f+s,r.scaleX=V(g),r.scaleY=V(p),r.rotation=V(u)+o,r.rotationX=V(_)+o,r.rotationY=V(y)+o,r.skewX=b+o,r.skewY=w+o,r.transformPerspective=T+s,(r.zOrigin=parseFloat(c.split(" ")[2])||!t&&r.zOrigin||0)&&(i[se]=Yt(c)),r.xOffset=r.yOffset=0,r.force3D=he.force3D,r.renderTransform=r.svg?uo:_n?vn:ho,r.uncache=0,r},Yt=function(e){return(e=e.split(" "))[0]+" "+e[1]},sr=function(e,t,r){var i=Z(t);return V(parseFloat(t)+parseFloat(Fe(e,"x",r+"px",i)))+i},ho=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,vn(e,t)},$e="0deg",gt="0px",qe=") ",vn=function(e,t){var r=t||this,i=r.xPercent,n=r.yPercent,s=r.x,o=r.y,l=r.z,c=r.rotation,h=r.rotationY,d=r.rotationX,f=r.skewX,g=r.skewY,p=r.scaleX,u=r.scaleY,_=r.transformPerspective,y=r.force3D,b=r.target,w=r.zOrigin,T="",C=y==="auto"&&e&&e!==1||y===!0;if(w&&(d!==$e||h!==$e)){var S=parseFloat(h)*ot,x=Math.sin(S),k=Math.cos(S),v;S=parseFloat(d)*ot,v=Math.cos(S),s=sr(b,s,x*v*-w),o=sr(b,o,-Math.sin(S)*-w),l=sr(b,l,k*v*-w+w)}_!==gt&&(T+="perspective("+_+qe),(i||n)&&(T+="translate("+i+"%, "+n+"%) "),(C||s!==gt||o!==gt||l!==gt)&&(T+=l!==gt||C?"translate3d("+s+", "+o+", "+l+") ":"translate("+s+", "+o+qe),c!==$e&&(T+="rotate("+c+qe),h!==$e&&(T+="rotateY("+h+qe),d!==$e&&(T+="rotateX("+d+qe),(f!==$e||g!==$e)&&(T+="skew("+f+", "+g+qe),(p!==1||u!==1)&&(T+="scale("+p+", "+u+qe),b.style[q]=T||"translate(0, 0)"},uo=function(e,t){var r=t||this,i=r.xPercent,n=r.yPercent,s=r.x,o=r.y,l=r.rotation,c=r.skewX,h=r.skewY,d=r.scaleX,f=r.scaleY,g=r.target,p=r.xOrigin,u=r.yOrigin,_=r.xOffset,y=r.yOffset,b=r.forceCSS,w=parseFloat(s),T=parseFloat(o),C,S,x,k,v;l=parseFloat(l),c=parseFloat(c),h=parseFloat(h),h&&(h=parseFloat(h),c+=h,l+=h),l||c?(l*=ot,c*=ot,C=Math.cos(l)*d,S=Math.sin(l)*d,x=Math.sin(l-c)*-f,k=Math.cos(l-c)*f,c&&(h*=ot,v=Math.tan(c-h),v=Math.sqrt(1+v*v),x*=v,k*=v,h&&(v=Math.tan(h),v=Math.sqrt(1+v*v),C*=v,S*=v)),C=V(C),S=V(S),x=V(x),k=V(k)):(C=d,k=f,S=x=0),(w&&!~(s+"").indexOf("px")||T&&!~(o+"").indexOf("px"))&&(w=Fe(g,"x",s,"px"),T=Fe(g,"y",o,"px")),(p||u||_||y)&&(w=V(w+p-(p*C+u*x)+_),T=V(T+u-(p*S+u*k)+y)),(i||n)&&(v=g.getBBox(),w=V(w+i/100*v.width),T=V(T+n/100*v.height)),v="matrix("+C+","+S+","+x+","+k+","+w+","+T+")",g.setAttribute("transform",v),b&&(g.style[q]=v)},fo=function(e,t,r,i,n){var s=360,o=K(n),l=parseFloat(n)*(o&&~n.indexOf("rad")?Ue:1),c=l-i,h=i+c+"deg",d,f;return o&&(d=n.split("_")[1],d==="short"&&(c%=s,c!==c%(s/2)&&(c+=c<0?s:-s)),d==="cw"&&c<0?c=(c+s*ni)%s-~~(c/s)*s:d==="ccw"&&c>0&&(c=(c-s*ni)%s-~~(c/s)*s)),e._pt=f=new ne(e._pt,t,r,i,c,Ks),f.e=h,f.u="deg",e._props.push(r),f},ui=function(e,t){for(var r in t)e[r]=t[r];return e},go=function(e,t,r){var i=ui({},r._gsap),n="perspective,force3D,transformOrigin,svgOrigin",s=r.style,o,l,c,h,d,f,g,p;i.svg?(c=r.getAttribute("transform"),r.setAttribute("transform",""),s[q]=t,o=Ot(r,1),Qe(r,q),r.setAttribute("transform",c)):(c=getComputedStyle(r)[q],s[q]=t,o=Ot(r,1),s[q]=c);for(l in Oe)c=i[l],h=o[l],c!==h&&n.indexOf(l)<0&&(g=Z(c),p=Z(h),d=g!==p?Fe(r,l,c,p):parseFloat(c),f=parseFloat(h),e._pt=new ne(e._pt,o,l,d,f-d,vr),e._pt.u=p||0,e._props.push(l));ui(o,i)};ie("padding,margin,Width,Radius",function(a,e){var t="Top",r="Right",i="Bottom",n="Left",s=(e<3?[t,r,i,n]:[t+n,t+r,i+r,i+n]).map(function(o){return e<2?a+o:"border"+o+a});Wt[e>1?"border"+a:a]=function(o,l,c,h,d){var f,g;if(arguments.length<4)return f=s.map(function(p){return Se(o,p,c)}),g=f.join(" "),g.split(f[0]).length===5?f[0]:g;f=(h+"").split(" "),g={},s.forEach(function(p,u){return g[p]=f[u]=f[u]||f[(u-1)/2|0]}),o.init(l,g,d)}});var wn={name:"css",register:Tr,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,r,i,n){var s=this._props,o=e.style,l=r.vars.startAt,c,h,d,f,g,p,u,_,y,b,w,T,C,S,x,k;Hr||Tr(),this.styles=this.styles||pn(e),k=this.styles.props,this.tween=r;for(u in t)if(u!=="autoRound"&&(h=t[u],!(ae[u]&&nn(u,t,r,i,e,n)))){if(g=typeof h,p=Wt[u],g==="function"&&(h=h.call(r,i,e,n),g=typeof h),g==="string"&&~h.indexOf("random(")&&(h=xt(h)),p)p(this,e,u,h,r)&&(x=1);else if(u.substr(0,2)==="--")c=(getComputedStyle(e).getPropertyValue(u)+"").trim(),h+="",Be.lastIndex=0,Be.test(c)||(_=Z(c),y=Z(h)),y?_!==y&&(c=Fe(e,u,c,y)+y):_&&(h+=_),this.add(o,"setProperty",c,h,i,n,0,0,u),s.push(u),k.push(u,0,o[u]);else if(g!=="undefined"){if(l&&u in l?(c=typeof l[u]=="function"?l[u].call(r,i,e,n):l[u],K(c)&&~c.indexOf("random(")&&(c=xt(c)),Z(c+"")||c==="auto"||(c+=he.units[u]||Z(Se(e,u))||""),(c+"").charAt(1)==="="&&(c=Se(e,u))):c=Se(e,u),f=parseFloat(c),b=g==="string"&&h.charAt(1)==="="&&h.substr(0,2),b&&(h=h.substr(2)),d=parseFloat(h),u in ve&&(u==="autoAlpha"&&(f===1&&Se(e,"visibility")==="hidden"&&d&&(f=0),k.push("visibility",0,o.visibility),Re(this,o,"visibility",f?"inherit":"hidden",d?"inherit":"hidden",!d)),u!=="scale"&&u!=="transform"&&(u=ve[u],~u.indexOf(",")&&(u=u.split(",")[0]))),w=u in Oe,w){if(this.styles.save(u),g==="string"&&h.substring(0,6)==="var(--"&&(h=_e(e,h.substring(4,h.indexOf(")"))),d=parseFloat(h)),T||(C=e._gsap,C.renderTransform&&!t.parseTransform||Ot(e,t.parseTransform),S=t.smoothOrigin!==!1&&C.smooth,T=this._pt=new ne(this._pt,o,q,0,1,C.renderTransform,C,0,-1),T.dep=1),u==="scale")this._pt=new ne(this._pt,C,"scaleY",C.scaleY,(b?nt(C.scaleY,b+d):d)-C.scaleY||0,vr),this._pt.u=0,s.push("scaleY",u),u+="X";else if(u==="transformOrigin"){k.push(se,0,o[se]),h=lo(h),C.svg?xr(e,h,0,S,0,this):(y=parseFloat(h.split(" ")[2])||0,y!==C.zOrigin&&Re(this,C,"zOrigin",C.zOrigin,y),Re(this,o,u,Yt(c),Yt(h)));continue}else if(u==="svgOrigin"){xr(e,h,1,S,0,this);continue}else if(u in bn){fo(this,C,u,f,b?nt(f,b+h):h);continue}else if(u==="smoothOrigin"){Re(this,C,"smooth",C.smooth,h);continue}else if(u==="force3D"){C[u]=h;continue}else if(u==="transform"){go(this,h,e);continue}}else u in o||(u=ft(u)||u);if(w||(d||d===0)&&(f||f===0)&&!Xs.test(h)&&u in o)_=(c+"").substr((f+"").length),d||(d=0),y=Z(h)||(u in he.units?he.units[u]:_),_!==y&&(f=Fe(e,u,c,y)),this._pt=new ne(this._pt,w?C:o,u,f,(b?nt(f,b+d):d)-f,!w&&(y==="px"||u==="zIndex")&&t.autoRound!==!1?Qs:vr),this._pt.u=y||0,_!==y&&y!=="%"&&(this._pt.b=c,this._pt.r=js);else if(u in o)ao.call(this,e,u,c,b?b+h:h);else if(u in e)this.add(e,u,c||e[u],b?b+h:h,i,n);else if(u!=="parseTransform"){Pr(u,h);continue}w||(u in o?k.push(u,0,o[u]):typeof e[u]=="function"?k.push(u,2,e[u]()):k.push(u,1,c||e[u])),s.push(u)}}x&&hn(this)},render:function(e,t){if(t.tween._time||!$r())for(var r=t._pt;r;)r.r(e,r.d),r=r._next;else t.styles.revert()},get:Se,aliases:ve,getSetter:function(e,t,r){var i=ve[t];return i&&i.indexOf(",")<0&&(t=i),t in Oe&&t!==se&&(e._gsap.x||Se(e,"x"))?r&&ii===r?t==="scale"?to:eo:(ii=r||{})&&(t==="scale"?ro:io):e.style&&!Er(e.style[t])?Js:~t.indexOf("-")?Zs:Fr(e,t)},core:{_removeProperty:Qe,_getMatrix:Ur}};oe.utils.checkPrefix=ft;oe.core.getStyleSaver=pn;(function(a,e,t,r){var i=ie(a+","+e+","+t,function(n){Oe[n]=1});ie(e,function(n){he.units[n]="deg",bn[n]=1}),ve[i[13]]=a+","+e,ie(r,function(n){var s=n.split(":");ve[s[1]]=i[s[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");ie("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(a){he.units[a]="px"});oe.registerPlugin(wn);var Je=oe.registerPlugin(wn)||oe;Je.core.Tween;function po(a){return new Promise((e,t)=>{console.log("Speech function called with text:",a),window.speechSynthesis.cancel();const r=document.createElement("div");r.innerHTML=a;const i=r.textContent||r.innerText||"";console.log("Clean text for speech:",i);const n=new SpeechSynthesisUtterance(i);n.onend=()=>{console.log("Speech utterance ended"),e()},n.onerror=s=>{console.error("Speech utterance error:",s),t(s)},console.log("Starting speech after 50ms delay"),setTimeout(()=>{window.speechSynthesis.speak(n),console.log("Speech synthesis.speak() called")},50)})}function _o(a){const e=document.querySelector(a);if(!e)return;const t=e.getBoundingClientRect(),r=10,i=(t.top-r)/window.innerHeight*100,n=(t.left-r)/window.innerWidth*100,s=(t.right+r)/window.innerWidth*100,o=(t.bottom+r)/window.innerHeight*100,l=`polygon(0% 0%, 0% 100%, ${n}% 100%, ${n}% ${i}%, ${s}% ${i}%, ${s}% ${o}%, ${n}% ${o}%, ${n}% 100%, 100% 100%, 100% 0%, 0% 0%)`;Je.to("#tutorial-mask",{clipPath:l,duration:.4,ease:"power2.inOut"})}function mo(){Je.to("#tutorial-mask",{clipPath:"polygon(0% 0%, 0% 100%, 50% 100%, 50% 50%, 50% 50%, 50% 50%, 50% 50%, 50% 100%, 100% 100%, 100% 0%, 0% 0%)",duration:.4,ease:"power2.inOut"})}function yo(a){const e=document.querySelector(a);e&&Je.to(e,{position:"relative",zIndex:2001,boxShadow:"0 0 20px 8px #33c6dc",duration:.4})}function bo(a){const e=document.querySelector(a);e&&Je.to(e,{boxShadow:"0 0 0px 0px rgba(51,198,220,0)",duration:.3,onComplete:()=>Je.set(e,{clearProps:"all"})})}function or(a){return new Promise(e=>{const t=m.rings[a];let r=!1;const i=()=>{if(!r)m.rings[a]!==t&&(r=!0);else if(!m.drag.active&&!m.animation){cancelAnimationFrame(n),e();return}n=requestAnimationFrame(i)};let n=requestAnimationFrame(i)})}function Co(){console.log("=== TUTORIAL START ==="),j.toggleSidebar(!1);const a=document.getElementById("tutorial-bubble"),e=document.getElementById("tutorial-mask"),t=document.getElementById("tutorial-text");if(console.log("Tutorial elements check:",{tutorialBubble:!!a,tutorialMask:!!e,tutorialText:!!t,bubbleStyles:a?{opacity:a.style.opacity,visibility:a.style.visibility,display:getComputedStyle(a).display}:null,textStyles:t?{opacity:t.style.opacity,visibility:t.style.visibility,display:getComputedStyle(t).display,innerHTML:t.innerHTML}:null}),a&&e&&t)console.log("All tutorial elements found successfully");else{console.error("Tutorial elements missing!",{tutorialBubble:!!a,tutorialMask:!!e,tutorialText:!!t});return}window.diatonicCompassTutorial&&(console.log("Killing existing tutorial timeline"),window.diatonicCompassTutorial.kill()),console.log("Creating new GSAP timeline");const r=Je.timeline({onComplete:()=>{console.log("Tutorial timeline completed"),window.diatonicCompassTutorial=null}});window.diatonicCompassTutorial=r;const i=n=>{console.log("=== ADDING STEP TO TIMELINE ===",n.text),r.call(async()=>{console.log("=== EXECUTING STEP ===",n.text),r.pause();const s=document.getElementById("tutorial-text"),o=document.getElementById("tutorial-bubble");console.log("Tutorial elements during step execution:",{textEl:!!s,bubbleEl:!!o,textElStyles:s?{opacity:s.style.opacity,visibility:s.style.visibility,display:getComputedStyle(s).display,currentHTML:s.innerHTML}:null,bubbleElStyles:o?{opacity:o.style.opacity,visibility:o.style.visibility,display:getComputedStyle(o).display}:null}),s?(console.log("BEFORE setting text - innerHTML:",s.innerHTML),s.innerHTML=n.text,s.style.opacity="1",s.style.visibility="visible",console.log("AFTER setting text - innerHTML:",s.innerHTML),console.log("Text element computed styles after update:",{opacity:getComputedStyle(s).opacity,visibility:getComputedStyle(s).visibility,display:getComputedStyle(s).display,fontSize:getComputedStyle(s).fontSize,color:getComputedStyle(s).color})):console.error("Tutorial text element not found during step execution!"),n.highlightTarget&&(console.log("Adding highlight to:",n.highlightTarget),_o(n.highlightTarget),yo(n.highlightTarget)),console.log("Starting speech synthesis for:",n.text),await po(n.text),console.log("Speech synthesis completed"),n.waitFor&&(console.log("Waiting for user interaction..."),await n.waitFor(),console.log("User interaction completed")),n.highlightTarget&&(console.log("Removing highlight from:",n.highlightTarget),bo(n.highlightTarget),mo()),await new Promise(l=>setTimeout(l,500)),console.log("Step completed, resuming timeline"),r.resume()})};console.log("Adding tutorial mask animation to timeline"),r.to("#tutorial-mask",{autoAlpha:1,duration:.3}),r.call(()=>{console.log("=== SHOWING TUTORIAL BUBBLE ===");const n=document.getElementById("tutorial-bubble"),s=document.getElementById("tutorial-text");console.log("Bubble show elements check:",{bubble:!!n,textEl:!!s,bubbleCurrentStyles:n?{opacity:n.style.opacity,visibility:n.style.visibility,display:getComputedStyle(n).display}:null,textCurrentStyles:s?{opacity:s.style.opacity,visibility:s.style.visibility,innerHTML:s.innerHTML}:null}),n?(console.log("Setting bubble visibility styles"),n.style.display="block",n.style.opacity="1",n.style.visibility="visible",n.setAttribute("aria-hidden","false"),console.log("Bubble styles after setting:",{opacity:n.style.opacity,visibility:n.style.visibility,computedOpacity:getComputedStyle(n).opacity,computedVisibility:getComputedStyle(n).visibility,computedDisplay:getComputedStyle(n).display}),console.log("Tutorial bubble shown successfully")):console.error("Tutorial bubble element not found during show!")}),i({text:"Welcome to the <strong>Diatonic Compass!</strong>"}),i({text:"Rotate the <strong>Pitch</strong> belt so we leave <strong>C Major.</strong>",highlightTarget:".pitch-belt",waitFor:()=>or("pitchClass")}),i({text:"Nice! <br>Change the <strong>mode</strong> by spinning the <strong>Degree belt.</strong>",highlightTarget:".degree-belt",waitFor:()=>or("degree")}),i({text:"Wonderful!<br>Now shift the perspective by spinning the <strong>Chromatic belt</strong>.",highlightTarget:".chromatic-belt",waitFor:()=>or("chromatic")}),r.to("#tutorial-bubble",{bottom:"110px",duration:.3,ease:"power2.out"}),i({text:"Almost there!<br> Tap the <strong>result bar</strong> to <strong>hear your scale.</strong>",highlightTarget:"#result-container",waitFor:async()=>{await new Promise(n=>{const s=()=>m.playback.isPlaying?n():requestAnimationFrame(s);s()}),await new Promise(n=>{const s=()=>m.playback.isPlaying?requestAnimationFrame(s):n();s()})}}),r.to("#tutorial-bubble",{bottom:"20px",duration:.3,ease:"power2.in"}),i({text:"You did it!<br><strong>Enjoy exploring.</strong>"}),r.to(["#tutorial-mask","#tutorial-bubble"],{autoAlpha:0,duration:.4,delay:1}),r.call(()=>{const n=document.getElementById("tutorial-bubble");n&&(n.style.display="none",console.log("Tutorial bubble hidden"))})}class Me{static hasStateChanged(e,t){return!t||e.animation!==null||e.drag.active!==null||e.playback.isPlaying!==t.playback.isPlaying||e.playback.currentNoteIndex!==t.playback.currentNoteIndex||!this._ringsEqual(e.rings,t.rings)||e.display.sharp!==t.display.sharp||e.display.flat!==t.display.flat||e.ui.darkMode!==t.ui.darkMode||e.ui.sidebarOpen!==t.ui.sidebarOpen||e.belts.orientation!==t.belts.orientation||!this._dimensionsEqual(e.dimensions,t.dimensions)}static _ringsEqual(e,t){return Math.abs(e.pitchClass-t.pitchClass)<1e-4&&Math.abs(e.degree-t.degree)<1e-4&&Math.abs(e.chromatic-t.chromatic)<1e-4&&Math.abs(e.highlightPosition-t.highlightPosition)<1e-4}static _dimensionsEqual(e,t){return e.size===t.size&&e.dpr===t.dpr}static createSnapshot(e){return{rings:{...e.rings},playback:{isPlaying:e.playback.isPlaying,currentNoteIndex:e.playback.currentNoteIndex},display:{...e.display},ui:{darkMode:e.ui.darkMode,sidebarOpen:e.ui.sidebarOpen},belts:{orientation:e.belts.orientation},dimensions:{...e.dimensions},animation:e.animation,drag:{active:e.drag.active}}}static markDirty(e){e.performance&&(e.performance.needsRedraw=!0)}static markClean(e){e.performance&&(e.performance.needsRedraw=!1,e.performance.lastRenderState=this.createSnapshot(e))}static needsRedraw(e){var t,r;return(t=e.performance)!=null&&t.needsRedraw?!0:this.hasStateChanged(e,(r=e.performance)==null?void 0:r.lastRenderState)}}const vo=Object.freeze(Object.defineProperty({__proto__:null,StateTracker:Me},Symbol.toStringTag,{value:"Module"}));function at(a,e){if(m.rings.hasOwnProperty(a)){const t=F(e);m.rings[a]=t,Me.markDirty(m)}}function Tn(a,e,t){const r=e;m.rings.chromatic=F(a.startChrom+r),m.rings.pitchClass=F(a.startPitchClass+e),m.rings.degree=F(a.startDegree+e),m.rings.highlightPosition=F(a.startHighlight+e),Me.markDirty(m)}function xn(a){if(!a)return"#000000";const e=parseInt(a.slice(1,3),16),t=parseInt(a.slice(3,5),16),r=parseInt(a.slice(5,7),16);return .299*e+.587*t+.114*r>140?"#000000":"#FFFFFF"}const wo={red:{solid:"red",fill:"rgba(255, 0, 0, 0.2)"},blue:{solid:"blue",fill:"rgba(0, 0, 255, 0.2)"},green:{solid:"green",fill:"rgba(0, 255, 0, 0.2)"},yellow:{solid:"#FFD700",fill:"rgba(255, 215, 0, 0.2)"}};class To{constructor(e,t,r){this.canvas=e,this.ctx=e.getContext("2d"),this.state=t,this.onInteractionEnd=r,this.cachedLayers={outerRing:null,middleRing:null,innerRing:null,labels:null,lastSize:0},this._initInteraction()}_regenerateCachedLayers(e,t){}update(e,t,r){const{size:i,dpr:n}=this.state.dimensions;this._draw(i,n,e,t,r)}_initInteraction(){const e=r=>{const i=this.canvas.getBoundingClientRect(),{cx:n,cy:s,size:o}=this.state.dimensions,l=r.clientX-i.left-n,c=r.clientY-i.top-s,h=Math.hypot(l,c),d=o*.5,f=o*.35,g=o*.2;let p=null;return h>g&&h<f?p="degree":h>f&&h<d?p="pitchClass":h<=g&&(p="chromatic"),{x:l,y:c,ring:p}},t=()=>{if(!this.state.drag.active)return;const r=this.state.drag.active;this.state.drag.active=null,this.canvas.style.cursor="grab",r==="chromatic"?yi(this.onInteractionEnd):r==="pitchClass"?_i("pitchClass",this.onInteractionEnd):r==="degree"&&mi(this.onInteractionEnd)};this.canvas.addEventListener("pointerdown",r=>{const{x:i,y:n,ring:s}=e(r);if(!s)return;const{drag:o,rings:l}=this.state;o.active=s,o.startX=i,o.startY=n,o.startPitchClass=l.pitchClass,o.startDegree=l.degree,o.startChrom=l.chromatic,o.startHighlight=l.highlightPosition,this.canvas.setPointerCapture(r.pointerId),this.canvas.style.cursor="grabbing"}),this.canvas.addEventListener("pointermove",r=>{if(this.state.drag.active){const{x:i,y:n}=e(r),s=this.state.drag,o=Math.atan2(s.startY,s.startX),c=Math.atan2(n,i)-o;s.active==="pitchClass"?at("pitchClass",s.startPitchClass+c):s.active==="degree"?(at("degree",s.startDegree+c),at("highlightPosition",s.startHighlight+c)):s.active==="chromatic"&&Tn({startPitchClass:s.startPitchClass,startDegree:s.startDegree,startChrom:s.startChrom,startHighlight:s.startHighlight},c)}else{const{ring:i}=e(r);this.canvas.style.cursor=i?"grab":"default"}}),this.canvas.addEventListener("pointerup",t),this.canvas.addEventListener("pointercancel",t),this.canvas.addEventListener("pointerleave",()=>{this.state.drag.active||(this.canvas.style.cursor="default")})}_draw(e,t,r,i,n){console.log("=== Wheel._draw CALLED ===",{size:e,dpr:t});const s=this.ctx;s.save(),s.clearRect(0,0,this.canvas.width,this.canvas.height),s.scale(t,t);const o=e/2,l=e/2,{pitchClass:c,degree:h,chromatic:d}=r,{chromaticLabels:f,diatonicLabels:g}=i;this.cachedLayers.lastSize!==e&&(this._regenerateCachedLayers(e,t),this.cachedLayers.lastSize=e);const u=(S,x,k)=>{const v=k-G/2,O=k+G/2;s.beginPath(),s.arc(o,l,x,v,O),s.arc(o,l,S,O,v,!0),s.closePath()},_=()=>{const S=e*.5,x=e*.35;Object.keys(pt).forEach((v,O)=>{const P=O*G+c-Math.PI/2;u(x,S,P),s.fillStyle=pt[v]?"#fff":"#000",s.fill(),s.lineWidth=e*.002,s.strokeStyle="#000",s.stroke()})},y=()=>{const S=e*.35,x=e*.2;for(let k=0;k<12;k++){const v=k*G+h-Math.PI/2;u(x,S,v),s.fillStyle=ar[k]||"#e0e0e0",s.fill(),s.lineWidth=e*.002,s.strokeStyle="#000",s.stroke()}},b=()=>{s.beginPath(),s.arc(o,l,e*.2,0,Math.PI*2),s.fillStyle="#000",s.fill()},w=()=>{const S=e*.5*.85,x=e*.35*.8,k=e*.2*.8,v=Object.keys(pt),O=(R,L,D,z,X)=>{s.fillStyle=z,s.font=`${X}px 'Atkinson Hyperlegible Next'`,s.textAlign="center",s.textBaseline="middle";const He=o+Math.cos(R)*L,Ae=l+Math.sin(R)*L;if(String(D).includes("<br>")){const Pe=D.split("<br>"),ye=X*1.1,Pt=Ae-ye*(Pe.length-1)/2;Pe.forEach((me,Te)=>{s.fillText(me,He,Pt+Te*ye)})}else s.fillText(D,He,Ae)},P=e*Dn;f.forEach((R,L)=>{const D=v[L],z=R,X=pt[D]?"#000":"#fff";O(L*G+c-Math.PI/2,S,z,X,P)});const M=e*Rn;g.forEach((R,L)=>{const D=ar[L],z=xn(D),X=R;O(L*G+h-Math.PI/2,x,X,z,M)});const I=e*Ln;An.forEach(R=>O(R*G+d-Math.PI/2,k,R.toString(),"#fff",I))},T=()=>{if(!n||!n.isPlaying||n.currentNoteIndex===null)return;const x=n.currentNoteIndex%12*G+c-Math.PI/2,k=e*.5,v=e*.2;u(v,k,x),s.fillStyle="rgba(255, 255, 0, 0.6)",s.fill()},C=()=>{const S=this.state.ui.cursorColor||"red",x=this.state.ui.cursorFill,k=wo[S],v=d-Math.PI/2,O=e*.5,P=e*.12;u(P,O,v),x&&(s.fillStyle=k.fill,s.fill()),s.strokeStyle=k.solid,s.lineWidth=e*.005,s.stroke()};console.log("Drawing outer ring..."),_(),console.log("Drawing middle ring..."),y(),console.log("Drawing inner circle..."),b(),console.log("Drawing labels..."),w(),console.log("Drawing playback highlight..."),T(),console.log("Drawing tonal center marker..."),C(),console.log("Wheel drawing complete"),s.restore()}}class xo{constructor(e,t,r){this.container=e,this.state=t,this.onInteractionEnd=r,this.elements={pitchBelt:e.querySelector("#pitchBelt"),degreeBelt:e.querySelector("#degreeBelt"),chromaticBelt:e.querySelector("#chromaticBelt"),chromaticColorsTrack:e.querySelector("#chromatic-colors-track"),chromaticNumbersTrack:e.querySelector("#chromatic-numbers-track"),intervalBracketsTrackContainer:e.querySelector("#intervalBracketsContainer"),intervalBracketsWrapper:e.querySelector(".interval-brackets-wrapper"),cursor:e.querySelector("#belt-cursor"),flashOverlay:e.querySelector("#belt-flash-overlay")},this.state.belts.tracks={},this.cachedCells={pitch:null,degree:null,chromaticColors:null,chromaticNumbers:null},this.lastAppliedLabels={chromatic:null,diatonic:null},this._initInteraction()}_calculateRingAngleToBeltPixelsRatio(e){return!e||e<=0?(console.warn("Invalid beltCellWidth for ring-to-belt conversion:",e),0):xe*e/We}update(e,t){const{orientation:r}=this.state.belts,{diatonicLabels:i,chromaticLabels:n}=e;if(console.log("=== Belts.update CALLED ===",{init:this.state.belts.init,orientation:r}),!this.state.belts.init){console.log("Belts not initialized - setting up..."),this.cachedCells={pitch:null,degree:null,chromaticColors:null,chromaticNumbers:null},this.lastAppliedLabels={chromatic:null,diatonic:null},this._chromaticColorsApplied=!1,this._setupAllBelts(i,n),requestAnimationFrame(()=>{this._calculateAllBeltCellWidths(r)&&(console.log("Belt sizes calculated, marking as initialized"),this.state.belts.init=!0,je(async()=>{const{StateTracker:y}=await Promise.resolve().then(()=>vo);return{StateTracker:y}},void 0,import.meta.url).then(({StateTracker:y})=>{y.markDirty(this.state)}))});return}console.log("Belts initialized, applying styles...");const{pitchClass:s,degree:o,chromatic:l,highlightPosition:c}=this.state.rings,{tracks:h,itemSize:d}=this.state.belts;this._applyBeltStyles(t,i,n);let f=r==="vertical"?-s:s,g=r==="vertical"?-o:o,p=r==="vertical"?-l:l,u=r==="vertical"?-c:c;this._positionBeltFromRingAngle(h.pitchBelt,f,d.pitchBelt,r),this._positionBeltFromRingAngle(h.degreeBelt,g,d.degreeBelt,r),this._positionBeltFromRingAngle(h.chromaticColors,u,d.chromaticBelt,r),this._positionBeltFromRingAngle(h.chromaticNumbers,p,d.chromaticBelt,r),this._positionIntervalBeltFromDegreeRing(g,d.degreeBelt,r),this._positionBeltCursorFromRingAngle(p,d.chromaticBelt,r),this._updatePlaybackFlashOnBelt()}_initInteraction(){const{pitchBelt:e,degreeBelt:t,intervalBrackets:r,chromaticNumbersTrack:i}=this.elements;e&&this._addDragHandler(e,o=>{const l=this.state.drag.startPitchClass+(this.state.belts.orientation==="vertical"?-o:o);at("pitchClass",l)},()=>_i("pitchClass",this.onInteractionEnd));const n=o=>{const l=this.state.belts.orientation==="vertical"?-o:o;at("degree",this.state.drag.startDegree+l),at("highlightPosition",this.state.drag.startHighlight+l)},s=()=>mi(this.onInteractionEnd);t&&this._addDragHandler(t,n,s),r&&this._addDragHandler(r,n,s),i&&this._addDragHandler(i,o=>{const l=this.state.belts.orientation==="vertical"?-o:o,c={startPitchClass:this.state.drag.startPitchClass,startDegree:this.state.drag.startDegree,startChrom:this.state.drag.startChrom,startHighlight:this.state.drag.startHighlight};Tn(c,l)},()=>yi(this.onInteractionEnd))}_addDragHandler(e,t,r){e.style.cursor="grab";let i=null,n=0,s=0;const o=h=>{i=h.pointerId,e.setPointerCapture(i),n=h.clientX,s=h.clientY;const{drag:d,rings:f}=this.state;d.active=e.id||"belt-drag",d.startPitchClass=f.pitchClass,d.startDegree=f.degree,d.startChrom=f.chromatic,d.startHighlight=f.highlightPosition,e.style.cursor="grabbing"},l=h=>{if(i!==h.pointerId)return;const{orientation:d,itemSize:f}=this.state.belts,g=d==="vertical"?h.clientY-s:h.clientX-n;let p;e.id.includes("pitch")?p="pitchBelt":e.id.includes("degree")||e.id.includes("interval")?p="degreeBelt":e.id.includes("chromatic")&&(p="chromaticBelt");const u=f[p];if(!u||u===0)return;const _=g/u*G;t(_)},c=()=>{i!==null&&(e.releasePointerCapture(i),i=null,this.state.drag.active=null,e.style.cursor="grab",r())};e.addEventListener("pointerdown",o),e.addEventListener("pointermove",l),e.addEventListener("pointerup",c),e.addEventListener("pointercancel",c)}_setupAllBelts(e,t){this.elements.pitchBelt.innerHTML="",this.elements.degreeBelt.innerHTML="",this.elements.intervalBracketsTrackContainer.innerHTML="";const r=3;this.state.belts.tracks.pitchBelt=this._createBeltTrack(this.elements.pitchBelt,t,r),this.state.belts.tracks.degreeBelt=this._createBeltTrack(this.elements.degreeBelt,e,r),this._populateBeltTrack(this.elements.chromaticColorsTrack,Array(12).fill(""),r),this._populateBeltTrack(this.elements.chromaticNumbersTrack,[...Array(12).keys()],r),this.state.belts.tracks.chromaticColors=this.elements.chromaticColorsTrack,this.state.belts.tracks.chromaticNumbers=this.elements.chromaticNumbersTrack,this._createIntervalBeltTrack(r)}_createBeltTrack(e,t,r){const i=document.createElement("div");return i.className="belt-track",this._populateBeltTrack(i,t,r),e.appendChild(i),i}_populateBeltTrack(e,t,r){e.innerHTML="";const i=3,n=t.length;for(let s=0;s<r*xe+i;s++){const o=s%n,l=t[o],c=document.createElement("div");c.className="belt-cell",c.innerHTML=String(l),c.dataset.originalIndex=String(o),e.appendChild(c)}}_createIntervalBeltTrack(e){const t=document.createElement("div");t.className="interval-brackets-track";const r=3;for(let i=0;i<xe*e+r;i++){const n=i%xe,s=Nt.indexOf(n),o=document.createElement("div");if(o.className="interval-bracket-cell",s!==-1){const l=In[s];o.dataset.steps=l,o.innerHTML=`<span>+${l}</span>`}t.appendChild(o)}this.elements.intervalBracketsTrackContainer.appendChild(t)}_calculateAllBeltCellWidths(e){return this._calculateBeltCellWidth("pitchBelt",this.elements.pitchBelt,e)&&this._calculateBeltCellWidth("degreeBelt",this.elements.degreeBelt,e)&&this._calculateBeltCellWidth("chromaticBelt",this.elements.chromaticBelt,e)&&this._calculateBeltCellWidth("intervalBracketsContainer",this.elements.intervalBracketsWrapper,e)}_calculateBeltCellWidth(e,t,r){const i=r==="vertical"?t.offsetHeight:t.offsetWidth;return i>0?(this.state.belts.itemSize[e]=i/xe,!0):!1}_applyBeltStyles(e,t,r){var g,p,u;console.log("=== _applyBeltStyles CALLED ===");const i=r.join(","),n=t.join(","),s=this.lastAppliedLabels.chromatic!==i||this.lastAppliedLabels.diatonic!==n,o=this.lastAppliedLabels.chromatic===null;!this.cachedCells.pitch&&this.state.belts.tracks.pitchBelt&&(this.cachedCells.pitch=this.state.belts.tracks.pitchBelt.querySelectorAll(".belt-cell"),console.log("Cached pitch cells:",this.cachedCells.pitch.length)),!this.cachedCells.degree&&this.state.belts.tracks.degreeBelt&&(this.cachedCells.degree=this.state.belts.tracks.degreeBelt.querySelectorAll(".belt-cell"),console.log("Cached degree cells:",this.cachedCells.degree.length)),!this.cachedCells.chromaticColors&&this.elements.chromaticColorsTrack&&(this.cachedCells.chromaticColors=this.elements.chromaticColorsTrack.querySelectorAll(".belt-cell"),console.log("Cached chromatic color cells:",this.cachedCells.chromaticColors.length)),!this.cachedCells.chromaticNumbers&&this.elements.chromaticNumbersTrack&&(this.cachedCells.chromaticNumbers=this.elements.chromaticNumbersTrack.querySelectorAll(".belt-cell"),console.log("Cached chromatic number cells:",this.cachedCells.chromaticNumbers.length)),console.log("Belt styling state:",{isFirstRun:o,labelsChanged:s,hasPitchCells:!!this.cachedCells.pitch,pitchCellCount:((g=this.cachedCells.pitch)==null?void 0:g.length)||0,hasDegreeCells:!!this.cachedCells.degree,degreeCellCount:((p=this.cachedCells.degree)==null?void 0:p.length)||0,hasChromaticColors:!!this.cachedCells.chromaticColors,chromaticColorCount:((u=this.cachedCells.chromaticColors)==null?void 0:u.length)||0});const l=(s||o)&&this.cachedCells.pitch,c=this.cachedCells.pitch&&this.cachedCells.pitch.length>0&&!this.cachedCells.pitch[0].style.background;(l||c)&&this.cachedCells.pitch?(console.log("APPLYING PITCH BELT COLORS!",{shouldUpdatePitch:l,needsInitialColors:c,cellCount:this.cachedCells.pitch.length}),this.cachedCells.pitch.forEach(_=>{const y=+_.dataset.originalIndex,b=Lt[y],w=pt[b];_.style.background=w?"#fff":"#000",_.style.color=w?"#000":"#fff",_.innerHTML=r[y]})):console.log("SKIPPED pitch belt colors:",{shouldUpdatePitch:l,needsInitialColors:c,hasCells:!!this.cachedCells.pitch});const h=(s||o)&&this.cachedCells.degree,d=this.cachedCells.degree&&this.cachedCells.degree.length>0&&!this.cachedCells.degree[0].style.background;(h||d)&&this.cachedCells.degree?(console.log("APPLYING DEGREE BELT COLORS!",{shouldUpdateDegree:h,needsInitialDegreeColors:d,cellCount:this.cachedCells.degree.length}),this.cachedCells.degree.forEach(_=>{const y=+_.dataset.originalIndex,b=ar[y]||"#f0f0f0";_.style.background=b,_.style.color=xn(b),_.innerHTML=t[y]})):console.log("SKIPPED degree belt colors:",{shouldUpdateDegree:h,needsInitialDegreeColors:d,hasCells:!!this.cachedCells.degree});const f=this.cachedCells.chromaticColors&&this.cachedCells.chromaticColors.length>0&&!this.cachedCells.chromaticColors[0].style.background;if((!this._chromaticColorsApplied||o||f)&&this.cachedCells.chromaticColors?(console.log("APPLYING CHROMATIC COLORS!",{chromaticColorsApplied:this._chromaticColorsApplied,isFirstRun:o,needsInitialChromatic:f,cellCount:this.cachedCells.chromaticColors.length}),this.cachedCells.chromaticColors.forEach(_=>{const y=+_.dataset.originalIndex;_.style.background=e.includes(y)?"#e0e0e0":"#4a4a4a"}),this._chromaticColorsApplied=!0):console.log("SKIPPED chromatic colors:",{chromaticColorsApplied:this._chromaticColorsApplied,isFirstRun:o,needsInitialChromatic:f,hasCells:!!this.cachedCells.chromaticColors}),this.cachedCells.chromaticNumbers){const{chromatic:_,highlightPosition:y}=this.state.rings,w=F(y-_)/G;this.cachedCells.chromaticNumbers.forEach(T=>{const C=+T.dataset.originalIndex,S=Math.round((C-w+12*100)%12)%12,x=e.includes(S)?"black":"lightgray";T.style.color!==x&&(T.style.color=x)})}s&&(this.lastAppliedLabels.chromatic=i,this.lastAppliedLabels.diatonic=n)}_convertRingAngleToBeltDistance(e,t,r){const i=this._calculateRingAngleToBeltPixelsRatio(t);if(i===0)return 0;const n=e*i;let s,o=0;return r==="vertical"?(s=-(t*xe),o=3*t,s-o+n):(s=-(t*xe),s+n)}_positionBeltFromRingAngle(e,t,r,i){if(!e||!r)return;const n=this._convertRingAngleToBeltDistance(t,r,i),s=i==="vertical"?`translateY(${n}px)`:`translateX(${n}px)`;e.style.transform=s}_positionIntervalBeltFromDegreeRing(e,t,r){const i=this.elements.intervalBracketsTrackContainer.querySelector(".interval-brackets-track");if(!i||!t)return;let n=this._convertRingAngleToBeltDistance(e,t,r);r==="horizontal"&&(n+=.5*t);const s=r==="vertical"?`translateY(${n}px)`:`translateX(${n}px)`;i.style.transform=s}_positionBeltCursorFromRingAngle(e,t,r){const i=this.elements.cursor;if(console.log("=== Positioning belt cursor ===",{hasCursor:!!i,beltCellWidth:t,orientation:r,chromaticRingAngle:e}),!i||!t){console.warn("Cannot position cursor - missing element or cell width");return}this._updateBeltCursorColors(i);const n=this._calculateRingAngleToBeltPixelsRatio(t);if(n===0){console.warn("Cannot position cursor - invalid pixel ratio");return}const s=e*n;let o;if(r==="vertical"){const c=-xe*t;o=(s%c+c)%c}else o=s;const l=r==="vertical"?`translateY(${o}px)`:`translateX(${o}px)`;i.style.transform=l,console.log("Belt cursor positioned:",{transform:l,cursorBeltPosition:o})}_updateBeltCursorColors(e){const t=this.state.ui.cursorColor||"red",r=this.state.ui.cursorFill,n={red:{solid:"red",fill:"rgba(255, 0, 0, 0.2)"},blue:{solid:"blue",fill:"rgba(0, 0, 255, 0.2)"},green:{solid:"green",fill:"rgba(0, 255, 0, 0.2)"},yellow:{solid:"#FFD700",fill:"rgba(255, 215, 0, 0.2)"}}[t];e.style.borderColor=n.solid,e.style.background=r?n.fill:"transparent"}_updatePlaybackFlashOnBelt(){const{rings:e,playback:t,belts:r}=this.state,i=this.elements.flashOverlay,n=r.itemSize.chromaticBelt,s=r.orientation;if(!i||!n||!t.isPlaying||t.currentNoteIndex===null){i.style.display="none";return}const o=this._calculateRingAngleToBeltPixelsRatio(n);if(o===0){i.style.display="none";return}let l;if(s==="vertical"){const h=-e.chromatic,d=(t.currentNoteIndex-t.rootNoteIndexForPlayback)*G,g=(h-d)*o,p=-xe*n;l=(g%p+p)%p}else l=(e.chromatic+(t.currentNoteIndex-t.rootNoteIndexForPlayback)*G)*o;const c=s==="vertical"?`translateY(${l}px)`:`translateX(${l}px)`;i.style.transform=c,i.style.display="block"}}class ko{constructor(){this.container=null,this.draggedItem=null,this.dragOverItem=null,this.onOrderChange=null,this.init()}init(){try{if(this.container=document.getElementById("belt-order-list"),!this.container)throw new Error("Order list container not found");this._setupEventListeners(),this._loadSavedOrder(),this._updateDisplay()}catch(e){E.handle(e,"OrderManager",()=>{console.error("Failed to initialize Order Manager")})}}_setupEventListeners(){this.container.addEventListener("dragstart",this._handleDragStart.bind(this)),this.container.addEventListener("dragover",this._handleDragOver.bind(this)),this.container.addEventListener("dragenter",this._handleDragEnter.bind(this)),this.container.addEventListener("dragleave",this._handleDragLeave.bind(this)),this.container.addEventListener("drop",this._handleDrop.bind(this)),this.container.addEventListener("dragend",this._handleDragEnd.bind(this))}_handleDragStart(e){if(console.log("Drag start event triggered",e.target),!e.target.classList.contains("order-item")){console.log("Not an order-item, ignoring");return}this.draggedItem=e.target,this.draggedItem.classList.add("dragging"),console.log("Dragging item:",this.draggedItem.dataset.component),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",this.draggedItem.outerHTML),setTimeout(()=>{this.draggedItem&&(this.draggedItem.style.opacity="0")},1)}_handleDragOver(e){e.preventDefault(),e.dataTransfer.dropEffect="move"}_handleDragEnter(e){e.target.classList.contains("order-item")&&e.target!==this.draggedItem&&(this.dragOverItem=e.target,e.target.classList.add("drag-over"),this._animateReorder(e.target))}_handleDragLeave(e){e.target.classList.contains("order-item")&&e.target.classList.remove("drag-over")}_handleDrop(e){if(e.preventDefault(),console.log("Drop event triggered"),!this.dragOverItem||this.dragOverItem===this.draggedItem){console.log("Drop cancelled - no valid target");return}const t=this.draggedItem.dataset.component,r=this.dragOverItem.dataset.component;console.log(`Dropping ${t} onto ${r}`),this._reorderComponents(t,r),this._saveOrder(),this._updateDisplay(),this._applyComponentOrder()}_handleDragEnd(e){this.draggedItem&&(this.draggedItem.classList.remove("dragging"),this.draggedItem.style.opacity=""),this.container.querySelectorAll(".drag-over").forEach(t=>{t.classList.remove("drag-over")}),this._resetAnimations(),this.draggedItem=null,this.dragOverItem=null}_reorderComponents(e,t){const r=m.belts.orientation,i=[...m.belts.layoutOrder[r]];r==="vertical"?this._reorderVerticalLayout(e,t,i):this._reorderHorizontalLayout(e,t,i)}_reorderHorizontalLayout(e,t,r){const i=r.indexOf(e),n=r.indexOf(t);if(console.log("=== HORIZONTAL REORDER DEBUG ===",{draggedId:e,targetId:t,currentOrder:[...r],draggedIndex:i,targetIndex:n}),i===-1||n===-1){console.log("Invalid indices - horizontal reorder cancelled");return}r.splice(i,1);const s=i<n?n:n+1;console.log("Horizontal reorder calculation:",{afterRemoval:[...r],newTargetIndex:s,calculation:`${i} < ${n} ? ${n} : ${n+1}`,explanation:i<n?"Moving forward: place after target":"Moving backward: place after target"}),r.splice(s,0,e),console.log("Final horizontal order:",[...r]),m.belts.layoutOrder.horizontal=r}_reorderVerticalLayout(e,t,r){if(console.log("=== VERTICAL REORDER DEBUG ===",{draggedId:e,targetId:t,currentOrder:r,isCompassInvolved:e==="compass"||t==="compass"}),e==="compass"||t==="compass"){const i=["intervals","pitch","chromatic","degree"];let n=t,s=e;i.includes(t)&&(n="result",console.log(`Converting belt target '${t}' to 'result'`)),i.includes(e)&&(s="result",console.log(`Converting belt dragged '${e}' to 'result'`));const o=r.indexOf(s),l=r.indexOf(n);if(console.log("Compass reorder indices:",{draggedIndex:o,targetIndex:l,actualDraggedId:s,actualTargetId:n}),o!==-1&&l!==-1&&o!==l){r.splice(o,1);let c;s==="compass"&&i.includes(t)?(c=r.length,console.log("Placing compass after result group at index:",c)):(c=o<l?l:l+1,console.log("Normal reorder to index:",c)),r.splice(c,0,s),m.belts.layoutOrder.vertical=r,console.log("New vertical layout order:",r)}else console.log("Invalid indices or same position - reorder cancelled")}else console.log("Belt reorder within result group"),this._reorderBelts(e,t)}_reorderBelts(e,t){const r=[...m.belts.order],i=r.indexOf(e),n=r.indexOf(t);if(console.log("=== BELT REORDER DEBUG ===",{draggedBelt:e,targetBelt:t,currentOrder:[...r],draggedIndex:i,targetIndex:n}),i===-1||n===-1)return;r.splice(i,1);const s=i<n?n:n+1;console.log("Belt reorder calculation:",{afterRemoval:[...r],newTargetIndex:s,calculation:`${i} < ${n} ? ${n} : ${n+1}`,explanation:i<n?"Moving forward: place after target":"Moving backward: place after target"}),r.splice(s,0,e),console.log("Final belt order:",[...r]),m.belts.order=r}_updateDisplay(){const e=m.belts.orientation;this.container.innerHTML="",e==="horizontal"?this._renderHorizontalLayout():this._renderVerticalLayout()}_renderHorizontalLayout(){m.belts.layoutOrder.horizontal.forEach(t=>{const r=this._createOrderItem(t,this._getComponentLabel(t));this.container.appendChild(r)})}_renderVerticalLayout(){const e=m.belts.layoutOrder.vertical;console.log("=== RENDERING VERTICAL LAYOUT ===",{order:e,beltOrder:m.belts.order}),e.forEach((t,r)=>{if(console.log(`Rendering component ${r}: ${t}`),t==="result"){const i=this._createOrderItem("result","Mode Name",!0);this.container.appendChild(i),console.log("Added result group item"),m.belts.order.forEach((n,s)=>{const o=this._createOrderItem(n,this._getComponentLabel(n),!1,!0);this.container.appendChild(o),console.log(`Added nested belt item ${s}: ${n}`)})}else{const i=this._createOrderItem(t,this._getComponentLabel(t));this.container.appendChild(i),console.log(`Added regular item: ${t}`)}}),console.log("Final sidebar structure:",Array.from(this.container.children).map(t=>({className:t.className,textContent:t.textContent.trim(),dataComponent:t.dataset.component})))}_createOrderItem(e,t,r=!1,i=!1){const n=document.createElement("div");n.className=`order-item${r?" group":""}${i?" nested":""}`,n.draggable=!0,n.dataset.component=e;const s=document.createElement("span");s.className="drag-handle",s.textContent="⋮⋮";const o=document.createElement("span");if(o.className="component-label",o.textContent=t,i){const l=document.createElement("span");l.className="nested-indent",l.textContent="  ",n.appendChild(l)}return n.appendChild(s),n.appendChild(o),n}_getComponentLabel(e){return{compass:"Compass",result:"Mode Name",pitch:"Pitch",degree:"Degrees",intervals:"Intervals",chromatic:"Chromatic"}[e]||e}_saveOrder(){try{const e=vt();e.layoutOrder=m.belts.layoutOrder,e.beltOrder=m.belts.order,Xt(e)}catch(e){console.warn("Failed to save order preferences:",e)}}_loadSavedOrder(){try{const e=vt();e&&e.layoutOrder&&(m.belts.layoutOrder=e.layoutOrder),e&&e.beltOrder&&(m.belts.order=e.beltOrder)}catch(e){console.warn("Failed to load order preferences:",e)}}_applyComponentOrder(){this.onOrderChange&&this.onOrderChange(m.belts.layoutOrder,m.belts.order)}setOrderChangeCallback(e){this.onOrderChange=e}onOrientationChange(){this._updateDisplay()}_animateReorder(e){if(!this.draggedItem||!e)return;const t=Array.from(this.container.querySelectorAll(".order-item")),r=t.indexOf(this.draggedItem),i=t.indexOf(e);if(r===-1||i===-1)return;const n=r>i;t.forEach((s,o)=>{if(s===this.draggedItem)return;let l=0;n?o>=i&&o<r&&(l=this.draggedItem.offsetHeight+8):o>r&&o<=i&&(l=-(this.draggedItem.offsetHeight+8)),s.style.transform=`translateY(${l}px)`,s.style.transition="transform 0.2s ease"})}_resetAnimations(){this.container.querySelectorAll(".order-item").forEach(t=>{t.style.transform="",t.style.transition=""})}destroy(){this.container&&(this.container.removeEventListener("dragstart",this._handleDragStart.bind(this)),this.container.removeEventListener("dragover",this._handleDragOver.bind(this)),this.container.removeEventListener("dragenter",this._handleDragEnter.bind(this)),this.container.removeEventListener("dragleave",this._handleDragLeave.bind(this)),this.container.removeEventListener("drop",this._handleDrop.bind(this)),this.container.removeEventListener("dragend",this._handleDragEnd.bind(this)))}}class So{constructor(e,t,r){this.state=t,this.callbacks=r,this.elements={resultContainer:e.querySelector("#result-container"),resultText:e.querySelector("#result-text"),flatBtn:document.getElementById("flat-btn"),sharpBtn:document.getElementById("sharp-btn"),settingsBtn:document.getElementById("settings-btn"),sidebar:document.getElementById("sidebar"),sidebarOverlay:document.getElementById("sidebar-overlay"),orientationHorizontal:document.getElementById("orientation-horizontal"),orientationVertical:document.getElementById("orientation-vertical"),themeLight:document.getElementById("theme-light"),themeDark:document.getElementById("theme-dark"),startTutorialBtn:document.getElementById("start-tutorial-btn")},this._initListeners(),this._initBeltOrderManager(),this._loadSavedPreferences()}_initListeners(){this.elements.flatBtn.addEventListener("click",this.callbacks.onToggleFlat),this.elements.sharpBtn.addEventListener("click",this.callbacks.onToggleSharp),this.elements.resultContainer.addEventListener("click",i=>{i.target.closest("button")||this.callbacks.onTogglePlayback()}),this.elements.settingsBtn.addEventListener("click",i=>{i.stopPropagation(),this.callbacks.onToggleSidebar()}),this.elements.sidebarOverlay.addEventListener("click",()=>{this.state.ui.sidebarOpen&&this.callbacks.onToggleSidebar(!1)}),this.elements.orientationHorizontal.addEventListener("change",()=>{this.elements.orientationHorizontal.checked&&this.callbacks.onToggleOrientation("horizontal")}),this.elements.orientationVertical.addEventListener("change",()=>{this.elements.orientationVertical.checked&&this.callbacks.onToggleOrientation("vertical")}),this.elements.themeLight.addEventListener("change",()=>{this.elements.themeLight.checked&&this.callbacks.onToggleDarkMode(!1)}),this.elements.themeDark.addEventListener("change",()=>{this.elements.themeDark.checked&&this.callbacks.onToggleDarkMode(!0)}),this.elements.startTutorialBtn.addEventListener("click",this.callbacks.onStartTutorial);const e=document.querySelectorAll(".cursor-color-btn");e.forEach(i=>{i.addEventListener("click",()=>{const n=i.dataset.color,s=i.dataset.fill==="true";e.forEach(o=>{o.classList.remove("active"),o.setAttribute("aria-checked","false")}),i.classList.add("active"),i.setAttribute("aria-checked","true"),this.callbacks.onSetCursorColor&&this.callbacks.onSetCursorColor(n,s)})});const t=document.getElementById("orientation-toggle"),r=document.getElementById("theme-toggle");t.addEventListener("click",i=>{console.log("Orientation toggle clicked",i.target);const n=this.elements.orientationHorizontal.checked;console.log("Current orientation horizontal checked:",n),n?(console.log("Switching to vertical"),this.callbacks.onToggleOrientation("vertical")):(console.log("Switching to horizontal"),this.callbacks.onToggleOrientation("horizontal"))}),r.addEventListener("click",i=>{console.log("Theme toggle clicked",i.target);const n=this.elements.themeLight.checked;console.log("Current theme light checked:",n),n?(console.log("Switching to dark mode"),this.callbacks.onToggleDarkMode(!0)):(console.log("Switching to light mode"),this.callbacks.onToggleDarkMode(!1))})}_initBeltOrderManager(){try{this.orderManager=new ko,this.orderManager.setOrderChangeCallback((e,t)=>{this.callbacks.onOrderChange&&this.callbacks.onOrderChange(e,t)})}catch(e){console.warn("Order Manager failed to initialize:",e)}}async _loadSavedPreferences(){try{const{loadPreferences:e}=await je(async()=>{const{loadPreferences:r}=await Promise.resolve().then(()=>wi);return{loadPreferences:r}},void 0,import.meta.url),t=e();t&&t.cursorColor&&t.cursorFill!==void 0&&(this.state.ui.cursorColor=t.cursorColor,this.state.ui.cursorFill=t.cursorFill,document.querySelectorAll(".cursor-color-btn").forEach(i=>{const n=i.dataset.color===t.cursorColor,s=i.dataset.fill===String(t.cursorFill),o=n&&s;i.classList.toggle("active",o),i.setAttribute("aria-checked",String(o))}))}catch(e){console.warn("Could not load saved cursor preferences:",e)}}update(){const{display:e,playback:t,ui:r,belts:i}=this.state,{resultContainer:n,flatBtn:s,sharpBtn:o,resultText:l,sidebar:c,sidebarOverlay:h,settingsBtn:d,orientationHorizontal:f,orientationVertical:g,themeLight:p,themeDark:u}=this.elements;s.classList.toggle("active",e.flat),o.classList.toggle("active",e.sharp),s.setAttribute("aria-pressed",String(e.flat)),o.setAttribute("aria-pressed",String(e.sharp)),n.classList.toggle("playback-active",t.isPlaying),Xn(this.state,l);const _=i.orientation==="horizontal";f.checked=_,g.checked=!_,p.checked=!r.darkMode,u.checked=r.darkMode;const y=r.sidebarOpen;c.classList.toggle("open",y),y?c.removeAttribute("aria-hidden"):c.setAttribute("aria-hidden","true"),h.classList.toggle("visible",y),d.setAttribute("aria-expanded",String(y)),this.orderManager&&this._lastOrientation!==i.orientation&&(this.orderManager.onOrientationChange(),this._lastOrientation=i.orientation)}destroy(){this.orderManager&&(this.orderManager.destroy(),this.orderManager=null)}}class Eo{constructor(e){this.container=e,this.state=m,this.isInitialized=!1,this.cleanupFunctions=[],this.performanceMonitor=null,this.keyboardManager=null,this.screenReaderManager=null;try{this._initializeApp()}catch(t){E.handle(t,"App",()=>{console.error("Failed to initialize app")})}}_initializeApp(){if(this.elements={canvas:this.container.querySelector("#chromaWheel"),beltsContainer:this.container.querySelector(".belts-container")},!this.elements.canvas)throw new Error("Canvas element not found");if(!this.elements.beltsContainer)throw new Error("Belts container not found");const e={onToggleFlat:E.wrap(()=>{j.toggleAccidental("flat"),this._announceChange(`Flat names ${this.state.display.flat?"enabled":"disabled"}`)},"UI"),onToggleSharp:E.wrap(()=>{j.toggleAccidental("sharp"),this._announceChange(`Sharp names ${this.state.display.sharp?"enabled":"disabled"}`)},"UI"),onToggleDarkMode:E.wrap(t=>{typeof t=="boolean"?this.state.ui.darkMode!==t&&j.toggleDarkMode():j.toggleDarkMode(),this._announceChange(`${this.state.ui.darkMode?"Dark":"Light"} mode enabled`)},"UI"),onTogglePlayback:E.wrap(()=>{j.togglePlayback(),this._announceChange(this.state.playback.isPlaying?"Scale playing":"Playback stopped")},"UI"),onToggleSidebar:E.wrap(t=>{j.toggleSidebar(t),this._announceChange(`Settings ${this.state.ui.sidebarOpen?"opened":"closed"}`)},"UI"),onToggleOrientation:E.wrap(t=>{let r;typeof t=="string"?r=t:r=this.state.belts.orientation==="horizontal"?"vertical":"horizontal",this.state.belts.orientation!==r&&(j.setOrientation(r),this._announceChange(`Layout changed to ${r}`))},"UI"),onStartTutorial:E.wrap(()=>{this._announceChange("Tutorial started"),Co()},"Tutorial"),onShowKeyboardHelp:E.wrap(()=>{this._showKeyboardHelp()},"UI"),onOrderChange:E.wrap((t,r)=>{console.log("Order change triggered:",{layoutOrder:t,beltOrder:r}),this._applyComponentOrder(t,r)},"UI"),onSetCursorColor:E.wrap((t,r)=>{j.setCursorColor(t,r),this._announceChange(`Cursor color changed to ${t}${r?" with fill":""}`)},"UI")};try{this.wheel=new To(this.elements.canvas,this.state,this.onInteractionEnd.bind(this))}catch(t){E.handle(t,"Wheel",()=>{console.error("Wheel component failed to initialize")})}try{this.belts=new xo(this.elements.beltsContainer,this.state,this.onInteractionEnd.bind(this))}catch(t){E.handle(t,"Belts",()=>{console.error("Belts component failed to initialize")})}try{this.uiControls=new So(this.container,this.state,e)}catch(t){E.handle(t,"UIControls",()=>{console.error("UI Controls failed to initialize")})}this._initializeAccessibility(),this._setupResponsiveLogic();try{zn(E.wrap(this.redraw.bind(this),"RenderLoop"))}catch(t){E.handle(t,"RenderLoop",()=>{console.error("Render loop failed to start")})}this._setupPerformanceMonitoring(),this._setupAccessibilityMonitoring(),Me.markDirty(this.state),this.isInitialized=!0}_initializeAccessibility(){try{this._loadAccessibilityModules().then(()=>{console.log("Accessibility features loaded")}).catch(()=>{console.log("Using basic accessibility features"),this._setupBasicAccessibility()})}catch(e){E.handle(e,"Accessibility",()=>{console.warn("Some accessibility features may not be available"),this._setupBasicAccessibility()})}}async _loadAccessibilityModules(){try{const{KeyboardManager:e}=await je(async()=>{const{KeyboardManager:r}=await import("./KeyboardManager-CqV72rZX.js");return{KeyboardManager:r}},[],import.meta.url),{ScreenReaderManager:t}=await je(async()=>{const{ScreenReaderManager:r}=await import("./ScreenReaderManager-BZXTKZU1.js");return{ScreenReaderManager:r}},[],import.meta.url);return e.init(),t.init(),this.keyboardManager=e,this.screenReaderManager=t,!0}catch{throw new Error("Accessibility modules not available")}}_setupBasicAccessibility(){this._setupBasicKeyboard(),this._setupBasicARIA(),this._setupBasicAnnouncements()}_setupBasicKeyboard(){const e=t=>{if(!this._isTextInputActive()&&!(t.ctrlKey||t.altKey||t.metaKey))switch(t.key){case"ArrowLeft":(t.target.id==="chromaWheel"||t.target.closest(".belt"))&&(t.preventDefault(),this._rotateRing("pitchClass",-1),this._announceChange("Pitch ring rotated left"));break;case"ArrowRight":(t.target.id==="chromaWheel"||t.target.closest(".belt"))&&(t.preventDefault(),this._rotateRing("pitchClass",1),this._announceChange("Pitch ring rotated right"));break;case"ArrowUp":(t.target.id==="chromaWheel"||t.target.closest(".belt"))&&(t.preventDefault(),this._rotateRing("pitchClass",1),this._announceChange("Pitch ring rotated up"));break;case"ArrowDown":(t.target.id==="chromaWheel"||t.target.closest(".belt"))&&(t.preventDefault(),this._rotateRing("pitchClass",-1),this._announceChange("Pitch ring rotated down"));break;case" ":case"Enter":!t.target.closest("button")&&!t.target.closest("input")&&!t.target.closest("select")&&(t.preventDefault(),j.togglePlayback());break;case"Escape":j.toggleSidebar(),this._announceChange(this.state.ui.sidebarOpen?"Settings opened":"Settings closed");break;case"f":case"F":t.preventDefault(),j.toggleAccidental("flat"),this._announceChange(`Flat names ${this.state.display.flat?"enabled":"disabled"}`);break;case"s":case"S":t.preventDefault(),j.toggleAccidental("sharp"),this._announceChange(`Sharp names ${this.state.display.sharp?"enabled":"disabled"}`);break;case"v":case"V":t.preventDefault();const r=this.state.belts.orientation==="horizontal"?"vertical":"horizontal";j.setOrientation(r),this._announceChange(`Layout changed to ${r}`);break}};document.addEventListener("keydown",e),this.cleanupFunctions.push(()=>{document.removeEventListener("keydown",e)})}_rotateRing(e,t){const r=t*(Math.PI*2/12),n=(this.state.rings[e]+r)%(Math.PI*2);j.setRingAngle(e,n)}_isTextInputActive(){const e=document.activeElement;return["INPUT","TEXTAREA","SELECT"].includes(e==null?void 0:e.tagName)||(e==null?void 0:e.contentEditable)==="true"}_applyComponentOrder(e,t){console.log("Applying component order:",{layoutOrder:e,beltOrder:t});const r=this.state.belts.orientation,i=e[r];console.log(`Current orientation: ${r}, order:`,i);let n=this.container.querySelector(".main-container");n||(n=document.querySelector(".main-container")),n&&this._restoreOriginalStructure(n),r==="horizontal"?(console.log("Calling _applyHorizontalOrder"),this._applyHorizontalOrder(i)):(console.log("Calling _applyVerticalOrder"),this._applyVerticalOrder(i)),t&&(console.log("Applying belt order:",t),this._applyBeltOrder(t))}_applyHorizontalOrder(e){console.log("_applyHorizontalOrder called with order:",e);let t=this.container.querySelector(".main-container");if(t||(t=document.querySelector(".main-container")),!t){console.log("ERROR: main-container not found anywhere"),console.log("this.container is:",this.container);return}console.log("Container element:",t),console.log("Container classes:",t.className),console.log("Container computed styles before:",{display:getComputedStyle(t).display,flexDirection:getComputedStyle(t).flexDirection,width:getComputedStyle(t).width,height:getComputedStyle(t).height});const r=t.querySelector(".belts-container"),i={compass:t.querySelector(".wheel-container"),result:t.querySelector("#result-container"),pitch:r==null?void 0:r.querySelector(".pitch-belt"),degree:r==null?void 0:r.querySelector(".degree-belt"),intervals:r==null?void 0:r.querySelector(".interval-brackets-wrapper"),chromatic:r==null?void 0:r.querySelector(".chromatic-belt")};console.log("Found components:",Object.keys(i).reduce((o,l)=>(o[l]=!!i[l],o),{})),console.log("Components dimensions before flattening:",{compass:i.compass?{width:i.compass.offsetWidth,height:i.compass.offsetHeight,display:getComputedStyle(i.compass).display}:null,beltsContainer:r?{width:r.offsetWidth,height:r.offsetHeight,display:getComputedStyle(r).display}:null});const n=["pitch","degree","intervals","chromatic"],s=[];n.forEach(o=>{const l=i[o];l&&(l._originalParent=l.parentNode,l._originalNextSibling=l.nextSibling,t.appendChild(l),s.push(l))}),r&&(r.style.display="none"),console.log("After flattening, container children:",Array.from(t.children).map(o=>({tagName:o.tagName,className:o.className,id:o.id,display:getComputedStyle(o).display,flex:getComputedStyle(o).flex,width:o.offsetWidth,height:o.offsetHeight}))),e.forEach((o,l)=>{const c=i[o];c&&(c.style.setProperty("order",l+1,"important"),console.log(`Set order ${l+1} for component:`,o),console.log("Element after order applied:",{width:c.offsetWidth,height:c.offsetHeight,display:getComputedStyle(c).display,flex:getComputedStyle(c).flex,order:getComputedStyle(c).order}))}),console.log("Container computed styles after:",{display:getComputedStyle(t).display,flexDirection:getComputedStyle(t).flexDirection,width:getComputedStyle(t).width,height:getComputedStyle(t).height}),t._isFlattened=!0,t._beltElements=s,t._beltsContainer=r}_applyVerticalOrder(e){let t=this.container.querySelector(".main-container");if(t||(t=document.querySelector(".main-container")),!t)return;this._restoreOriginalStructure(t);const r=e.indexOf("compass"),i=e.indexOf("result");console.log("Vertical layout indices:",{order:e,compassIndex:r,resultIndex:i,compassFirst:r<i}),r>i?(t.style.gridTemplateAreas=`
        "wheel belts"
        "wheel result"
      `,console.log("Applied vertical order: compass left, belts right (compass after result)")):(t.style.gridTemplateAreas=`
        "belts wheel"
        "result wheel"
      `,console.log("Applied vertical order: belts left, compass right (compass before result)"))}_restoreOriginalStructure(e){e._isFlattened&&(console.log("Restoring original DOM structure"),e._beltElements&&e._beltsContainer&&(e._beltElements.forEach(t=>{t.style.removeProperty("order"),t._originalNextSibling?t._originalParent.insertBefore(t,t._originalNextSibling):t._originalParent.appendChild(t),delete t._originalParent,delete t._originalNextSibling}),e._beltsContainer.style.display=""),delete e._isFlattened,delete e._beltElements,delete e._beltsContainer)}_applyBeltOrder(e){const t=this.elements.beltsContainer;if(!t)return;const r={pitch:t.querySelector(".pitch-belt"),degree:t.querySelector(".degree-belt"),intervals:t.querySelector(".interval-brackets-wrapper"),chromatic:t.querySelector(".chromatic-belt")};e.forEach((i,n)=>{const s=r[i];s&&(s.style.setProperty("order",n+1,"important"),console.log(`Set belt order ${n+1} for belt:`,i))})}_setupBasicARIA(){this.container.setAttribute("role","main"),this.container.setAttribute("aria-label","Diatonic Compass Music Theory Tool"),this.elements.canvas&&(this.elements.canvas.setAttribute("tabindex","0"),this.elements.canvas.setAttribute("role","application"),this.elements.canvas.setAttribute("aria-label","Interactive Diatonic Compass - use arrow keys to explore"));const e=document.querySelector("#result-container");e&&(e.setAttribute("tabindex","0"),e.setAttribute("aria-label","Current musical key and mode - click to play"))}_setupBasicAnnouncements(){const e=document.createElement("div");e.id="basic-announcements",e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","false"),e.style.cssText=`
      position: absolute;
      left: -10000px;
      width: 1px;
      height: 1px;
      overflow: hidden;
    `,document.body.appendChild(e),this.cleanupFunctions.push(()=>{e.parentNode&&e.parentNode.removeChild(e)})}_announceChange(e){const t=document.getElementById("basic-announcements");t&&(t.textContent="",setTimeout(()=>{t.textContent=e},100)),this.screenReaderManager&&this.screenReaderManager.queueAnnouncement(e)}_showKeyboardHelp(){const e=`
Keyboard Shortcuts:
- Tab: Navigate between controls
- Arrow keys: Rotate pitch ring (when focused on wheel/belts)
- Ctrl + arrows: Large steps (when focused on wheel/belts)
- Space/Enter: Play scale (when focused on wheel/result)
- F: Toggle flat note names
- S: Toggle sharp note names  
- V: Toggle vertical/horizontal layout
- H: Show this help
- Escape: Open/close settings

Focus the wheel or belts first, then use arrow keys to rotate rings.
    `.trim();alert(e)}_setupAccessibilityMonitoring(){const e=window.matchMedia("(prefers-reduced-motion: reduce)"),t=n=>{document.body.classList.toggle("reduced-motion",n.matches)};e.addListener(t),t(e),this.cleanupFunctions.push(()=>{e.removeListener(t)});const r=window.matchMedia("(prefers-contrast: high)"),i=n=>{document.body.classList.toggle("high-contrast",n.matches)};r.addListener(i),i(r),this.cleanupFunctions.push(()=>{r.removeListener(i)})}onInteractionEnd(){setTimeout(()=>{const e=document.querySelector("#result-text");e&&this._announceChange(`Current key: ${e.textContent}`)},100)}_setupResponsiveLogic(){const e=tt.debounce(()=>{try{const r=window.innerWidth>window.innerHeight?"vertical":"horizontal";this.state.belts.orientation!==r&&(j.setOrientation(r),this._announceChange(`Layout changed to ${r}`)),Me.markDirty(this.state)}catch(t){E.handle(t,"Resize",()=>{console.warn("Resize handling failed")})}},250);window.addEventListener("resize",e),this.cleanupFunctions.push(()=>{window.removeEventListener("resize",e),e.cancel()});try{const r=window.innerWidth>window.innerHeight?"vertical":"horizontal";j.setOrientation(r)}catch(t){E.handle(t,"Resize")}}_setupPerformanceMonitoring(){let e=0;const t=3;if(this.performanceMonitor=tt.createFPSMonitor(r=>{r<30?(e++,console.warn(`Low FPS detected: ${r} (count: ${e})`),e>=t&&!this.state.performance.isLowPowerMode&&(this.state.performance.isLowPowerMode=!0,document.body.classList.add("low-power-mode"),console.log("Low-power mode enabled due to poor performance"),this._announceChange("Performance mode adjusted for this device"))):r>=50&&(e=Math.max(0,e-1),e===0&&this.state.performance.isLowPowerMode&&(this.state.performance.isLowPowerMode=!1,document.body.classList.remove("low-power-mode"),console.log("Low-power mode disabled - performance improved")))},120),tt.getMemoryInfo()){const r=setInterval(()=>{const i=tt.getMemoryInfo();i&&i.used>100&&console.warn(`High memory usage: ${i.used}MB`)},3e4);this.cleanupFunctions.push(()=>clearInterval(r))}this.cleanupFunctions.push(()=>{this.performanceMonitor&&(this.performanceMonitor(),this.performanceMonitor=null)})}redraw(e){try{const t=Kn(e);if(!this.state.performance.isLowPowerMode&&!Me.needsRedraw(this.state)||(Hn(this.elements.canvas,this.state.dimensions)&&Me.markDirty(this.state),!this.state.dimensions.size)||this.state.performance.isLowPowerMode&&t&&(this.state.performance.frameSkipCounter++,this.state.performance.frameSkipCounter%2===1))return;const i=gi(this.state),{rings:n,playback:s}=this.state,o=Nt;if(this.wheel)try{this.wheel.update(n,i,s)}catch(l){E.handle(l,"Wheel",()=>{console.warn("Wheel update failed - skipping frame")})}if(this.belts)try{this.belts.update(i,o)}catch(l){E.handle(l,"Belts",()=>{console.warn("Belts update failed - skipping frame")})}if(this.uiControls)try{this.uiControls.update()}catch(l){E.handle(l,"UIControls",()=>{console.warn("UI Controls update failed - skipping frame")})}Me.markClean(this.state)}catch(t){E.handle(t,"RenderLoop",()=>{console.error("Critical render error - app may be unstable")})}}destroy(){try{this.keyboardManager,this.screenReaderManager&&this.screenReaderManager.cleanup(),this.cleanupFunctions.forEach(e=>{try{e()}catch(t){console.warn("Cleanup function failed:",t)}}),this.cleanupFunctions=[],this.wheel&&typeof this.wheel.destroy=="function"&&this.wheel.destroy(),this.belts&&typeof this.belts.destroy=="function"&&this.belts.destroy(),this.uiControls&&typeof this.uiControls.destroy=="function"&&this.uiControls.destroy(),this.performanceMonitor&&(this.performanceMonitor(),this.performanceMonitor=null),this.isInitialized=!1}catch(e){E.handle(e,"App",()=>{console.error("App cleanup failed")})}}_isDevelopment(){return window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.protocol==="file:"}getStatus(){var e,t;return{initialized:this.isInitialized,components:{wheel:!!this.wheel,belts:!!this.belts,uiControls:!!this.uiControls},accessibility:{keyboardEnabled:(e=this.keyboardManager)==null?void 0:e.isEnabled,screenReaderEnabled:(t=this.screenReaderManager)==null?void 0:t.isEnabled},dimensions:this.state.dimensions,errors:E.getErrorLog()}}}function Oo(){const a=vt();if(a&&(typeof a.darkMode=="boolean"&&(m.ui.darkMode=a.darkMode,document.body.classList.toggle("dark-mode",a.darkMode)),Array.isArray(a.beltOrder))){const e=["pitch","degree","intervals","chromatic"];if(e.every(r=>a.beltOrder.includes(r))&&a.beltOrder.length===e.length){m.belts.order=a.beltOrder;const r=document.querySelector(".belts-container");if(r){const i={pitch:".pitch-belt",degree:".degree-belt",intervals:".interval-brackets-wrapper",chromatic:".chromatic-belt"};a.beltOrder.forEach((n,s)=>{const o=i[n];if(o){const l=r.querySelector(o);l&&(l.style.order=s+1)}})}}}}document.addEventListener("DOMContentLoaded",()=>{Oo();const a=document.querySelector(".main-container");a&&new Eo(a)});export{j as A,Q as C,Nt as D,E,m as a,G as b,gi as c,Po as g,F as n,Gt as s};
