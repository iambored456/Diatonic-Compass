(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function e(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=e(i);fetch(i.href,a)}})();const l={rings:{pitchClass:0,degree:0,chromatic:0,highlightPosition:0},drag:{active:null,startX:0,startY:0,startPitchClass:0,startDegree:0,startChrom:0,startHighlight:0},belts:{itemSize:{},tracks:{},init:!1,orientation:"horizontal"},dimensions:{size:0,cx:0,cy:0,dpr:1},animation:null,playback:{isPlaying:!1,currentNoteIndex:null,sequence:[],timeoutId:null,audioContext:null,rootNoteIndexForPlayback:null},display:{sharp:!0,flat:!0},ui:{sidebarOpen:!1}};function ht(r){function t(e){r(e),requestAnimationFrame(t)}requestAnimationFrame(t)}function dt(r,t){const e=r.parentElement.offsetWidth,s=r.parentElement.offsetHeight,i=Math.min(e,s);return i===t.size||i===0?!1:(t.size=i,t.cx=i/2,t.cy=i/2,r.width=i*t.dpr,r.height=i*t.dpr,!0)}const G=["C","C♯/D♭","D","D♯/E♭","E","F","F♯/G♭","G","G♯/A♭","A","A♯/B♭","B"],X=["1","♯1/♭2","2","♯2/♭3","3","4","♯4/♭5","5","♯5/♭6","6","♯6/♭7","7"],gt=[...Array(12).keys()],R=[0,2,4,5,7,9,11],L={C:!0,"C♯/D♭":!1,D:!0,"D♯/E♭":!1,E:!0,F:!0,"F♯/G♭":!1,G:!0,"G♯/A♭":!1,A:!0,"A♯/B♭":!1,B:!0},$={0:"#f090ae",2:"#ea9e5e",4:"#a8bd61",5:"#76c788",7:"#33c6dc",9:"#94adff",11:"#dd95d6",1:"#a46055",3:"#8a722f",6:"#258677",8:"#3d7ca5",10:"#7d68a3"},ut={1:[0,2,4,5,7,9,11],2:[0,2,3,5,7,9,10],3:[0,1,3,5,7,8,10],4:[0,2,4,6,7,9,11],5:[0,2,4,5,7,9,10],6:[0,2,3,5,7,8,10],7:[0,1,3,5,6,8,10]},Q={1:"1","♯1/♭2":"2",2:"2","♯2/♭3":"3",3:"3",4:"4","♯4/♭5":"5",5:"5","♯5/♭6":"6",6:"6","♯6/♭7":"7",7:"7"},ft={1:"Major",2:"Dorian",3:"Phrygian",4:"Lydian",5:"Mixolydian",6:"Minor",7:"Locrian"},mt=[2,2,1,2,2,2,1],E=Math.PI*2,p=E/12,pt=.057,bt=.052,yt=.042,Ct=300,j=250,vt=50,kt=261.63,It=1/p,f=r=>(r%E+E)%E;function J(r,t){const e=f(t)-f(r);return e>Math.PI?e-E:e<-Math.PI?e+E:e}const Pt=r=>r<.5?2*r*r:-1+(4-2*r)*r,H=r=>(Math.round(-f(r)*It)%12+12)%12;function Tt(r){const{sharp:t,flat:e}=r.display,s=n=>{if(!n.includes("/"))return n;const[c,o]=n.split("/");return t&&e?`${c}<br>${o}`:t?c:e?o:`${c}<br>${o}`},i=G.map(s),a=X.map(s);return{chromaticLabels:i,diatonicLabels:a}}function Et(r,t){const{sharp:e,flat:s}=r.display,i=A=>{if(!A.includes("/"))return A;const[M,q]=A.split("/");return e&&s?A:e?M:s?q:M},a=G.map(i),{pitchClass:n,degree:c,chromatic:o}=r.rings,h=f(n-o),d=f(c-o),g=H(h),m=H(d),b=a[g],u=X[m],y=Q[u]||null,_=y?ft[y]:"...",D=`${b} ${_}`;t.textContent!==D&&(t.textContent=D)}function F(r,t=null){const e=performance.now(),s={fromPitchClass:l.rings.pitchClass,fromDegree:l.rings.degree,fromChrom:l.rings.chromatic,fromHighlight:l.rings.highlightPosition},i={toPitchClass:r.pitchClass??s.fromPitchClass,toDegree:r.degree??s.fromDegree,toChrom:r.chromatic??s.fromChrom,toHighlight:r.highlightPosition??s.fromHighlight};l.animation={t0:e,from:s,to:i,onComplete:t}}function xt(r){const t=l.animation;if(!t)return!1;const e=(r-t.t0)/Ct,s=e>=1?1:Pt(e),i=(a,n)=>f(a+J(a,n)*s);return l.rings.pitchClass=i(t.from.fromPitchClass,t.to.toPitchClass),l.rings.degree=i(t.from.fromDegree,t.to.toDegree),l.rings.chromatic=i(t.from.fromChrom,t.to.toChrom),l.rings.highlightPosition=i(t.from.fromHighlight,t.to.toHighlight),s===1&&(t.onComplete&&t.onComplete(),l.animation=null),!0}function Z(r,t){const e=l.rings[r],s=Math.round(-e/p),i=f(-s*p);F({[r]:i},t)}function tt(r){const{degree:t,chromatic:e}=l.rings,s=f(t-e),i=f(-s)/p;let a=R[0],n=1/0;R.forEach(h=>{const d=Math.abs(i-h),g=Math.min(d,12-d);g<n&&(n=g,a=h)});const c=f(-a*p),o=f(c+e);F({degree:o,highlightPosition:o},r)}function et(r){const t=Math.round(-l.rings.chromatic/p),e=f(-t*p),s=J(l.rings.chromatic,e),i=f(l.rings.pitchClass+s),a=f(l.rings.degree-l.rings.chromatic),n=f(a+e);F({pitchClass:i,degree:n,chromatic:e,highlightPosition:n},r)}function Bt(){if(l.playback.audioContext)return;const r=window.AudioContext||window.webkitAudioContext;l.playback.audioContext=new r,l.playback.audioContext.state==="suspended"&&l.playback.audioContext.resume()}function _t(r,t){const e=l.playback.audioContext;if(!e)return;const s=e.createOscillator(),i=e.createGain(),a=kt*Math.pow(2,r/12);s.frequency.setValueAtTime(a,e.currentTime),s.type="sine",s.connect(i),i.connect(e.destination),i.gain.setValueAtTime(0,e.currentTime),i.gain.linearRampToValueAtTime(.5,e.currentTime+.01),i.gain.linearRampToValueAtTime(0,e.currentTime+t),s.start(e.currentTime),s.stop(e.currentTime+t)}function At(){const{pitchClass:r,degree:t,chromatic:e}=l.rings,s=H(f(r-e)),i=H(f(t-e)),a=X[i],n=Q[a];if(!n)return[];const o=ut[n].map(h=>s+h);return o.push(o[0]+12),o}function st(){if(!l.playback.isPlaying){W();return}const r=l.playback.sequence;if(r.length===0){W();return}const t=r.shift();l.playback.currentNoteIndex=t,_t(t,j/1e3);const e=setTimeout(st,j+vt);l.playback.timeoutId=e}function St(){if(l.playback.isPlaying)return;Bt();const r=At();r.length!==0&&(l.playback.rootNoteIndexForPlayback=r[0],l.playback.isPlaying=!0,l.playback.sequence=r,st())}function W(){l.playback.isPlaying&&(clearTimeout(l.playback.timeoutId),l.playback.isPlaying=!1,l.playback.currentNoteIndex=null,l.playback.sequence=[],l.playback.timeoutId=null,l.playback.rootNoteIndexForPlayback=null)}const S={toggleAccidental(r){if(l.display[r]=!l.display[r],!l.display.sharp&&!l.display.flat){const t=r==="sharp"?"flat":"sharp";l.display[t]=!0}},togglePlayback(){l.playback.isPlaying?W():!l.drag.active&&!l.animation&&St()},toggleSidebar(r){l.ui.sidebarOpen=typeof r=="boolean"?r:!l.ui.sidebarOpen},setOrientation(r){l.belts.orientation!==r&&(l.belts.orientation=r,l.rings.pitchClass=0,l.rings.degree=0,l.rings.chromatic=0,l.rings.highlightPosition=0,l.belts.init=!1,document.querySelector(".main-container").classList.toggle("vertical-layout",r==="vertical"))},snapTo(r,t){F(r,t)}};function O(r,t){if(l.rings.hasOwnProperty(r)){const e=f(t);l.rings[r]=e}}function nt(r,t,e){const s=t;l.rings.chromatic=f(r.startChrom+s),l.rings.pitchClass=f(r.startPitchClass+t),l.rings.degree=f(r.startDegree+t),l.rings.highlightPosition=f(r.startHighlight+t)}function it(r){if(!r)return"#000000";const t=parseInt(r.slice(1,3),16),e=parseInt(r.slice(3,5),16),s=parseInt(r.slice(5,7),16);return .299*t+.587*e+.114*s>140?"#000000":"#FFFFFF"}class Ot{constructor(t,e,s){this.canvas=t,this.ctx=t.getContext("2d"),this.state=e,this.onInteractionEnd=s,this._initInteraction()}update(t,e,s){const{size:i,dpr:a}=this.state.dimensions;this._draw(i,a,t,e,s)}_initInteraction(){const t=s=>{const i=this.canvas.getBoundingClientRect(),{cx:a,cy:n,size:c}=this.state.dimensions,o=s.clientX-i.left-a,h=s.clientY-i.top-n,d=Math.hypot(o,h),g=c*.5,m=c*.35,b=c*.2;let u=null;return d>b&&d<m?u="degree":d>m&&d<g?u="pitchClass":d<=b&&(u="chromatic"),{x:o,y:h,ring:u}},e=()=>{if(!this.state.drag.active)return;const s=this.state.drag.active;this.state.drag.active=null,this.canvas.style.cursor="grab",s==="chromatic"?et(this.onInteractionEnd):s==="pitchClass"?Z("pitchClass",this.onInteractionEnd):s==="degree"&&tt(this.onInteractionEnd)};this.canvas.addEventListener("pointerdown",s=>{const{x:i,y:a,ring:n}=t(s);if(!n)return;const{drag:c,rings:o}=this.state;c.active=n,c.startX=i,c.startY=a,c.startPitchClass=o.pitchClass,c.startDegree=o.degree,c.startChrom=o.chromatic,c.startHighlight=o.highlightPosition,this.canvas.setPointerCapture(s.pointerId),this.canvas.style.cursor="grabbing"}),this.canvas.addEventListener("pointermove",s=>{if(this.state.drag.active){const{x:i,y:a}=t(s),n=this.state.drag,c=Math.atan2(n.startY,n.startX),h=Math.atan2(a,i)-c;n.active==="pitchClass"?O("pitchClass",n.startPitchClass+h):n.active==="degree"?(O("degree",n.startDegree+h),O("highlightPosition",n.startHighlight+h)):n.active==="chromatic"&&nt({startPitchClass:n.startPitchClass,startDegree:n.startDegree,startChrom:n.startChrom,startHighlight:n.startHighlight},h)}else{const{ring:i}=t(s);this.canvas.style.cursor=i?"grab":"default"}}),this.canvas.addEventListener("pointerup",e),this.canvas.addEventListener("pointercancel",e),this.canvas.addEventListener("pointerleave",()=>{this.state.drag.active||(this.canvas.style.cursor="default")})}_draw(t,e,s,i,a){const n=this.ctx;n.save(),n.scale(e,e),n.clearRect(0,0,t,t);const c=t/2,o=t/2,{pitchClass:h,degree:d,chromatic:g}=s,{chromaticLabels:m,diatonicLabels:b}=i,u=(P,C,v)=>{const k=v-p/2,I=v+p/2;n.beginPath(),n.arc(c,o,C,k,I),n.arc(c,o,P,I,k,!0),n.closePath()},y=()=>{const P=t*.5,C=t*.35;Object.keys(L).forEach((k,I)=>{const Y=I*p+h-Math.PI/2;u(C,P,Y),n.fillStyle=L[k]?"#fff":"#000",n.fill(),n.lineWidth=t*.002,n.strokeStyle="#000",n.stroke()})},_=()=>{const P=t*.35,C=t*.2;for(let v=0;v<12;v++){const k=v*p+d-Math.PI/2;u(C,P,k),n.fillStyle=$[v]||"#e0e0e0",n.fill(),n.lineWidth=t*.002,n.strokeStyle="#000",n.stroke()}},D=()=>{n.beginPath(),n.arc(c,o,t*.2,0,Math.PI*2),n.fillStyle="#000",n.fill()},A=()=>{const P=t*.5*.85,C=t*.35*.8,v=t*.2*.8,k=Object.keys(L),I=(T,x,B,N,w)=>{n.fillStyle=N,n.font=`${w}px 'Atkinson Hyperlegible Next'`,n.textAlign="center",n.textBaseline="middle";const V=c+Math.cos(T)*x,z=o+Math.sin(T)*x;if(String(B).includes("<br>")){const U=B.split("<br>"),K=w*1.1,ot=z-K*(U.length-1)/2;U.forEach((ct,lt)=>{n.fillText(ct,V,ot+lt*K)})}else n.fillText(B,V,z)},Y=t*pt;m.forEach((T,x)=>{const B=k[x],N=T;I(x*p+h-Math.PI/2,P,N,L[B]?"#000":"#fff",Y)});const rt=t*bt;b.forEach((T,x)=>{const B=$[x],N=it(B),w=T;I(x*p+d-Math.PI/2,C,w,N,rt)});const at=t*yt;gt.forEach(T=>I(T*p+g-Math.PI/2,v,T.toString(),"#fff",at))},M=()=>{if(!a||!a.isPlaying||a.currentNoteIndex===null)return;const C=a.currentNoteIndex%12*p+h-Math.PI/2,v=t*.5,k=t*.2;u(k,v,C),n.fillStyle="rgba(255, 255, 0, 0.6)",n.fill()},q=()=>{const P=t*.5,C=t*.125,v=-Math.PI/2+g,k=v-p/2,I=v+p/2;n.beginPath(),n.moveTo(c+Math.cos(k)*C,o+Math.sin(k)*C),n.arc(c,o,P,k,I),n.lineTo(c+Math.cos(I)*C,o+Math.sin(I)*C),n.arc(c,o,C,I,k,!0),n.closePath(),n.lineWidth=t*.006,n.strokeStyle="red",n.stroke()};y(),_(),D(),A(),M(),q(),n.restore()}}class Nt{constructor(t,e,s){this.container=t,this.state=e,this.onInteractionEnd=s,this.elements={pitchBelt:t.querySelector("#pitchBelt"),degreeBelt:t.querySelector("#degreeBelt"),chromaticBelt:t.querySelector("#chromaticBelt"),chromaticColorsTrack:t.querySelector("#chromatic-colors-track"),chromaticNumbersTrack:t.querySelector("#chromatic-numbers-track"),intervalBracketsTrackContainer:t.querySelector("#intervalBracketsContainer"),intervalBracketsWrapper:t.querySelector(".interval-brackets-wrapper"),cursor:t.querySelector("#belt-cursor"),flashOverlay:t.querySelector("#belt-flash-overlay")},this.state.belts.tracks={},this._initInteraction()}update(t,e){const{orientation:s}=this.state.belts,{diatonicLabels:i,chromaticLabels:a}=t;if(!this.state.belts.init){this._setupAllBelts(i,a),requestAnimationFrame(()=>{this._calculateAllItemSizes(s)&&(this.state.belts.init=!0)});return}const{pitchClass:n,degree:c,chromatic:o,highlightPosition:h}=this.state.rings,{tracks:d,itemSize:g}=this.state.belts;this._applyBeltStyles(e,i,a);let m=s==="vertical"?-n:n,b=s==="vertical"?-c:c,u=s==="vertical"?-o:o,y=s==="vertical"?-h:h;this._updateTrackPosition(d.pitchBelt,m,g.pitchBelt,s),this._updateTrackPosition(d.degreeBelt,b,g.degreeBelt,s),this._updateTrackPosition(d.chromaticColors,y,g.chromaticBelt,s),this._updateTrackPosition(d.chromaticNumbers,u,g.chromaticBelt,s),this._updateIntervalBracketsPosition(b,g.degreeBelt,s),this._updateCursorPosition(u,g.chromaticBelt,s),this._updatePlaybackFlash()}_initInteraction(){const{pitchBelt:t,degreeBelt:e,intervalBrackets:s,chromaticNumbersTrack:i}=this.elements;t&&this._addDragHandler(t,c=>{const o=this.state.drag.startPitchClass+(this.state.belts.orientation==="vertical"?-c:c);O("pitchClass",o)},()=>Z("pitchClass",this.onInteractionEnd));const a=c=>{const o=this.state.belts.orientation==="vertical"?-c:c;O("degree",this.state.drag.startDegree+o),O("highlightPosition",this.state.drag.startHighlight+o)},n=()=>tt(this.onInteractionEnd);e&&this._addDragHandler(e,a,n),s&&this._addDragHandler(s,a,n),i&&this._addDragHandler(i,c=>{const o=this.state.belts.orientation==="vertical"?-c:c,h={startPitchClass:this.state.drag.startPitchClass,startDegree:this.state.drag.startDegree,startChrom:this.state.drag.startChrom,startHighlight:this.state.drag.startHighlight};nt(h,o)},()=>et(this.onInteractionEnd))}_addDragHandler(t,e,s){t.style.cursor="grab";let i=null,a=0,n=0;const c=d=>{i=d.pointerId,t.setPointerCapture(i),a=d.clientX,n=d.clientY;const{drag:g,rings:m}=this.state;g.active=t.id||"belt-drag",g.startPitchClass=m.pitchClass,g.startDegree=m.degree,g.startChrom=m.chromatic,g.startHighlight=m.highlightPosition,t.style.cursor="grabbing"},o=d=>{if(i!==d.pointerId)return;const{orientation:g,itemSize:m}=this.state.belts,b=g==="vertical"?d.clientY-n:d.clientX-a;let u;t.id.includes("pitch")?u="pitchBelt":t.id.includes("degree")||t.id.includes("interval")?u="degreeBelt":t.id.includes("chromatic")&&(u="chromaticBelt");const y=m[u];if(!y||y===0)return;const _=b/y*p;e(_)},h=()=>{i!==null&&(t.releasePointerCapture(i),i=null,this.state.drag.active=null,t.style.cursor="grab",s())};t.addEventListener("pointerdown",c),t.addEventListener("pointermove",o),t.addEventListener("pointerup",h),t.addEventListener("pointercancel",h)}_setupAllBelts(t,e){this.elements.pitchBelt.innerHTML="",this.elements.degreeBelt.innerHTML="",this.elements.intervalBracketsTrackContainer.innerHTML="";const s=3;this.state.belts.tracks.pitchBelt=this._createTrack(this.elements.pitchBelt,e,s),this.state.belts.tracks.degreeBelt=this._createTrack(this.elements.degreeBelt,t,s),this._populateTrack(this.elements.chromaticColorsTrack,Array(12).fill(""),s),this._populateTrack(this.elements.chromaticNumbersTrack,[...Array(12).keys()],s),this.state.belts.tracks.chromaticColors=this.elements.chromaticColorsTrack,this.state.belts.tracks.chromaticNumbers=this.elements.chromaticNumbersTrack,this._createIntervalBracketsTrack(s)}_createTrack(t,e,s){const i=document.createElement("div");return i.className="belt-track",this._populateTrack(i,e,s),t.appendChild(i),i}_populateTrack(t,e,s){t.innerHTML="";const i=e.length;for(let a=0;a<s*12+3;a++){const n=a%i,c=e[n],o=document.createElement("div");o.className="belt-cell",o.innerHTML=String(c),o.dataset.originalIndex=String(n),t.appendChild(o)}}_createIntervalBracketsTrack(t){const e=document.createElement("div");e.className="interval-brackets-track";for(let s=0;s<12*t+3;s++){const i=s%12,a=R.indexOf(i),n=document.createElement("div");if(n.className="interval-bracket-cell",a!==-1){const c=mt[a];n.dataset.steps=c,n.innerHTML=`<span>+${c}</span>`}e.appendChild(n)}this.elements.intervalBracketsTrackContainer.appendChild(e)}_calculateAllItemSizes(t){return this._calcBeltItemSize("pitchBelt",this.elements.pitchBelt,t)&&this._calcBeltItemSize("degreeBelt",this.elements.degreeBelt,t)&&this._calcBeltItemSize("chromaticBelt",this.elements.chromaticBelt,t)&&this._calcBeltItemSize("intervalBracketsContainer",this.elements.intervalBracketsWrapper,t)}_calcBeltItemSize(t,e,s){const i=s==="vertical"?e.offsetHeight:e.offsetWidth;return i>0?(this.state.belts.itemSize[t]=i/12,!0):!1}_applyBeltStyles(t,e,s){var i,a,n,c;(i=this.state.belts.tracks.pitchBelt)==null||i.querySelectorAll(".belt-cell").forEach(o=>{const h=+o.dataset.originalIndex,d=G[h],g=L[d];o.style.background=g?"#fff":"#000",o.style.color=g?"#000":"#fff",o.innerHTML=s[h]}),(a=this.state.belts.tracks.degreeBelt)==null||a.querySelectorAll(".belt-cell").forEach(o=>{const h=+o.dataset.originalIndex,d=$[h]||"#f0f0f0";o.style.background=d,o.style.color=it(d),o.innerHTML=e[h]}),(n=this.elements.chromaticColorsTrack)==null||n.querySelectorAll(".belt-cell").forEach(o=>{const h=+o.dataset.originalIndex;o.style.background=t.includes(h)?"#e0e0e0":"#4a4a4a"}),(c=this.elements.chromaticNumbersTrack)==null||c.querySelectorAll(".belt-cell").forEach(o=>{const{chromatic:h,highlightPosition:d}=this.state.rings,m=f(d-h)/p,b=+o.dataset.originalIndex,u=Math.round((b-m+12*100)%12)%12;o.style.color=t.includes(u)?"black":"lightgray"})}_calculateTranslation(t,e,s){const i=12*e/E,a=t*i;let n,c=0;return s==="vertical"?(n=-(e*12),c=3*e,n-c+a):(n=-(e*12),n+a)}_updateTrackPosition(t,e,s,i){if(!t||!s)return;const a=this._calculateTranslation(e,s,i),n=i==="vertical"?`translateY(${a}px)`:`translateX(${a}px)`;t.style.transform=n}_updateIntervalBracketsPosition(t,e,s){const i=this.elements.intervalBracketsTrackContainer.querySelector(".interval-brackets-track");if(!i||!e)return;let a=this._calculateTranslation(t,e,s);s==="horizontal"&&(a+=.5*e);const n=s==="vertical"?`translateY(${a}px)`:`translateX(${a}px)`;i.style.transform=n}_updateCursorPosition(t,e,s){const i=this.elements.cursor;if(!i||!e)return;const a=12*e/E,n=t*a;let c;if(s==="vertical"){const h=-12*e;c=(n%h+h)%h}else c=n;const o=s==="vertical"?`translateY(${c}px)`:`translateX(${c}px)`;i.style.transform=o}_updatePlaybackFlash(){const{rings:t,playback:e,belts:s}=this.state,i=this.elements.flashOverlay,a=s.itemSize.chromaticBelt,n=s.orientation;if(!i||!a||!e.isPlaying||e.currentNoteIndex===null){i.style.display="none";return}const c=12*a/E;let o;if(n==="vertical"){const d=-t.chromatic,g=(e.currentNoteIndex-e.rootNoteIndexForPlayback)*p,b=(d-g)*c,u=-12*a;o=(b%u+u)%u}else o=(t.chromatic+(e.currentNoteIndex-e.rootNoteIndexForPlayback)*p)*c;const h=n==="vertical"?`translateY(${o}px)`:`translateX(${o}px)`;i.style.transform=h,i.style.display="block"}}class Lt{constructor(t,e,s){this.state=e,this.callbacks=s,this.elements={resultContainer:t.querySelector("#result-container"),resultText:t.querySelector("#result-text"),flatBtn:document.getElementById("flat-btn"),sharpBtn:document.getElementById("sharp-btn"),settingsBtn:document.getElementById("settings-btn"),sidebar:document.getElementById("sidebar"),sidebarOverlay:document.getElementById("sidebar-overlay"),toggleOrientationBtn:document.getElementById("toggle-orientation-btn")},this._initListeners()}_initListeners(){this.elements.flatBtn.addEventListener("click",this.callbacks.onToggleFlat),this.elements.sharpBtn.addEventListener("click",this.callbacks.onToggleSharp),this.elements.resultContainer.addEventListener("click",t=>{t.target.closest("button")||this.callbacks.onTogglePlayback()}),this.elements.settingsBtn.addEventListener("click",t=>{t.stopPropagation(),this.callbacks.onToggleSidebar()}),this.elements.sidebarOverlay.addEventListener("click",()=>{this.state.ui.sidebarOpen&&this.callbacks.onToggleSidebar(!1)}),this.elements.toggleOrientationBtn.addEventListener("click",this.callbacks.onToggleOrientation)}update(){const{display:t,playback:e,ui:s,belts:i}=this.state,{resultContainer:a,flatBtn:n,sharpBtn:c,resultText:o,sidebar:h,sidebarOverlay:d,settingsBtn:g,toggleOrientationBtn:m}=this.elements;n.classList.toggle("active",t.flat),c.classList.toggle("active",t.sharp),n.setAttribute("aria-pressed",String(t.flat)),c.setAttribute("aria-pressed",String(t.sharp)),a.classList.toggle("playback-active",e.isPlaying),Et(this.state,o);const u=i.orientation==="horizontal"?"Vertical":"Horizontal";m.textContent!==u&&(m.textContent=u);const y=s.sidebarOpen;h.classList.toggle("open",y),h.setAttribute("aria-hidden",String(!y)),d.classList.toggle("visible",y),g.setAttribute("aria-expanded",String(y)),y||document.activeElement===this.elements.toggleOrientationBtn&&g.focus()}}class Dt{constructor(t){this.container=t,this.state=l,this.elements={canvas:t.querySelector("#chromaWheel"),beltsContainer:t.querySelector(".belts-container")};const e={onToggleFlat:()=>S.toggleAccidental("flat"),onToggleSharp:()=>S.toggleAccidental("sharp"),onTogglePlayback:()=>S.togglePlayback(),onToggleSidebar:s=>S.toggleSidebar(s),onToggleOrientation:()=>S.setOrientation(this.state.belts.orientation==="horizontal"?"vertical":"horizontal")};this.wheel=new Ot(this.elements.canvas,this.state,this.onInteractionEnd.bind(this)),this.belts=new Nt(this.elements.beltsContainer,this.state,this.onInteractionEnd.bind(this)),this.uiControls=new Lt(t,this.state,e),this._setupResponsiveLogic(),ht(this.redraw.bind(this))}onInteractionEnd(){}_setupResponsiveLogic(){const t=(s,i)=>{let a;return(...n)=>{clearTimeout(a),a=setTimeout(()=>s.apply(this,n),i)}},e=()=>{const i=window.innerWidth>window.innerHeight?"vertical":"horizontal";this.state.belts.orientation!==i?S.setOrientation(i):this.redraw(performance.now())};window.addEventListener("resize",t(e,50)),e()}redraw(t){if(xt(t),dt(this.elements.canvas,this.state.dimensions),!this.state.dimensions.size)return;const{rings:e,playback:s}=this.state,i=Tt(this.state),a=R;this.wheel.update(e,i,s),this.belts.update(i,a),this.uiControls.update()}}document.addEventListener("DOMContentLoaded",()=>{const r=document.querySelector(".main-container");r&&new Dt(r)});
